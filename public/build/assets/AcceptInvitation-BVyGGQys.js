import{z as w,u as P,q as S,r as c,o as q,b as m,e as t,h,g as a,i as r,A as U,t as p,w as b,x as R,y as Y,B as z,F as D,j,C as G,v as J,m as l,l as C}from"./app-COZ50StM.js";import{s as L}from"./index-CXogGqNS.js";import{s as N}from"./index-DJnBz__0.js";import{s as H}from"./index-D8SOZXLq.js";import{s as $}from"./index-wZFL_vjB.js";import"./index-DZelkFbS.js";const O={class:"min-h-screen flex items-center justify-center bg-surface-100 dark:bg-surface-900 p-4"},W={class:"w-full max-w-md bg-white dark:bg-surface-800 border border-surface-200 dark:border-surface-700 rounded-lg shadow-lg p-6"},K={key:0,class:"flex flex-col items-center justify-center py-8"},Q={key:1,class:"text-center py-8"},X={class:"text-surface-500 mb-6"},Z={key:2,class:"text-center py-8"},ee={class:"text-surface-500 mb-6"},te={key:3},se={class:"mb-6 p-4 bg-primary-50 dark:bg-primary-900/20 rounded-lg"},ae={class:"flex items-center gap-3 mb-3"},oe={class:"font-semibold text-surface-900 dark:text-surface-100"},re={class:"text-sm text-surface-500"},le={class:"flex items-center gap-2 text-sm"},ie={key:0,class:"text-red-500"},ne={key:0,class:"text-red-500"},de={key:2,class:"text-red-500 text-sm text-center"},ue={class:"mt-4 text-center"},ye={__name:"AcceptInvitation",setup(ce){w.defaults.headers.common.Accept="application/json";const A=G(),E=J(),I=P(),B=S(),_=c(!0),V=c(!1),v=c(null),x=c(null),g=c(!1),T=c(!1),i=c({name:"",password:"",password_confirmation:""}),n=c({}),y=c(""),F=async()=>{var e,d,f,o;const k=A.params.token;if(!k){v.value="No invitation token provided.",_.value=!1;return}try{const s=await w.get("/api/team/invitation",{params:{token:k}});x.value=s.data.invitation,g.value=s.data.invitation.existing_user||!1}catch(s){((e=s.response)==null?void 0:e.status)===404?v.value="This invitation link is invalid or has expired.":((d=s.response)==null?void 0:d.status)===410?v.value="This invitation has already been accepted.":v.value=((o=(f=s.response)==null?void 0:f.data)==null?void 0:o.message)||"Failed to load invitation. Please try again."}finally{_.value=!1}},M=async()=>{var e,d,f,o;n.value={},y.value="",V.value=!0;const k=A.params.token;try{const s={token:k};g.value||(s.name=i.value.name,s.password=i.value.password,s.password_confirmation=i.value.password_confirmation);const u=await w.post("/api/team/invitation/accept",s);u.data.token&&(I.token=u.data.token,I.user=u.data.user,localStorage.setItem("auth_token",u.data.token),w.defaults.headers.common.Authorization=`Bearer ${u.data.token}`),B.add({severity:"success",summary:"Welcome!",detail:u.data.message||"You have joined the team successfully.",life:3e3}),T.value=!0,setTimeout(()=>{E.push("/dashboard")},2e3)}catch(s){y.value=((d=(e=s.response)==null?void 0:e.data)==null?void 0:d.message)||"Failed to accept invitation. Please try again.",(o=(f=s.response)==null?void 0:f.data)!=null&&o.errors&&(n.value={},Object.keys(s.response.data.errors).forEach(u=>{n.value[u]=s.response.data.errors[u][0]})),B.add({severity:"error",summary:"Error",detail:y.value,life:5e3})}finally{V.value=!1}};return q(()=>{F()}),(k,e)=>{var f;const d=R("router-link");return l(),m("div",O,[t("div",W,[e[17]||(e[17]=t("div",{class:"text-center mb-6"},[t("h2",{class:"text-2xl font-bold text-surface-900 dark:text-surface-100"},"Team Invitation")],-1)),t("div",null,[_.value?(l(),m("div",K,[a(r(U),{style:{width:"50px",height:"50px"}}),e[3]||(e[3]=t("p",{class:"text-surface-500 mt-4"},"Loading invitation...",-1))])):v.value?(l(),m("div",Q,[e[4]||(e[4]=t("div",{class:"w-16 h-16 mx-auto mb-4 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center"},[t("i",{class:"pi pi-times text-3xl text-red-600 dark:text-red-400"})],-1)),e[5]||(e[5]=t("h3",{class:"text-lg font-semibold text-surface-900 dark:text-surface-100 mb-2"},"Invalid Invitation",-1)),t("p",X,p(v.value),1),a(d,{to:"/login"},{default:b(()=>[a(r(j),{label:"Go to Login",icon:"pi pi-sign-in"})]),_:1})])):T.value?(l(),m("div",Z,[e[6]||(e[6]=t("div",{class:"w-16 h-16 mx-auto mb-4 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center"},[t("i",{class:"pi pi-check text-3xl text-green-600 dark:text-green-400"})],-1)),e[7]||(e[7]=t("h3",{class:"text-lg font-semibold text-surface-900 dark:text-surface-100 mb-2"},"Invitation Accepted!",-1)),t("p",ee,"You have successfully joined "+p((f=x.value)==null?void 0:f.company_name)+".",1),a(d,{to:"/dashboard"},{default:b(()=>[a(r(j),{label:"Go to Dashboard",icon:"pi pi-arrow-right",iconPos:"right"})]),_:1})])):x.value?(l(),m("div",te,[t("div",se,[t("div",ae,[e[8]||(e[8]=t("div",{class:"w-12 h-12 rounded-full bg-primary-100 dark:bg-primary-900/50 flex items-center justify-center"},[t("i",{class:"pi pi-building text-primary-600 dark:text-primary-400 text-xl"})],-1)),t("div",null,[t("p",oe,p(x.value.company_name),1),t("p",re,"Invited by "+p(x.value.invited_by),1)])]),t("div",le,[e[9]||(e[9]=t("span",{class:"text-surface-500"},"Role:",-1)),a(r(H),{value:x.value.role,severity:"info"},null,8,["value"])])]),t("form",{onSubmit:Y(M,["prevent"]),class:"space-y-4"},[g.value?(l(),z(r($),{key:1,severity:"info",closable:!1},{default:b(()=>[...e[15]||(e[15]=[C(" You already have an account. Click below to join the team. ",-1)])]),_:1})):(l(),m(D,{key:0},[a(r($),{severity:"info",closable:!1,class:"mb-4"},{default:b(()=>[...e[10]||(e[10]=[C(" Create your account to join the team ",-1)])]),_:1}),t("div",null,[e[11]||(e[11]=t("label",{for:"name",class:"block text-sm font-medium mb-2 text-surface-700 dark:text-surface-300"},"Full Name",-1)),a(r(L),{id:"name",modelValue:i.value.name,"onUpdate:modelValue":e[0]||(e[0]=o=>i.value.name=o),placeholder:"Enter your full name",class:"w-full",invalid:!!n.value.name,required:""},null,8,["modelValue","invalid"]),n.value.name?(l(),m("small",ie,p(n.value.name),1)):h("",!0)]),t("div",null,[e[13]||(e[13]=t("label",{for:"password",class:"block text-sm font-medium mb-2 text-surface-700 dark:text-surface-300"},"Password",-1)),a(r(N),{id:"password",modelValue:i.value.password,"onUpdate:modelValue":e[1]||(e[1]=o=>i.value.password=o),placeholder:"Create a password",toggleMask:"",class:"w-full",invalid:!!n.value.password,required:""},{footer:b(()=>[...e[12]||(e[12]=[t("p",{class:"text-xs mt-2"},"At least 8 characters",-1)])]),_:1},8,["modelValue","invalid"]),n.value.password?(l(),m("small",ne,p(n.value.password),1)):h("",!0)]),t("div",null,[e[14]||(e[14]=t("label",{for:"password_confirmation",class:"block text-sm font-medium mb-2 text-surface-700 dark:text-surface-300"},"Confirm Password",-1)),a(r(N),{id:"password_confirmation",modelValue:i.value.password_confirmation,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value.password_confirmation=o),placeholder:"Confirm your password",toggleMask:"",feedback:!1,class:"w-full",required:""},null,8,["modelValue"])])],64)),y.value?(l(),m("div",de,p(y.value),1)):h("",!0),a(r(j),{type:"submit",label:g.value?"Join Team":"Create Account & Join",class:"w-full",loading:V.value,icon:"pi pi-user-plus"},null,8,["label","loading"])],32),t("div",ue,[a(d,{to:"/",class:"text-sm text-surface-600 dark:text-surface-400 hover:text-surface-900 dark:hover:text-surface-100"},{default:b(()=>[...e[16]||(e[16]=[t("i",{class:"pi pi-arrow-left mr-1"},null,-1),C(" Back to Home ",-1)])]),_:1})])])):h("",!0)])])])}}};export{ye as default};
