import{d as X,z as x,r as Z,c as p,o as q,a1 as G,b as h,e as s,B as F,h as H,g as l,F as T,k as V,w as c,i,X as J,m as f,n as C,t as d,p as Q,Z as $,a5 as Y,j as D,I as ee}from"./app-DJ0pZO5B.js";import{s as te,a as y}from"./index-C6b7UG9g.js";import{s as _}from"./index-CBniI9_G.js";import{s as se}from"./index-abbMYiPI.js";import{s as ae}from"./index-D6zsbsG1.js";import{s as ie}from"./index-DTWL4fU4.js";import{s as le}from"./index-DOmSFTcJ.js";import{s as oe}from"./index-BDfPnVwz.js";import"./index-Dg0usBd7.js";import"./index-BbUuZ738.js";import"./index-Bj4n3Sk4.js";import"./index-Dr7DX1aH.js";import"./index-B0N4SZb2.js";const re=X("activityLogs",{state:()=>({logs:[],stats:{total:0,today:0,this_week:0,by_action:[]},actionTypes:[],pagination:{current_page:1,last_page:1,per_page:20,total:0},filters:{action:null,user_id:null,search:"",from:null,to:null},loading:!1,loadingStats:!1,error:null}),actions:{async fetchLogs(n=1){var a,g;this.loading=!0,this.error=null;try{const u={page:n,per_page:this.pagination.per_page,...this.filters};Object.keys(u).forEach(m=>{(u[m]===null||u[m]==="")&&delete u[m]});const r=await x.get("/api/activity-logs",{params:u});this.logs=r.data.data,this.pagination={current_page:r.data.current_page,last_page:r.data.last_page,per_page:r.data.per_page,total:r.data.total}}catch(u){throw this.error=((g=(a=u.response)==null?void 0:a.data)==null?void 0:g.message)||"Failed to fetch activity logs",u}finally{this.loading=!1}},async fetchStats(){this.loadingStats=!0;try{const n=await x.get("/api/activity-logs/stats");this.stats=n.data}catch(n){console.error("Failed to fetch activity stats:",n)}finally{this.loadingStats=!1}},async fetchActionTypes(){try{const n=await x.get("/api/activity-logs/action-types");this.actionTypes=n.data.actions||[]}catch(n){console.error("Failed to fetch action types:",n)}},setFilters(n){this.filters={...this.filters,...n}},resetFilters(){this.filters={action:null,user_id:null,search:"",from:null,to:null}},async init(){await Promise.all([this.fetchLogs(),this.fetchStats(),this.fetchActionTypes()])}}}),ne={class:"space-y-6"},ce={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ue={class:"flex items-center gap-4"},de={class:"text-sm text-surface-500 dark:text-surface-400"},pe={key:0,class:"text-2xl font-bold"},fe={key:1,class:"text-2xl font-bold text-surface-900 dark:text-surface-100"},ge={class:"space-y-3"},he={class:"flex-1"},me={class:"flex items-center justify-between mb-1"},ye={class:"text-sm font-medium"},_e={class:"text-sm text-surface-500"},ve={class:"w-full bg-surface-200 dark:bg-surface-700 rounded-full h-2"},xe={class:"flex flex-wrap items-center gap-4"},be={class:"flex-1 min-w-[200px]"},we={class:"flex items-center gap-3"},ke={class:"font-medium text-surface-900 dark:text-surface-100"},Se={class:"text-xs text-surface-500"},Ae={class:"text-surface-700 dark:text-surface-300"},Le={class:"text-xs bg-surface-100 dark:bg-surface-700 px-2 py-1 rounded"},Fe={class:"text-surface-600 dark:text-surface-400"},Ke={__name:"Index",setup(n){const a=re(),g=Z(null),u=p(()=>a.logs),r=p(()=>a.stats),m=p(()=>a.actionTypes),I=p(()=>a.loading),U=p(()=>a.loadingStats),b=p(()=>a.pagination),R=p(()=>[{label:"All Actions",value:null},...m.value.map(e=>({label:v(e),value:e}))]);q(async()=>{await a.init()}),G(g,e=>{e&&e[0]&&e[1]?(a.setFilters({from:w(e[0]),to:w(e[1])}),a.fetchLogs(1)):e||(a.setFilters({from:null,to:null}),a.fetchLogs(1))});function w(e){return e.toISOString().split("T")[0]}function v(e){return e.replace(/_/g," ").replace(/\./g," - ").replace(/\b\w/g,o=>o.toUpperCase())}function j(e){return e?new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}function B(e){return e.includes("delete")||e.includes("destroy")?"danger":e.includes("create")||e.includes("register")?"success":e.includes("update")||e.includes("change")?"info":(e.includes("login")||e.includes("logout"),"secondary")}function z(e){return e.includes("login")?"pi-sign-in":e.includes("logout")?"pi-sign-out":e.includes("create")?"pi-plus":e.includes("update")||e.includes("change")?"pi-pencil":e.includes("delete")||e.includes("destroy")?"pi-trash":e.includes("message")?"pi-comments":e.includes("settings")?"pi-cog":"pi-circle"}function N(e){return e?e.split(" ").map(o=>o[0]).join("").substring(0,2).toUpperCase():"?"}function P(){a.fetchLogs(1)}function K(){a.fetchLogs(1)}function M(e){a.fetchLogs(e.page+1)}function O(){a.resetFilters(),g.value=null,a.fetchLogs(1)}function E(){a.init()}const W=p(()=>[{label:"Total Activities",value:r.value.total||0,icon:"pi-history",color:"bg-blue-500"},{label:"Today",value:r.value.today||0,icon:"pi-calendar",color:"bg-green-500"},{label:"This Week",value:r.value.this_week||0,icon:"pi-chart-line",color:"bg-purple-500"}]);return(e,o)=>{const k=J("tooltip");return f(),h("div",ne,[s("div",ce,[(f(!0),h(T,null,V(W.value,t=>(f(),F(i(_),{key:t.label,class:"border-0"},{content:c(()=>[s("div",ue,[s("div",{class:C(["w-12 h-12 rounded-lg flex items-center justify-center text-white",t.color])},[s("i",{class:C(["pi",t.icon,"text-xl"])},null,2)],2),s("div",null,[s("p",de,d(t.label),1),U.value?(f(),h("p",pe,[l(i(le),{width:"60px",height:"28px"})])):(f(),h("p",fe,d(t.value.toLocaleString()),1))])])]),_:2},1024))),128))]),r.value.by_action&&r.value.by_action.length>0?(f(),F(i(_),{key:0},{title:c(()=>[...o[3]||(o[3]=[s("div",{class:"flex items-center gap-2"},[s("i",{class:"pi pi-chart-bar text-primary-500"}),s("span",null,"Top Activities")],-1)])]),content:c(()=>[s("div",ge,[(f(!0),h(T,null,V(r.value.by_action.slice(0,5),t=>(f(),h("div",{key:t.action,class:"flex items-center gap-4"},[s("div",he,[s("div",me,[s("span",ye,d(v(t.action)),1),s("span",_e,d(t.count),1)]),s("div",ve,[s("div",{class:"bg-primary-500 h-2 rounded-full",style:Q({width:`${t.count/r.value.total*100}%`})},null,4)])])]))),128))])]),_:1})):H("",!0),l(i(_),null,{content:c(()=>[s("div",xe,[s("div",be,[l(i(se),{modelValue:i(a).filters.search,"onUpdate:modelValue":o[0]||(o[0]=t=>i(a).filters.search=t),placeholder:"Search activities...",class:"w-full",onKeyup:Y(P,["enter"])},null,8,["modelValue"])]),l(i(ae),{modelValue:i(a).filters.action,"onUpdate:modelValue":o[1]||(o[1]=t=>i(a).filters.action=t),options:R.value,optionLabel:"label",optionValue:"value",placeholder:"Action Type",class:"w-48",onChange:K},null,8,["modelValue","options"]),l(i(oe),{modelValue:g.value,"onUpdate:modelValue":o[2]||(o[2]=t=>g.value=t),selectionMode:"range",placeholder:"Date Range",class:"w-64",showIcon:"",manualInput:!1,dateFormat:"M d, yy"},null,8,["modelValue"]),$(l(i(D),{icon:"pi pi-filter-slash",severity:"secondary",outlined:"",rounded:"",onClick:O},null,512),[[k,"Clear Filters",void 0,{top:!0}]]),$(l(i(D),{icon:"pi pi-refresh",severity:"secondary",outlined:"",rounded:"",onClick:E},null,512),[[k,"Refresh",void 0,{top:!0}]])])]),_:1}),l(i(_),null,{content:c(()=>[l(i(te),{value:u.value,loading:I.value,paginator:!0,rows:b.value.per_page,totalRecords:b.value.total,lazy:!0,onPage:M,dataKey:"id",stripedRows:"",class:"p-datatable-sm"},{empty:c(()=>[...o[4]||(o[4]=[s("div",{class:"text-center py-12 text-surface-500"},[s("i",{class:"pi pi-history text-5xl mb-4 block opacity-50"}),s("p",{class:"text-lg mb-2"},"No activity logs found"),s("p",{class:"text-sm"},"Activities will appear here as users interact with the system")],-1)])]),default:c(()=>[l(i(y),{header:"User",style:{"min-width":"200px"}},{body:c(({data:t})=>{var S,A,L;return[s("div",we,[l(i(ee),{label:N((S=t.user)==null?void 0:S.name),shape:"circle",class:"bg-primary-100 text-primary-700 dark:bg-primary-900 dark:text-primary-300"},null,8,["label"]),s("div",null,[s("p",ke,d(((A=t.user)==null?void 0:A.name)||"System"),1),s("p",Se,d(((L=t.user)==null?void 0:L.email)||"-"),1)])])]}),_:1}),l(i(y),{header:"Action",style:{"min-width":"180px"}},{body:c(({data:t})=>[l(i(ie),{value:v(t.action),severity:B(t.action),icon:"pi "+z(t.action)},null,8,["value","severity","icon"])]),_:1}),l(i(y),{field:"description",header:"Description",style:{"min-width":"300px"}},{body:c(({data:t})=>[s("p",Ae,d(t.description||"-"),1)]),_:1}),l(i(y),{header:"IP Address",style:{width:"140px"}},{body:c(({data:t})=>[s("code",Le,d(t.ip_address||"-"),1)]),_:1}),l(i(y),{header:"Date",style:{width:"180px"}},{body:c(({data:t})=>[s("span",Fe,d(j(t.created_at)),1)]),_:1})]),_:1},8,["value","loading","rows","totalRecords"])]),_:1})])}}};export{Ke as default};
