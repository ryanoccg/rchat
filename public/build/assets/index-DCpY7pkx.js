import{d as c,H as i}from"./app-BPtEyV-V.js";import{s as u}from"./index-DNu7Aii_.js";const h=c("workflows",{state:()=>({workflows:[],currentWorkflow:null,currentStep:null,executions:[],currentExecution:null,executionLogs:[],statistics:null,pagination:{currentPage:1,lastPage:1,perPage:15,total:0},executionsPagination:{currentPage:1,lastPage:1,perPage:15,total:0},filters:{status:null,triggerType:null,search:""},executionsFilters:{status:null,workflowId:null,customerId:null,conversationId:null,dateFrom:null,dateTo:null},loading:!1,loadingWorkflow:!1,loadingExecutions:!1,loadingStatistics:!1,saving:!1,testing:!1,error:null}),getters:{hasWorkflows:t=>t.workflows.length>0,totalWorkflows:t=>t.pagination.total,activeWorkflows:t=>t.workflows.filter(s=>s.status==="active"),draftWorkflows:t=>t.workflows.filter(s=>s.status==="draft"),workflowById:t=>s=>t.workflows.find(r=>r.id===s),triggerTypes:()=>[{value:"customer_created",label:"Customer Created",description:"When a new customer is created"},{value:"customer_returning",label:"Returning Customer",description:"When a customer returns after X days"},{value:"first_message",label:"First Message",description:"When the first message in a conversation is sent"},{value:"conversation_created",label:"Conversation Created",description:"When a new conversation starts"},{value:"conversation_closed",label:"Conversation Closed",description:"When a conversation is closed"},{value:"message_received",label:"Message Received",description:"When a customer message is received"},{value:"no_response",label:"No Response",description:"When no response after X minutes"},{value:"scheduled",label:"Scheduled",description:"Run on a schedule"},{value:"auto_follow_up",label:"Auto Follow-up",description:"Automatically follow up on inactive conversations"}],stepTypes:()=>[{value:"trigger",label:"Trigger",category:"triggers",icon:"pi pi-bolt",color:"blue"},{value:"action",label:"Action",category:"actions",icon:"pi pi-play",color:"green"},{value:"condition",label:"Condition",category:"logic",icon:"pi pi-code",color:"yellow"},{value:"delay",label:"Delay",category:"logic",icon:"pi pi-clock",color:"gray"},{value:"parallel",label:"Parallel",category:"logic",icon:"pi pi-sitemap",color:"purple"},{value:"loop",label:"Loop",category:"logic",icon:"pi pi-refresh",color:"orange"},{value:"custom_code",label:"Custom Code",category:"logic",icon:"pi pi-file-edit",color:"orange"}],actionTypes:()=>[{value:"send_message",label:"Send Message",description:"Send a text message"},{value:"send_ai_response",label:"Send AI Response",description:"Generate and send an AI response"},{value:"add_tag",label:"Add Tag",description:"Add a tag to customer or conversation"},{value:"remove_tag",label:"Remove Tag",description:"Remove a tag from customer or conversation"},{value:"assign_agent",label:"Assign Agent",description:"Assign conversation to an agent"},{value:"assign_team",label:"Assign Team",description:"Assign conversation to a team"},{value:"human_handoff",label:"Human Handoff",description:"Transfer conversation to human"},{value:"set_status",label:"Set Status",description:"Change conversation status"},{value:"set_priority",label:"Set Priority",description:"Change conversation priority"},{value:"add_note",label:"Add Note",description:"Add a note to the conversation"}],conditionTypes:()=>[{value:"customer_attribute",label:"Customer Attribute",description:"Check customer properties"},{value:"conversation_attribute",label:"Conversation Attribute",description:"Check conversation properties"},{value:"message_content",label:"Message Content",description:"Check message text"},{value:"intent_value",label:"Intent Value",description:"Match classified customer intent"},{value:"time_of_day",label:"Time of Day",description:"Check current time"},{value:"day_of_week",label:"Day of Week",description:"Check current day"},{value:"ai_condition",label:"AI Evaluation",description:"Use AI to evaluate condition"}],intentTypes:()=>[{value:"general_inquiry",label:"General Inquiry",description:"Greetings, casual chat"},{value:"ask_for_service",label:"Ask for Service",description:"Booking, appointments"},{value:"customer_service",label:"Customer Service",description:"Complaints, support issues"},{value:"company_information",label:"Company Information",description:"Hours, location, policies"},{value:"product_inquiry",label:"Product Inquiry",description:"Products, prices, availability"}],activeFiltersCount:t=>{let s=0;return t.filters.status&&s++,t.filters.triggerType&&s++,t.filters.search&&s++,s}},actions:{async fetchWorkflows(t=1){var s,r;this.loading=!0,this.error=null;try{const e={page:t,per_page:this.pagination.perPage,...this.filters};Object.keys(e).forEach(a=>{(e[a]===null||e[a]==="")&&delete e[a]}),console.log("Fetching workflows with params:",e);const o=await i.get("/workflows",{params:e});console.log("Workflows response:",o.data),this.workflows=o.data.data,this.pagination={currentPage:o.data.current_page,lastPage:o.data.last_page,perPage:o.data.per_page,total:o.data.total}}catch(e){throw console.error("Error fetching workflows:",e),this.error=((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to fetch workflows",e}finally{this.loading=!1}},async fetchWorkflow(t){var s,r;this.loadingWorkflow=!0,this.error=null;try{const e=await i.get(`/workflows/${t}`);return this.currentWorkflow=e.data.workflow,this.currentWorkflow}catch(e){throw this.error=((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to fetch workflow",e}finally{this.loadingWorkflow=!1}},async createWorkflow(t){var s,r;this.saving=!0,this.error=null;try{const e=await i.post("/workflows",t);return this.workflows.unshift(e.data.workflow),this.pagination.total++,e.data}catch(e){throw this.error=((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to create workflow",e}finally{this.saving=!1}},async updateWorkflow(t,s){var r,e,o;this.saving=!0,this.error=null;try{const a=await i.put(`/workflows/${t}`,s),n=this.workflows.findIndex(l=>l.id===t);return n!==-1&&(this.workflows[n]=a.data.workflow),((r=this.currentWorkflow)==null?void 0:r.id)===t&&(this.currentWorkflow=a.data.workflow),a.data}catch(a){throw this.error=((o=(e=a.response)==null?void 0:e.data)==null?void 0:o.message)||"Failed to update workflow",a}finally{this.saving=!1}},async deleteWorkflow(t){var s,r,e;this.saving=!0,this.error=null;try{return await i.delete(`/workflows/${t}`),this.workflows=this.workflows.filter(o=>o.id!==t),this.pagination.total--,((s=this.currentWorkflow)==null?void 0:s.id)===t&&(this.currentWorkflow=null),!0}catch(o){throw this.error=((e=(r=o.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to delete workflow",o}finally{this.saving=!1}},async activateWorkflow(t){var s,r,e;this.error=null;try{const o=await i.post(`/workflows/${t}/activate`),a=this.workflows.findIndex(n=>n.id===t);return a!==-1&&(this.workflows[a]=o.data.workflow),((s=this.currentWorkflow)==null?void 0:s.id)===t&&(this.currentWorkflow=o.data.workflow),o.data}catch(o){throw this.error=((e=(r=o.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to activate workflow",o}},async deactivateWorkflow(t){var s,r,e;this.error=null;try{const o=await i.post(`/workflows/${t}/deactivate`),a=this.workflows.findIndex(n=>n.id===t);return a!==-1&&(this.workflows[a]=o.data.workflow),((s=this.currentWorkflow)==null?void 0:s.id)===t&&(this.currentWorkflow=o.data.workflow),o.data}catch(o){throw this.error=((e=(r=o.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to deactivate workflow",o}},async duplicateWorkflow(t){var s,r;this.saving=!0,this.error=null;try{const e=await i.post(`/workflows/${t}/duplicate`);return this.workflows.unshift(e.data.workflow),this.pagination.total++,e.data}catch(e){throw this.error=((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to duplicate workflow",e}finally{this.saving=!1}},async testWorkflow(t,s){var r,e;this.testing=!0,this.error=null;try{return(await i.post(`/workflows/${t}/test`,s)).data.result}catch(o){throw this.error=((e=(r=o.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to test workflow",o}finally{this.testing=!1}},async addStep(t,s){var r,e,o;this.error=null;try{const a=await i.post(`/workflows/${t}/steps`,s);return((r=this.currentWorkflow)==null?void 0:r.id)===t&&(this.currentWorkflow.steps||(this.currentWorkflow.steps=[]),this.currentWorkflow.steps.push(a.data.step)),a.data}catch(a){throw this.error=((o=(e=a.response)==null?void 0:e.data)==null?void 0:o.message)||"Failed to add step",a}},async updateStep(t,s){var r,e,o;this.error=null;try{const a=await i.put(`/workflows/steps/${t}`,s);if((r=this.currentWorkflow)!=null&&r.steps){const n=this.currentWorkflow.steps.findIndex(l=>l.id===t);n!==-1&&(this.currentWorkflow.steps[n]=a.data.step)}return a.data}catch(a){throw this.error=((o=(e=a.response)==null?void 0:e.data)==null?void 0:o.message)||"Failed to update step",a}},async deleteStep(t){var s,r,e;this.error=null;try{return await i.delete(`/workflows/steps/${t}`),(s=this.currentWorkflow)!=null&&s.steps&&(this.currentWorkflow.steps=this.currentWorkflow.steps.filter(o=>o.id!==t)),!0}catch(o){throw this.error=((e=(r=o.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to delete step",o}},async fetchExecutions(t=1){var s,r;this.loadingExecutions=!0,this.error=null;try{const e={page:t,per_page:this.executionsPagination.perPage};this.executionsFilters.status&&(e.status=this.executionsFilters.status),this.executionsFilters.workflowId&&(e.workflow_id=this.executionsFilters.workflowId),this.executionsFilters.customerId&&(e.customer_id=this.executionsFilters.customerId),this.executionsFilters.conversationId&&(e.conversation_id=this.executionsFilters.conversationId),this.executionsFilters.dateFrom&&(e.date_from=this.executionsFilters.dateFrom),this.executionsFilters.dateTo&&(e.date_to=this.executionsFilters.dateTo);const o=await i.get("/workflows/executions",{params:e});return this.executions=o.data.data,this.executionsPagination={currentPage:o.data.meta.current_page,lastPage:o.data.meta.last_page,perPage:o.data.meta.per_page,total:o.data.meta.total},o.data}catch(e){throw this.error=((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to fetch executions",e}finally{this.loadingExecutions=!1}},async fetchExecutionDetails(t){var s,r;this.loadingExecutions=!0,this.error=null;try{const e=await i.get(`/workflows/executions/${t}`);return this.currentExecution=e.data.execution,this.executionLogs=e.data.execution.logs||[],this.currentExecution}catch(e){throw this.error=((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to fetch execution details",e}finally{this.loadingExecutions=!1}},async cancelExecution(t){var s,r,e;this.error=null;try{const o=await i.post(`/workflows/executions/${t}/cancel`),a=this.executions.findIndex(n=>n.id===t);return a!==-1&&(this.executions[a]=o.data.execution),((s=this.currentExecution)==null?void 0:s.id)===t&&(this.currentExecution=o.data.execution),o.data}catch(o){throw this.error=((e=(r=o.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to cancel execution",o}},async retryExecution(t){var s,r;this.error=null;try{return(await i.post(`/workflows/executions/${t}/retry`)).data}catch(e){throw this.error=((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to retry execution",e}},async fetchStatistics(){var t,s;this.loadingStatistics=!0,this.error=null;try{const r=await i.get("/workflows/statistics");return this.statistics=r.data.statistics,this.statistics}catch(r){throw this.error=((s=(t=r.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to fetch statistics",r}finally{this.loadingStatistics=!1}},setFilters(t){this.filters={...this.filters,...t}},setExecutionsFilters(t){this.executionsFilters={...this.executionsFilters,...t}},resetFilters(){this.filters={status:null,triggerType:null,search:""}},resetExecutionsFilters(){this.executionsFilters={status:null,workflowId:null,customerId:null,conversationId:null,dateFrom:null,dateTo:null}},clearCurrentWorkflow(){this.currentWorkflow=null,this.currentStep=null},clearCurrentExecution(){this.currentExecution=null,this.executionLogs=[]}}});var w={name:"Dropdown",extends:u,mounted:function(){console.warn("Deprecated since v4. Use Select component instead.")}};export{w as s,h as u};
