import{q as Fe,a9 as qe,r as x,c as le,C as Oe,o as je,a as He,b as r,e as t,g as d,F as M,k as N,Z as j,i,j as S,t as V,y as D,h as m,A as Ge,p as ge,l as $,B as H,x as Je,w as be,z as Ke,v as Ze,X as Qe,m as n,n as E}from"./app-BPtEyV-V.js";import{u as et,s as L}from"./index-DCpY7pkx.js";import{s as tt}from"./index-CZ4_66xC.js";import{s as P}from"./index-GTHSWzq9.js";import{s as G}from"./index-hZk-oVL7.js";import{s as ae}from"./index-D2Y8cDrP.js";import{s as xe}from"./index-Drn_ie8h.js";import{s as ot}from"./index-BIro60HF.js";import{_ as lt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DNu7Aii_.js";import"./index-BIYalJJ9.js";import"./index-BLg1sZhZ.js";const at={class:"flex h-[calc(100vh-8rem)] gap-4"},st={class:"w-72 flex flex-col overflow-hidden bg-white dark:bg-surface-800 border border-surface-200 dark:border-surface-700 rounded-lg"},nt={class:"flex-1 overflow-y-auto p-3 space-y-4"},it={class:"space-y-2"},rt=["onDragstart"],ut={class:"flex items-center gap-2"},dt={class:"text-sm font-medium text-surface-900 dark:text-surface-0"},ct={class:"space-y-2"},ft=["onDragstart"],pt={class:"flex items-center gap-2"},mt={class:"text-sm font-medium text-surface-900 dark:text-surface-0"},vt={class:"space-y-2"},gt=["onDragstart"],bt={class:"flex items-center gap-2"},xt={class:"text-sm font-medium text-surface-900 dark:text-surface-0"},yt={class:"flex-1 flex flex-col overflow-hidden bg-white dark:bg-surface-800 border border-surface-200 dark:border-surface-700 rounded-lg workflow-canvas"},kt={class:"flex items-center justify-between p-3 border-b border-surface-200 dark:border-surface-700"},_t={class:"flex items-center gap-4"},wt={class:"font-semibold text-surface-900 dark:text-surface-0"},ht={class:"text-xs text-surface-500 dark:text-surface-400"},Ct={class:"flex items-center gap-2"},Vt={class:"flex items-center gap-1 px-3 py-1 border-b border-surface-200 dark:border-surface-700"},Tt={class:"text-xs text-surface-600 dark:text-surface-400 min-w-[40px] text-center"},St={key:0,class:"absolute inset-0 flex items-center justify-center bg-surface-50/80 dark:bg-surface-900/80 z-10"},$t={class:"text-center"},Dt={class:"absolute inset-0 w-full h-full",style:{"z-index":"1","pointer-events":"none"}},Mt=["d","onClick"],Lt=["d"],Yt=["x","y"],It=["transform","onClick"],Ut=["d"],Et=["onMousedown","onClick"],Wt={class:"flex items-center gap-2"},Xt={class:"flex-1 min-w-0"},Rt={class:"text-sm font-medium text-surface-900 dark:text-surface-0 truncate"},At={class:"text-xs text-surface-500 dark:text-surface-400 truncate"},zt=["onMousedown"],Nt=["onMousedown"],Pt=["onMousedown"],Bt={key:0,class:"w-80 flex flex-col overflow-hidden bg-white dark:bg-surface-800 border border-surface-200 dark:border-surface-700 rounded-lg"},Ft={class:"p-3 border-b border-surface-200 dark:border-surface-700 flex items-center justify-between"},qt={class:"flex-1 overflow-y-auto p-4 space-y-4"},Ot={key:0},jt={key:1},Ht={key:2,class:"space-y-4"},Gt={key:0},Jt={key:1,class:"p-3 bg-surface-50 dark:bg-surface-700 rounded-lg"},Kt={class:"text-xs text-surface-600 dark:text-surface-400"},Zt={key:3,class:"space-y-4"},Qt={key:0},eo={class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"},to={key:1},oo={key:2},lo={class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"},ao={key:3,class:"space-y-2"},so={class:"flex items-center gap-2 text-sm text-surface-700 dark:text-surface-300"},no={key:4},io={class:"flex gap-2 items-center"},ro={key:5},uo={key:4},co={key:5},fo={key:6},po={key:7,class:"space-y-4"},mo={key:0,class:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},vo={class:"text-xs text-red-700 dark:text-red-400"},go={key:1,class:"w-80 flex flex-col overflow-hidden bg-white dark:bg-surface-800 border border-surface-200 dark:border-surface-700 rounded-lg"},bo={class:"space-y-4"},xo={__name:"Edit",setup(yo){const ye=Ze(),ke=Oe(),W=Fe(),se=qe(),k=et(),y=x(null),J=x(!0),B=x(null),_=x([]),a=x(null),F=x(null),X=x(!1),R=x({customer_id:null,conversation_id:null}),K=x([]),ne=x({width:2e3,height:1500}),p=x(1),Z=x(!1),Y=x(!1),q=x(null),b=x(null),I=x(null),Q=x({x:0,y:0}),U=x(null),A=le(()=>ke.params.id),_e=le(()=>{const o=k.triggerTypes.find(e=>{var s;return e.value===((s=B.value)==null?void 0:s.trigger_type)});return(o==null?void 0:o.label)||""}),we=[{value:"equals",label:"Equals"},{value:"not_equals",label:"Not Equals"},{value:"contains",label:"Contains"},{value:"not_contains",label:"Does Not Contain"},{value:"starts_with",label:"Starts With"},{value:"ends_with",label:"Ends With"},{value:"greater_than",label:"Greater Than"},{value:"greater_equal",label:"Greater Than or Equal"},{value:"less_than",label:"Less Than"},{value:"less_equal",label:"Less Than or Equal"},{value:"is_empty",label:"Is Empty"},{value:"is_not_empty",label:"Is Not Empty"},{value:"matches_regex",label:"Matches Regex"}];function he(o){return{customer_attribute:[{value:"customer_type",label:"Customer Type (new/returning/vip)"},{value:"total_message_count",label:"Total Message Count"},{value:"conversation_count",label:"Conversation Count"},{value:"name",label:"Name"},{value:"email",label:"Email"},{value:"phone",label:"Phone"},{value:"language",label:"Language"},{value:"tags",label:"Tags"},{value:"platform",label:"Platform"}],conversation_attribute:[{value:"status",label:"Status"},{value:"priority",label:"Priority"},{value:"platform",label:"Platform"},{value:"message_count",label:"Message Count"},{value:"is_ai_handling",label:"AI Handling"},{value:"assigned_to",label:"Assigned Agent"}],message_content:[{value:"text",label:"Text Content"},{value:"type",label:"Message Type"}],intent_value:k.intentTypes||[],time_of_day:[{value:"hour",label:"Hour"}],day_of_week:[{value:"day",label:"Day"}]}[o]||[]}function Ce(o){return{customer_attribute:"e.g., name, email, tags, language",conversation_attribute:"e.g., status, priority, platform, message_count",message_content:"e.g., text",time_of_day:"e.g., hour",day_of_week:"e.g., day"}[o]||"Field name"}async function Ve(){try{const o=await Ke.get("/api/ai-agents");K.value=o.data.data.filter(e=>e.is_active)}catch(o){console.error("Failed to load AI personalities:",o)}}function Te(o){const e=K.value.find(s=>s.id===o);return(e==null?void 0:e.name)||"Unknown"}const ie=le(()=>{const o=[];return _.value.forEach(e=>{e.next_steps&&Array.isArray(e.next_steps)&&e.next_steps.forEach((s,u)=>{var g,f,h,T,l,C;const c=_.value.find(z=>z.id===(s.step_id||s));if(c){let w;e.step_type==="condition"&&s.condition==="true"?w=(((g=e.position)==null?void 0:g.x)||0)+180*.3:e.step_type==="condition"&&s.condition==="false"?w=(((f=e.position)==null?void 0:f.x)||0)+180*.7:w=(((h=e.position)==null?void 0:h.x)||0)+90;const pe=(((T=e.position)==null?void 0:T.y)||0)+80,me=(((l=c.position)==null?void 0:l.x)||0)+90,ve=((C=c.position)==null?void 0:C.y)||0;o.push({id:`${e.id}-${c.id}`,fromStepId:e.id,toStepId:c.id,condition:s.condition||null,fromX:w,fromY:pe,toX:me,toY:ve,label:s.condition==="false"?"No":s.condition==="true"?"Yes":"",labelX:(w+me)/2,labelY:(pe+ve)/2-10})}})}),o});function Se(){p.value=Math.min(2,p.value+.1)}function $e(){p.value=Math.max(.25,p.value-.1)}function De(){if(!y.value||_.value.length===0){p.value=1;return}let o=0,e=0;_.value.forEach(g=>{var f,h;o=Math.max(o,(((f=g.position)==null?void 0:f.x)||0)+200),e=Math.max(e,(((h=g.position)==null?void 0:h.y)||0)+100)});const s=y.value.getBoundingClientRect(),u=(s.width-40)/o,c=(s.height-40)/e;p.value=Math.max(.25,Math.min(2,Math.min(u,c)))}function Me(o){if(o.ctrlKey||o.metaKey){o.preventDefault();const e=o.deltaY>0?-.05:.05;p.value=Math.max(.25,Math.min(2,p.value+e))}}function ee(o){return k.stepTypes.filter(e=>e.category===o)}function Le(o){const e=k.stepTypes.find(u=>u.value===o.step_type);return{blue:"border-blue-500",green:"border-green-500",yellow:"border-yellow-500",gray:"border-surface-400",purple:"border-purple-500",orange:"border-orange-500",cyan:"border-cyan-500"}[e==null?void 0:e.color]||"border-surface-400"}function Ye(o){const e=k.stepTypes.find(s=>s.value===o);return(e==null?void 0:e.icon)||"pi pi-cog"}function Ie(o){const e=k.stepTypes.find(s=>s.value===o);return(e==null?void 0:e.label)||o}function te(o,e){o.dataTransfer.effectAllowed="copy",o.dataTransfer.setData("stepType",e.value),o.dataTransfer.setData("stepLabel",e.label)}function Ue(o){o.preventDefault();const e=o.dataTransfer.getData("stepType"),s=o.dataTransfer.getData("stepLabel");if(!e)return;const u=y.value.getBoundingClientRect(),c=(o.clientX-u.left+y.value.scrollLeft)/p.value-90,g=(o.clientY-u.top+y.value.scrollTop)/p.value-30,f={id:`step-${Date.now()}`,step_type:e,name:s,position:{x:c,y:g},config:re(e),next_steps:[]};_.value.push(f),a.value=f,F.value=f.id}function re(o){return{trigger:{},action:{action_type:"send_message",message:""},condition:{condition_type:"customer_attribute",field:"",operator:"equals",value:""},delay:{delay_minutes:30},parallel:{branches:[]},loop:{iterations:1,loop_step_id:null},custom_code:{code:"",description:""}}[o]||{}}function Ee(o,e){var g,f;if(Y.value)return;Z.value=!0,q.value=e;const s=y.value.getBoundingClientRect(),u=(o.clientX-s.left+y.value.scrollLeft)/p.value,c=(o.clientY-s.top+y.value.scrollTop)/p.value;Q.value={x:u-(((g=e.position)==null?void 0:g.x)||0),y:c-(((f=e.position)==null?void 0:f.y)||0)}}function We(o){a.value=o,F.value=o.id}function Xe(o){const e=_.value.find(s=>s.id===o);se.require({message:`Are you sure you want to delete "${(e==null?void 0:e.name)||"this step"}"?`,header:"Delete Step",icon:"pi pi-exclamation-triangle",acceptLabel:"Delete",rejectLabel:"Cancel",acceptClass:"p-button-danger",accept:()=>{var s;_.value.forEach(u=>{u.next_steps&&(u.next_steps=u.next_steps.filter(c=>(c.step_id||c)!==o))}),_.value=_.value.filter(u=>u.id!==o),((s=a.value)==null?void 0:s.id)===o&&(a.value=null,F.value=null)}})}function Re(o){const e=_.value.find(s=>s.id===o.fromStepId);!e||!e.next_steps||(e.next_steps=e.next_steps.filter(s=>{const u=s.step_id||s,c=u===o.toStepId;return o.condition!==null&&o.condition!==void 0?!(u===o.toStepId&&s.condition===o.condition):!c}),W.add({severity:"success",summary:"Connection Removed",detail:"The connection has been removed",life:2e3}))}function ue(o){se.require({message:"Remove this connection?",header:"Remove Connection",icon:"pi pi-info-circle",acceptLabel:"Remove",rejectLabel:"Cancel",acceptClass:"p-button-danger",accept:()=>Re(o)})}const O=x(null);function oe(o,e,s=null){o.preventDefault(),Y.value=!0,b.value=e,O.value=s}function v(){var o,e;((o=a.value)==null?void 0:o.step_type)==="custom_code"&&((e=a.value.config)!=null&&e.code)&&Ae(a.value.config.code)}function Ae(o){if(U.value=null,!o||!o.trim()){U.value="Code cannot be empty.";return}if(!o.includes("return")){U.value="Code must contain a return statement.";return}try{new Function("customer","conversation","message",o)}catch(e){U.value=`Syntax error: ${e.message}`}}function de(o){const e=(o.fromY+o.toY)/2;return`M ${o.fromX} ${o.fromY} C ${o.fromX} ${e}, ${o.toX} ${e}, ${o.toX} ${o.toY}`}function ze(){const o={workflow_definition:{steps:_.value,connections:ie.value}};k.updateWorkflow(A.value,o).then(()=>{W.add({severity:"success",summary:"Saved",detail:"Workflow saved successfully"})}).catch(e=>{var s,u;W.add({severity:"error",summary:"Error",detail:((u=(s=e.response)==null?void 0:s.data)==null?void 0:u.message)||"Failed to save workflow"})})}function Ne(){k.testWorkflow(A.value,R.value).then(o=>{W.add({severity:o.success?"success":"warn",summary:o.success?"Test Passed":"Test Completed",detail:o.success?"Workflow test completed successfully":"Workflow test completed with some issues"}),X.value=!1}).catch(o=>{var e,s;W.add({severity:"error",summary:"Test Failed",detail:((s=(e=o.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to test workflow"})})}function Pe(){ye.push("/workflows")}function ce(o){if(Z.value&&q.value){const e=y.value.getBoundingClientRect(),s=(o.clientX-e.left+y.value.scrollLeft)/p.value-Q.value.x,u=(o.clientY-e.top+y.value.scrollTop)/p.value-Q.value.y;q.value.position={x:Math.max(0,s),y:Math.max(0,u)}}if(Y.value&&b.value){const e=y.value.getBoundingClientRect();I.value={x:(o.clientX-e.left+y.value.scrollLeft)/p.value,y:(o.clientY-e.top+y.value.scrollTop)/p.value}}}function Be(){var g,f;if(!b.value||!I.value)return"";const o=(((g=b.value.position)==null?void 0:g.x)||0)+90,e=(((f=b.value.position)==null?void 0:f.y)||0)+80,s=I.value.x,u=I.value.y,c=(e+u)/2;return`M ${o} ${e} C ${o} ${c}, ${s} ${c}, ${s} ${u}`}function fe(o){if(Y.value&&b.value){const e=y.value.getBoundingClientRect(),s=(o.clientX-e.left+y.value.scrollLeft)/p.value,u=(o.clientY-e.top+y.value.scrollTop)/p.value,c=_.value.find(g=>{var T,l;const f=((T=g.position)==null?void 0:T.x)||0,h=((l=g.position)==null?void 0:l.y)||0;return s>=f&&s<=f+180&&u>=h&&u<=h+80});if(c&&c.id!==b.value.id&&(b.value.next_steps||(b.value.next_steps=[]),!b.value.next_steps.find(f=>f.step_id===c.id))){const f=b.value.step_type==="condition",h=["condition","parallel"].includes(b.value.step_type);f&&O.value?(b.value.next_steps=b.value.next_steps.filter(T=>T.condition!==O.value),b.value.next_steps.push({step_id:c.id,condition:O.value})):h?b.value.next_steps.push({step_id:c.id}):b.value.next_steps=[{step_id:c.id}]}}Z.value=!1,Y.value=!1,q.value=null,b.value=null,I.value=null}return je(async()=>{var o;J.value=!0;try{await Ve(),A.value&&A.value!=="new"?(await k.fetchWorkflow(A.value),B.value=k.currentWorkflow,_.value=((o=B.value)==null?void 0:o.steps)||[]):_.value=[{id:`step-${Date.now()}`,step_type:"trigger",name:"Trigger",position:{x:400,y:50},config:re("trigger"),next_steps:[]}]}finally{J.value=!1}window.addEventListener("mousemove",ce),window.addEventListener("mouseup",fe)}),He(()=>{window.removeEventListener("mousemove",ce),window.removeEventListener("mouseup",fe)}),(o,e)=>{var c,g,f,h,T;const s=Je("Checkbox"),u=Qe("tooltip");return n(),r(M,null,[t("div",at,[t("div",st,[e[31]||(e[31]=t("div",{class:"p-3 border-b border-surface-200 dark:border-surface-700"},[t("h3",{class:"font-semibold text-surface-900 dark:text-surface-0"},"Steps")],-1)),t("div",nt,[t("div",null,[e[28]||(e[28]=t("h4",{class:"text-xs font-semibold text-surface-500 dark:text-surface-400 uppercase tracking-wide mb-2"}," Triggers ",-1)),t("div",it,[(n(!0),r(M,null,N(ee("triggers"),l=>(n(),r("div",{key:l.value,draggable:"true",onDragstart:C=>te(C,l),class:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg cursor-grab hover:border-blue-400 dark:hover:border-blue-600 transition-colors"},[t("div",ut,[t("i",{class:E([l.icon,"text-blue-600 dark:text-blue-400"])},null,2),t("span",dt,V(l.label),1)])],40,rt))),128))])]),t("div",null,[e[29]||(e[29]=t("h4",{class:"text-xs font-semibold text-surface-500 dark:text-surface-400 uppercase tracking-wide mb-2"}," Actions ",-1)),t("div",ct,[(n(!0),r(M,null,N(ee("actions"),l=>(n(),r("div",{key:l.value,draggable:"true",onDragstart:C=>te(C,l),class:"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg cursor-grab hover:border-green-400 dark:hover:border-green-600 transition-colors"},[t("div",pt,[t("i",{class:E([l.icon,"text-green-600 dark:text-green-400"])},null,2),t("span",mt,V(l.label),1)])],40,ft))),128))])]),t("div",null,[e[30]||(e[30]=t("h4",{class:"text-xs font-semibold text-surface-500 dark:text-surface-400 uppercase tracking-wide mb-2"}," Logic ",-1)),t("div",vt,[(n(!0),r(M,null,N(ee("logic"),l=>(n(),r("div",{key:l.value,draggable:"true",onDragstart:C=>te(C,l),class:"p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg cursor-grab hover:border-yellow-400 dark:hover:border-yellow-600 transition-colors"},[t("div",bt,[t("i",{class:E([l.icon,"text-yellow-600 dark:text-yellow-400"])},null,2),t("span",xt,V(l.label),1)])],40,gt))),128))])])])]),t("div",yt,[t("div",kt,[t("div",_t,[j(d(i(S),{icon:"pi pi-arrow-left",outlined:"",rounded:"",onClick:Pe},null,512),[[u,"Back to Workflows"]]),t("div",null,[t("h3",wt,V(((c=B.value)==null?void 0:c.name)||"New Workflow"),1),t("p",ht,V(_e.value),1)])]),t("div",Ct,[d(i(S),{label:"Test",icon:"pi pi-play",outlined:"",onClick:e[0]||(e[0]=l=>X.value=!0)}),d(i(S),{label:"Save",icon:"pi pi-check",onClick:ze,loading:i(k).saving},null,8,["loading"])])]),t("div",Vt,[d(i(S),{icon:"pi pi-minus",text:"",size:"small",onClick:$e,disabled:p.value<=.25},null,8,["disabled"]),t("span",Tt,V(Math.round(p.value*100))+"%",1),d(i(S),{icon:"pi pi-plus",text:"",size:"small",onClick:Se,disabled:p.value>=2},null,8,["disabled"]),d(i(S),{label:"Fit",text:"",size:"small",onClick:De,class:"ml-2"})]),t("div",{ref_key:"canvasRef",ref:y,class:"flex-1 relative overflow-auto bg-surface-50 dark:bg-surface-900",onDrop:Ue,onDragover:e[1]||(e[1]=D(()=>{},["prevent"])),onDragenter:e[2]||(e[2]=D(()=>{},["prevent"])),onWheel:Me},[J.value?(n(),r("div",St,[t("div",$t,[d(i(Ge),{style:{width:"50px",height:"50px"}}),e[32]||(e[32]=t("p",{class:"mt-3 text-surface-500 dark:text-surface-400 text-sm"},"Loading workflow...",-1))])])):m("",!0),e[38]||(e[38]=t("div",{class:"absolute inset-0 opacity-10 pointer-events-none",style:{"background-image":"radial-gradient(circle, currentColor 1px, transparent 1px)","background-size":"20px 20px"}},null,-1)),t("div",{class:"min-w-full min-h-full p-8 origin-top-left",style:ge({width:ne.value.width+"px",height:ne.value.height+"px",transform:`scale(${p.value})`})},[(n(),r("svg",Dt,[e[34]||(e[34]=t("defs",null,[t("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto"},[t("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#94a3b8"})])],-1)),(n(!0),r(M,null,N(ie.value,l=>(n(),r("g",{key:l.id,class:"connection-group",style:{"pointer-events":"auto"}},[t("path",{d:de(l),fill:"none",stroke:"transparent","stroke-width":"14",class:"cursor-pointer",style:{"pointer-events":"stroke"},onClick:D(C=>ue(l),["stop"])},null,8,Mt),t("path",{d:de(l),fill:"none",stroke:"#94a3b8","stroke-width":"2","marker-end":"url(#arrowhead)",class:"pointer-events-none connection-line",style:{transition:"stroke 0.2s"}},null,8,Lt),l.label?(n(),r("text",{key:0,x:l.labelX,y:l.labelY,class:"text-xs fill-surface-600 dark:fill-surface-400 pointer-events-none","text-anchor":"middle"},V(l.label),9,Yt)):m("",!0),j((n(),r("g",{class:"connection-delete-btn",transform:`translate(${l.labelX}, ${l.labelY+20})`,onClick:D(C=>ue(l),["stop"]),style:{cursor:"pointer","pointer-events":"auto"}},[...e[33]||(e[33]=[t("circle",{r:"10",fill:"#ef4444",style:{"pointer-events":"auto"}},null,-1),t("text",{"text-anchor":"middle","dominant-baseline":"central",fill:"white","font-size":"12","font-weight":"bold",class:"pointer-events-none"},"Ã—",-1)])],8,It)),[[u,"Click to remove connection",void 0,{bottom:!0}]])]))),128)),Y.value&&b.value&&I.value?(n(),r("path",{key:0,d:Be(),fill:"none",stroke:"#3b82f6","stroke-width":"2","stroke-dasharray":"6 3","marker-end":"url(#arrowhead)"},null,8,Ut)):m("",!0)])),(n(!0),r(M,null,N(_.value,l=>{var C,z;return n(),r("div",{key:l.id,class:E(["absolute cursor-move",{"ring-2 ring-primary-500":F.value===l.id}]),style:ge({left:((C=l.position)==null?void 0:C.x)+"px",top:((z=l.position)==null?void 0:z.y)+"px"}),onMousedown:w=>Ee(w,l),onClick:w=>We(l)},[t("div",{class:E(["workflow-step p-3 bg-white dark:bg-surface-800 border-2 rounded-lg shadow-lg min-w-[180px]",Le(l)])},[t("div",Wt,[t("i",{class:E([Ye(l.step_type),"text-lg"])},null,2),t("div",Xt,[t("p",Rt,V(l.name),1),t("p",At,V(Ie(l.step_type)),1)]),d(i(S),{icon:"pi pi-trash",text:"",size:"small",severity:"danger",onClick:D(w=>Xe(l.id),["stop"])},null,8,["onClick"])])],2),e[37]||(e[37]=t("div",{class:"absolute left-1/2 -translate-x-1/2 -top-2 w-4 h-4 rounded-full bg-surface-400 hover:bg-primary-500 cursor-crosshair"},null,-1)),l.step_type!=="condition"?(n(),r("div",{key:0,class:"absolute left-1/2 -translate-x-1/2 -bottom-2 w-4 h-4 rounded-full bg-surface-400 hover:bg-primary-500 cursor-crosshair",onMousedown:D(w=>oe(w,l),["stop"])},null,40,zt)):m("",!0),l.step_type==="condition"?(n(),r(M,{key:1},[j(t("div",{class:"absolute -bottom-2 w-4 h-4 rounded-full bg-green-500 hover:bg-green-600 cursor-crosshair",style:{left:"30%"},onMousedown:D(w=>oe(w,l,"true"),["stop"])},null,40,Nt),[[u,"Yes",void 0,{bottom:!0}]]),j(t("div",{class:"absolute -bottom-2 w-4 h-4 rounded-full bg-red-500 hover:bg-red-600 cursor-crosshair",style:{left:"70%"},onMousedown:D(w=>oe(w,l,"false"),["stop"])},null,40,Pt),[[u,"No",void 0,{bottom:!0}]]),e[35]||(e[35]=t("span",{class:"absolute -bottom-6 text-[10px] text-green-600 dark:text-green-400 font-medium",style:{left:"25%"}},"Yes",-1)),e[36]||(e[36]=t("span",{class:"absolute -bottom-6 text-[10px] text-red-600 dark:text-red-400 font-medium",style:{left:"67%"}},"No",-1))],64)):m("",!0)],46,Et)}),128))],4)],544)]),a.value?(n(),r("div",Bt,[t("div",Ft,[e[39]||(e[39]=t("h3",{class:"font-semibold text-surface-900 dark:text-surface-0"},"Properties",-1)),d(i(S),{icon:"pi pi-times",text:"",onClick:e[3]||(e[3]=l=>a.value=null)})]),t("div",qt,[t("div",null,[e[40]||(e[40]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Step Name ",-1)),d(i(P),{modelValue:a.value.name,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.name=l),class:"w-full",onInput:v},null,8,["modelValue"])]),a.value.step_type==="action"?(n(),r("div",Ot,[e[41]||(e[41]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Action Type ",-1)),d(i(L),{modelValue:a.value.config.action_type,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.config.action_type=l),options:i(k).actionTypes,optionLabel:"label",optionValue:"value",class:"w-full",onChange:v},null,8,["modelValue","options"])])):m("",!0),a.value.step_type==="action"&&((g=a.value.config)==null?void 0:g.action_type)==="send_message"?(n(),r("div",jt,[e[42]||(e[42]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Message Template ",-1)),d(i(G),{modelValue:a.value.config.message,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.config.message=l),rows:"4",class:"w-full",placeholder:"Hi {{customer_name}}, thanks for reaching out!",onInput:v},null,8,["modelValue"]),e[43]||(e[43]=t("p",{class:"text-xs text-surface-500 mt-1"}," Variables: {{customer_name}}, {{customer_email}}, {{current_date}} ",-1))])):m("",!0),a.value.step_type==="action"&&((f=a.value.config)==null?void 0:f.action_type)==="send_ai_response"?(n(),r("div",Ht,[t("div",null,[e[44]||(e[44]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," AI Personality ",-1)),d(i(L),{modelValue:a.value.config.ai_agent_id,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.config.ai_agent_id=l),options:K.value,optionLabel:"name",optionValue:"id",placeholder:"Select personality (optional)",class:"w-full",showClear:"",onChange:v},null,8,["modelValue","options"]),e[45]||(e[45]=t("p",{class:"text-xs text-surface-500 mt-1"}," Choose a personality to use, or leave empty to use the system prompt below. ",-1))]),a.value.config.ai_agent_id?(n(),r("div",Jt,[t("p",Kt,[e[48]||(e[48]=t("i",{class:"pi pi-info-circle mr-1"},null,-1)),e[49]||(e[49]=$(" Using personality: ",-1)),t("strong",null,V(Te(a.value.config.ai_agent_id)),1)])])):(n(),r("div",Gt,[e[46]||(e[46]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," System Prompt ",-1)),d(i(G),{modelValue:a.value.config.system_prompt,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.config.system_prompt=l),rows:"4",class:"w-full",placeholder:"You are a helpful customer service assistant...",onInput:v},null,8,["modelValue"]),e[47]||(e[47]=t("p",{class:"text-xs text-surface-500 mt-1"}," Custom prompt for this step. Only used when no personality is selected. ",-1))]))])):m("",!0),a.value.step_type==="condition"?(n(),r("div",Zt,[t("div",null,[e[50]||(e[50]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Condition Type ",-1)),d(i(L),{modelValue:a.value.config.condition_type,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.config.condition_type=l),options:i(k).conditionTypes,optionLabel:"label",optionValue:"value",class:"w-full",onChange:v},null,8,["modelValue","options"])]),a.value.config.condition_type&&a.value.config.condition_type!=="ai_condition"?(n(),r("div",Qt,[t("label",eo,V(a.value.config.condition_type==="intent_value"?"Intent":"Field"),1),a.value.config.condition_type==="intent_value"?(n(),H(i(L),{key:0,modelValue:a.value.config.intent,"onUpdate:modelValue":e[10]||(e[10]=l=>a.value.config.intent=l),options:i(k).intentTypes,optionLabel:"label",optionValue:"value",class:"w-full",placeholder:"Select intent",onChange:v},null,8,["modelValue","options"])):(n(),H(i(L),{key:1,modelValue:a.value.config.field,"onUpdate:modelValue":e[11]||(e[11]=l=>a.value.config.field=l),options:he(a.value.config.condition_type),optionLabel:"label",optionValue:"value",class:"w-full",editable:!0,placeholder:Ce(a.value.config.condition_type),onChange:v},null,8,["modelValue","options","placeholder"]))])):m("",!0),a.value.config.condition_type&&a.value.config.condition_type!=="ai_condition"&&a.value.config.condition_type!=="intent_value"?(n(),r("div",to,[e[51]||(e[51]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Operator ",-1)),d(i(L),{modelValue:a.value.config.operator,"onUpdate:modelValue":e[12]||(e[12]=l=>a.value.config.operator=l),options:we,optionLabel:"label",optionValue:"value",class:"w-full",onChange:v},null,8,["modelValue"])])):m("",!0),a.value.config.condition_type&&a.value.config.condition_type!=="time_of_day"&&a.value.config.condition_type!=="day_of_week"?(n(),r("div",oo,[t("label",lo,V(a.value.config.condition_type==="ai_condition"?"AI Prompt":"Value"),1),a.value.config.condition_type==="ai_condition"?(n(),H(i(G),{key:0,modelValue:a.value.config.ai_prompt,"onUpdate:modelValue":e[13]||(e[13]=l=>a.value.config.ai_prompt=l),rows:"3",class:"w-full",placeholder:"e.g., Classify the customer intent into one of these categories...",onInput:v},null,8,["modelValue"])):a.value.config.condition_type!=="intent_value"?(n(),H(i(P),{key:1,modelValue:a.value.config.value,"onUpdate:modelValue":e[14]||(e[14]=l=>a.value.config.value=l),class:"w-full",placeholder:"Value to compare",onInput:v},null,8,["modelValue"])):m("",!0)])):m("",!0),a.value.config.condition_type==="ai_condition"?(n(),r("div",ao,[t("label",so,[d(s,{modelValue:a.value.config.return_result,"onUpdate:modelValue":e[15]||(e[15]=l=>a.value.config.return_result=l),binary:"",onChange:v},null,8,["modelValue"]),e[52]||(e[52]=$(" Return structured result (for intent classification) ",-1))]),e[53]||(e[53]=t("small",{class:"text-surface-500 block"},"When enabled, AI returns JSON data instead of true/false. Use for intent classification.",-1))])):m("",!0),a.value.config.condition_type==="time_of_day"?(n(),r("div",no,[e[55]||(e[55]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Time Range (24h format) ",-1)),t("div",io,[d(i(P),{modelValue:a.value.config.time_from,"onUpdate:modelValue":e[16]||(e[16]=l=>a.value.config.time_from=l),class:"w-full",placeholder:"09:00",onInput:v},null,8,["modelValue"]),e[54]||(e[54]=t("span",{class:"text-surface-500"},"to",-1)),d(i(P),{modelValue:a.value.config.time_to,"onUpdate:modelValue":e[17]||(e[17]=l=>a.value.config.time_to=l),class:"w-full",placeholder:"17:00",onInput:v},null,8,["modelValue"])])])):m("",!0),a.value.config.condition_type==="day_of_week"?(n(),r("div",ro,[e[56]||(e[56]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Days ",-1)),d(i(xe),{modelValue:a.value.config.days,"onUpdate:modelValue":[e[18]||(e[18]=l=>a.value.config.days=l),v],class:"w-full",placeholder:"e.g., Monday"},null,8,["modelValue"])])):m("",!0),e[57]||(e[57]=t("p",{class:"text-xs text-surface-500 mt-1"},[t("i",{class:"pi pi-info-circle mr-1"}),$(" Drag from the "),t("span",{class:"text-green-600 font-medium"},"green dot"),$(" (Yes) or "),t("span",{class:"text-red-600 font-medium"},"red dot"),$(" (No) to connect to the next step. ")],-1))])):m("",!0),a.value.step_type==="delay"?(n(),r("div",uo,[e[58]||(e[58]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Delay Duration ",-1)),d(i(ae),{modelValue:a.value.config.delay_minutes,"onUpdate:modelValue":e[19]||(e[19]=l=>a.value.config.delay_minutes=l),min:1,max:10080,class:"w-full",onInput:v},null,8,["modelValue"]),e[59]||(e[59]=t("p",{class:"text-xs text-surface-500 mt-1"},"Minutes to wait before continuing",-1))])):m("",!0),a.value.step_type==="action"&&["add_tag","remove_tag"].includes((h=a.value.config)==null?void 0:h.action_type)?(n(),r("div",co,[e[60]||(e[60]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Tags ",-1)),d(i(xe),{modelValue:a.value.config.tags,"onUpdate:modelValue":[e[20]||(e[20]=l=>a.value.config.tags=l),v],class:"w-full"},null,8,["modelValue"])])):m("",!0),a.value.step_type==="action"&&((T=a.value.config)==null?void 0:T.action_type)==="set_status"?(n(),r("div",fo,[e[61]||(e[61]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Status ",-1)),d(i(L),{modelValue:a.value.config.status,"onUpdate:modelValue":e[21]||(e[21]=l=>a.value.config.status=l),options:[{value:"open",label:"Open"},{value:"in_progress",label:"In Progress"},{value:"closed",label:"Closed"},{value:"escalated",label:"Escalated"}],optionLabel:"label",optionValue:"value",class:"w-full",onChange:v},null,8,["modelValue"])])):m("",!0),a.value.step_type==="custom_code"?(n(),r("div",po,[t("div",null,[e[62]||(e[62]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," JavaScript Code ",-1)),d(i(G),{modelValue:a.value.config.code,"onUpdate:modelValue":e[22]||(e[22]=l=>a.value.config.code=l),rows:"10",class:"w-full font-mono text-sm",placeholder:`// Write JavaScript code here.
// Available variables: customer, conversation, message
// Must return a value.
//
// Example:
// const name = customer.name || 'Guest';
// return { greeting: \`Hello \${name}!\` };`,onInput:v},null,8,["modelValue"])]),t("div",null,[e[63]||(e[63]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Description ",-1)),d(i(P),{modelValue:a.value.config.description,"onUpdate:modelValue":e[23]||(e[23]=l=>a.value.config.description=l),class:"w-full",placeholder:"What does this code do?",onInput:v},null,8,["modelValue"])]),e[65]||(e[65]=t("div",{class:"p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg"},[t("p",{class:"text-xs text-yellow-700 dark:text-yellow-400"},[t("i",{class:"pi pi-info-circle mr-1"}),$(" Code runs in a sandboxed environment. Must return a value. Available context: "),t("code",null,"customer"),$(", "),t("code",null,"conversation"),$(", "),t("code",null,"message"),$(". ")])],-1)),U.value?(n(),r("div",mo,[t("p",vo,[e[64]||(e[64]=t("i",{class:"pi pi-exclamation-triangle mr-1"},null,-1)),$(" "+V(U.value),1)])])):m("",!0)])):m("",!0)])])):(n(),r("div",go,[...e[66]||(e[66]=[t("div",{class:"flex-1 flex items-center justify-center p-8 text-center"},[t("div",null,[t("i",{class:"pi pi-cog text-4xl text-surface-300 dark:text-surface-600 mb-3"}),t("p",{class:"text-surface-500 dark:text-surface-400"},"Select a step to edit its properties")])],-1)])]))]),d(i(ot),{visible:X.value,"onUpdate:visible":e[27]||(e[27]=l=>X.value=l),header:"Test Workflow",modal:"",class:"w-full max-w-md"},{footer:be(()=>[d(i(S),{label:"Cancel",outlined:"",onClick:e[26]||(e[26]=l=>X.value=!1)}),d(i(S),{label:"Run Test",loading:i(k).testing,onClick:Ne},null,8,["loading"])]),default:be(()=>[t("div",bo,[t("div",null,[e[67]||(e[67]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Customer ID (Optional) ",-1)),d(i(ae),{modelValue:R.value.customer_id,"onUpdate:modelValue":e[24]||(e[24]=l=>R.value.customer_id=l),class:"w-full",placeholder:"Leave empty for simulation"},null,8,["modelValue"])]),t("div",null,[e[68]||(e[68]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Conversation ID (Optional) ",-1)),d(i(ae),{modelValue:R.value.conversation_id,"onUpdate:modelValue":e[25]||(e[25]=l=>R.value.conversation_id=l),class:"w-full",placeholder:"Leave empty for simulation"},null,8,["modelValue"])])])]),_:1},8,["visible"]),d(i(tt))],64)}}},Yo=lt(xo,[["__scopeId","data-v-32245c9b"]]);export{Yo as default};
