import{q as te,a9 as se,r as $,c as V,o as re,b as m,e as t,g as l,w as h,x as oe,i as s,j as c,t as u,B as D,h as _,A as ae,F as le,k as ie,v as de,X as ne,m as p,l as F,Z as y,y as x}from"./app-COZ50StM.js";import{u as ue,s as E}from"./index-DGgTftJO.js";import{s as A}from"./index-CXogGqNS.js";import{s as B}from"./index-D8SOZXLq.js";import{s as ce}from"./index-lWUrvOYP.js";import{s as pe}from"./index-D6-_aDNt.js";import{s as fe}from"./index-faQNcuJe.js";import{s as me}from"./index-C0zA7P76.js";import"./index-B0AQL8E4.js";import"./index-DZelkFbS.js";import"./index-Brg-r7B6.js";function ve(T,g=300){let d;return function(...C){clearTimeout(d),d=setTimeout(()=>T.apply(this,C),g)}}const ge={class:"p-6"},ke={class:"flex items-center justify-between mb-6"},xe={class:"flex gap-3"},be={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},ye={class:"p-4 bg-white dark:bg-surface-800 border border-surface-200 dark:border-surface-700 rounded-lg"},we={class:"flex items-center gap-3"},he={class:"text-2xl font-bold text-surface-900 dark:text-surface-0"},_e={class:"p-4 bg-white dark:bg-surface-800 border border-surface-200 dark:border-surface-700 rounded-lg"},Ce={class:"flex items-center gap-3"},We={class:"text-2xl font-bold text-surface-900 dark:text-surface-0"},$e={class:"p-4 bg-white dark:bg-surface-800 border border-surface-200 dark:border-surface-700 rounded-lg"},Ve={class:"flex items-center gap-3"},De={class:"text-2xl font-bold text-surface-900 dark:text-surface-0"},Fe={class:"p-4 bg-white dark:bg-surface-800 border border-surface-200 dark:border-surface-700 rounded-lg"},Ee={class:"flex items-center gap-3"},Te={class:"text-2xl font-bold text-surface-900 dark:text-surface-0"},Pe={class:"mb-6 p-4 bg-white dark:bg-surface-800 border border-surface-200 dark:border-surface-700 rounded-lg"},Se={class:"flex flex-wrap gap-4 items-center"},Le={class:"flex-1 min-w-[200px]"},Ue={class:"p-4 bg-white dark:bg-surface-800 border border-surface-200 dark:border-surface-700 rounded-lg"},Ne={key:0,class:"flex justify-center py-12"},je={key:1,class:"text-center py-12"},Ae={key:2,class:"space-y-3"},Be=["onClick"],Ie={class:"flex items-start justify-between"},Re={class:"flex-1"},qe={class:"flex items-center gap-3"},Me={class:"text-lg font-semibold text-surface-900 dark:text-surface-0"},Oe={key:0,class:"text-surface-600 dark:text-surface-400 mt-1"},Xe={class:"flex items-center gap-4 mt-3 text-sm text-surface-500 dark:text-surface-400"},Ze={key:0},ze={class:"flex items-center gap-2"},Ge={key:3,class:"flex justify-between items-center mt-6 pt-4 border-t border-surface-200 dark:border-surface-700"},He={class:"text-sm text-surface-600 dark:text-surface-400"},Je={class:"space-y-4"},Ke={class:"font-medium"},Qe={class:"text-sm text-surface-500"},Ye={class:"flex justify-end gap-3 mt-6"},ct={__name:"Index",setup(T){const g=de(),d=te(),C=se(),o=ue(),b=$(!1),w=$(null),v=$({name:"",description:"",trigger_type:"",status:"draft"}),I=[{value:"draft",label:"Draft"},{value:"inactive",label:"Inactive"},{value:"active",label:"Active"}],W=V(()=>o.triggerTypes),k=V(()=>o.statistics),R=V(()=>{if(!k.value||!k.value.total_executions)return 0;const a=k.value.successful_executions/k.value.total_executions*100;return Math.round(a)}),q=ve(()=>{o.fetchWorkflows()},300);function M(a){return{active:"success",inactive:"secondary",draft:"info"}[a]||"secondary"}function O(a){const e=W.value.find(i=>i.value===a);return(e==null?void 0:e.label)||a}function X(a){g.push(`/workflows/${a}`)}function Z(a){g.push(`/workflows/history?workflow_id=${a}`)}function z(a){g.push(`/workflows/${a}/edit`)}async function G(a){var e,i;try{await o.activateWorkflow(a),d.add({severity:"success",summary:"Activated",detail:"Workflow activated successfully"})}catch(n){d.add({severity:"error",summary:"Error",detail:((i=(e=n.response)==null?void 0:e.data)==null?void 0:i.message)||"Failed to activate workflow"})}}async function H(a){var e,i;try{await o.deactivateWorkflow(a),d.add({severity:"success",summary:"Deactivated",detail:"Workflow deactivated successfully"})}catch(n){d.add({severity:"error",summary:"Error",detail:((i=(e=n.response)==null?void 0:e.data)==null?void 0:i.message)||"Failed to deactivate workflow"})}}async function J(a){var e,i;try{await o.duplicateWorkflow(a),d.add({severity:"success",summary:"Duplicated",detail:"Workflow duplicated successfully"}),await o.fetchWorkflows()}catch(n){d.add({severity:"error",summary:"Error",detail:((i=(e=n.response)==null?void 0:e.data)==null?void 0:i.message)||"Failed to duplicate workflow"})}}function K(a){C.require({message:`Are you sure you want to delete "${a.name}"?`,header:"Delete Workflow",icon:"pi pi-exclamation-triangle",acceptLabel:"Delete",acceptIcon:"pi pi-trash",rejectLabel:"Cancel",acceptClass:"p-button-danger",accept:async()=>{var e,i;try{await o.deleteWorkflow(a.id),d.add({severity:"success",summary:"Deleted",detail:"Workflow deleted successfully"})}catch(n){d.add({severity:"error",summary:"Error",detail:((i=(e=n.response)==null?void 0:e.data)==null?void 0:i.message)||"Failed to delete workflow"})}}})}async function Q(){var a,e;try{if(w.value)await o.updateWorkflow(w.value.id,v.value),d.add({severity:"success",summary:"Updated",detail:"Workflow updated successfully"}),g.push(`/workflows/${w.value.id}/edit`);else{const i=await o.createWorkflow(v.value);d.add({severity:"success",summary:"Created",detail:"Workflow created successfully"}),b.value=!1,g.push(`/workflows/${i.workflow.id}/edit`)}}catch(i){d.add({severity:"error",summary:"Error",detail:((e=(a=i.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to save workflow"})}}function Y(){o.resetFilters(),o.fetchWorkflows()}function ee(a){o.fetchWorkflows(a.page+1)}return re(async()=>{try{await Promise.all([o.fetchWorkflows(),o.fetchStatistics()])}catch(a){console.error("Error loading workflows:",a),d.add({severity:"error",summary:"Error",detail:"Failed to load workflows. Please refresh the page."})}}),(a,e)=>{var P,S,L;const i=oe("router-link"),n=ne("tooltip");return p(),m("div",ge,[t("div",ke,[e[12]||(e[12]=t("div",null,[t("h1",{class:"text-2xl font-bold text-surface-900 dark:text-surface-0"},"Workflows"),t("p",{class:"text-surface-600 dark:text-surface-400 mt-1"},"Automate your customer service with visual workflows")],-1)),t("div",xe,[l(i,{to:"/workflows/history"},{default:h(()=>[l(s(c),{label:"Execution Logs",icon:"pi pi-history",outlined:""})]),_:1}),l(s(c),{label:"New Workflow",icon:"pi pi-plus",onClick:e[0]||(e[0]=r=>b.value=!0)})])]),t("div",be,[t("div",ye,[t("div",we,[e[14]||(e[14]=t("div",{class:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg"},[t("i",{class:"pi pi-sitemap text-blue-600 dark:text-blue-400 text-xl"})],-1)),t("div",null,[e[13]||(e[13]=t("p",{class:"text-surface-600 dark:text-surface-400 text-sm"},"Total Workflows",-1)),t("p",he,u(((P=k.value)==null?void 0:P.total_workflows)??0),1)])])]),t("div",_e,[t("div",Ce,[e[16]||(e[16]=t("div",{class:"p-3 bg-green-100 dark:bg-green-900/30 rounded-lg"},[t("i",{class:"pi pi-check-circle text-green-600 dark:text-green-400 text-xl"})],-1)),t("div",null,[e[15]||(e[15]=t("p",{class:"text-surface-600 dark:text-surface-400 text-sm"},"Active",-1)),t("p",We,u(((S=k.value)==null?void 0:S.active_workflows)??0),1)])])]),t("div",$e,[t("div",Ve,[e[18]||(e[18]=t("div",{class:"p-3 bg-purple-100 dark:bg-purple-900/30 rounded-lg"},[t("i",{class:"pi pi-play text-purple-600 dark:text-purple-400 text-xl"})],-1)),t("div",null,[e[17]||(e[17]=t("p",{class:"text-surface-600 dark:text-surface-400 text-sm"},"Total Executions",-1)),t("p",De,u(((L=k.value)==null?void 0:L.total_executions)??0),1)])])]),t("div",Fe,[t("div",Ee,[e[20]||(e[20]=t("div",{class:"p-3 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg"},[t("i",{class:"pi pi-thumbs-up text-emerald-600 dark:text-emerald-400 text-xl"})],-1)),t("div",null,[e[19]||(e[19]=t("p",{class:"text-surface-600 dark:text-surface-400 text-sm"},"Success Rate",-1)),t("p",Te,u(R.value)+"%",1)])])])]),t("div",Pe,[t("div",Se,[t("div",Le,[l(s(A),{modelValue:s(o).filters.search,"onUpdate:modelValue":e[1]||(e[1]=r=>s(o).filters.search=r),placeholder:"Search workflows...",class:"w-full",onInput:s(q)},null,8,["modelValue","onInput"])]),l(s(E),{modelValue:s(o).filters.status,"onUpdate:modelValue":e[2]||(e[2]=r=>s(o).filters.status=r),options:I,optionLabel:"label",optionValue:"value",placeholder:"Filter by status",class:"w-48",showClear:"",onChange:e[3]||(e[3]=r=>s(o).fetchWorkflows())},null,8,["modelValue"]),l(s(E),{modelValue:s(o).filters.triggerType,"onUpdate:modelValue":e[4]||(e[4]=r=>s(o).filters.triggerType=r),options:W.value,optionLabel:"label",optionValue:"value",placeholder:"Filter by trigger",class:"w-56",showClear:"",onChange:e[5]||(e[5]=r=>s(o).fetchWorkflows())},null,8,["modelValue","options"]),s(o).activeFiltersCount>0?(p(),D(s(c),{key:0,label:"Clear Filters",icon:"pi pi-filter-slash",outlined:"",onClick:Y})):_("",!0)])]),t("div",Ue,[s(o).loading&&s(o).workflows.length===0?(p(),m("div",Ne,[l(s(ae))])):s(o).workflows.length===0?(p(),m("div",je,[e[21]||(e[21]=t("i",{class:"pi pi-sitemap text-6xl text-surface-200 dark:text-surface-700 mb-4"},null,-1)),e[22]||(e[22]=t("h3",{class:"text-xl font-semibold text-surface-900 dark:text-surface-0 mb-2"},"No workflows yet",-1)),e[23]||(e[23]=t("p",{class:"text-surface-600 dark:text-surface-400 mb-4"},"Create your first workflow to automate customer service",-1)),l(s(c),{label:"Create Workflow",icon:"pi pi-plus",onClick:e[6]||(e[6]=r=>b.value=!0)})])):(p(),m("div",Ae,[(p(!0),m(le,null,ie(s(o).workflows,r=>{var U,N,j;return p(),m("div",{key:r.id,class:"p-4 border border-surface-200 dark:border-surface-700 rounded-lg hover:border-primary-500 dark:hover:border-primary-500 transition-colors cursor-pointer",onClick:f=>X(r.id)},[t("div",Ie,[t("div",Re,[t("div",qe,[t("h3",Me,u(r.name),1),l(s(B),{value:r.status,severity:M(r.status)},null,8,["value","severity"]),l(s(B),{value:O(r.trigger_type),severity:"secondary"},null,8,["value"])]),r.description?(p(),m("p",Oe,u(r.description),1)):_("",!0),t("div",Xe,[t("span",null,[e[24]||(e[24]=t("i",{class:"pi pi-cog mr-1"},null,-1)),F(" "+u(((U=r.stats)==null?void 0:U.step_count)??0)+" steps",1)]),l(i,{to:`/workflows/history?workflow_id=${r.id}`,class:"hover:text-primary-500 transition-colors"},{default:h(()=>{var f;return[e[25]||(e[25]=t("i",{class:"pi pi-play mr-1"},null,-1)),F(" "+u(((f=r.stats)==null?void 0:f.total_executions)??0)+" runs ",1)]}),_:2},1032,["to"]),(N=r.stats)!=null&&N.successful_executions?(p(),m("span",Ze,[e[26]||(e[26]=t("i",{class:"pi pi-check mr-1 text-green-500"},null,-1)),F(" "+u((j=r.stats)==null?void 0:j.successful_executions)+" successful ",1)])):_("",!0)])]),t("div",ze,[y(l(s(c),{icon:"pi pi-history",outlined:"",rounded:"",severity:"secondary",onClick:x(f=>Z(r.id),["stop"])},null,8,["onClick"]),[[n,"View Logs"]]),r.status==="active"?y((p(),D(s(c),{key:0,icon:"pi pi-pause",outlined:"",rounded:"",onClick:x(f=>H(r.id),["stop"])},null,8,["onClick"])),[[n,"Deactivate"]]):y((p(),D(s(c),{key:1,icon:"pi pi-play",outlined:"",rounded:"",onClick:x(f=>G(r.id),["stop"])},null,8,["onClick"])),[[n,"Activate"]]),y(l(s(c),{icon:"pi pi-pencil",outlined:"",rounded:"",onClick:x(f=>z(r.id),["stop"])},null,8,["onClick"]),[[n,"Edit"]]),y(l(s(c),{icon:"pi pi-copy",outlined:"",rounded:"",onClick:x(f=>J(r.id),["stop"])},null,8,["onClick"]),[[n,"Duplicate"]]),y(l(s(c),{icon:"pi pi-trash",outlined:"",rounded:"",severity:"danger",onClick:x(f=>K(r),["stop"])},null,8,["onClick"]),[[n,"Delete"]])])])],8,Be)}),128))])),s(o).pagination.lastPage>1?(p(),m("div",Ge,[t("span",He," Showing "+u((s(o).pagination.currentPage-1)*s(o).pagination.perPage+1)+" to "+u(Math.min(s(o).pagination.currentPage*s(o).pagination.perPage,s(o).pagination.total))+" of "+u(s(o).pagination.total)+" workflows ",1),l(s(me),{rows:s(o).pagination.perPage,totalRecords:s(o).pagination.total,first:(s(o).pagination.currentPage-1)*s(o).pagination.perPage,onPage:ee},null,8,["rows","totalRecords","first"])])):_("",!0)]),l(s(ce),{visible:b.value,"onUpdate:visible":e[11]||(e[11]=r=>b.value=r),header:w.value?"Edit Workflow":"Create Workflow",modal:"",class:"w-full max-w-lg"},{default:h(()=>[t("form",{onSubmit:x(Q,["prevent"])},[t("div",Je,[t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Workflow Name * ",-1)),l(s(A),{modelValue:v.value.name,"onUpdate:modelValue":e[7]||(e[7]=r=>v.value.name=r),placeholder:"e.g., New Customer Welcome",class:"w-full",required:""},null,8,["modelValue"])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Description ",-1)),l(s(pe),{modelValue:v.value.description,"onUpdate:modelValue":e[8]||(e[8]=r=>v.value.description=r),placeholder:"What does this workflow do?",rows:"3",class:"w-full"},null,8,["modelValue"])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Trigger Type * ",-1)),l(s(E),{modelValue:v.value.trigger_type,"onUpdate:modelValue":e[9]||(e[9]=r=>v.value.trigger_type=r),options:W.value,optionLabel:"label",optionValue:"value",placeholder:"Select a trigger",class:"w-full",required:""},{option:h(r=>[t("div",null,[t("div",Ke,u(r.option.label),1),t("div",Qe,u(r.option.description),1)])]),_:1},8,["modelValue","options"])])]),t("div",Ye,[l(s(c),{label:"Cancel",outlined:"",onClick:e[10]||(e[10]=r=>b.value=!1)}),l(s(c),{type:"submit",label:w.value?"Update":"Create",loading:s(o).saving},null,8,["label","loading"])])],32)]),_:1},8,["visible","header"]),l(s(fe))])}}};export{ct as default};
