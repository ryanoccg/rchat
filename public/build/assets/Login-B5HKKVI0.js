import{u as N,q as $,r as u,b as i,g as n,w as h,i as f,v as M,x as R,m as d,e as t,y as E,h as y,t as p,j as L,l as B,z as I}from"./app-BgQ0ba_x.js";import{s as j}from"./index-hpZWgBgc.js";import{s as T}from"./index-O1aibNdm.js";import{s as z}from"./index-DAEGex-C.js";import"./index-DHYItjgp.js";const D={class:"min-h-screen flex items-center justify-center bg-surface-100 dark:bg-surface-900 p-4"},P={class:"text-center"},H={class:"text-2xl font-bold text-surface-900 dark:text-surface-100"},G={key:0,class:"text-red-500"},J={key:0,class:"text-red-500"},K={key:0,class:"text-red-500 text-sm text-center"},O={key:0,class:"text-red-500"},Q={key:0,class:"text-red-500 text-sm text-center"},W={class:"mt-4 text-center text-sm"},X={class:"mt-4 text-center"},re={__name:"Login",setup(Y){const F=M(),_=N(),V=$(),x=u({email:"",password:""}),o=u({}),s=u(""),c=u(!1),g=u(!1),C=u(null),w=u(""),m=u(""),U=async()=>{var v,e,l,a;o.value={},s.value="",c.value=!0;try{const r=await _.login(x.value);if(r.two_factor){g.value=!0,C.value=r.user_id,c.value=!1;return}V.add({severity:"success",summary:"Success",detail:"Login successful!",life:3e3});const k=sessionStorage.getItem("redirect_after_login");sessionStorage.removeItem("redirect_after_login"),F.push(k||"/dashboard")}catch(r){s.value=((e=(v=r.response)==null?void 0:v.data)==null?void 0:e.message)||"Login failed. Please try again.",(a=(l=r.response)==null?void 0:l.data)!=null&&a.errors&&(o.value=r.response.data.errors),V.add({severity:"error",summary:"Error",detail:s.value,life:3e3})}finally{c.value=!1}},q=async()=>{var v,e,l,a,r,k;m.value="",s.value="",c.value=!0;try{const b=(await I.post("/api/two-factor/verify",{user_id:C.value,code:w.value})).data;_.token=b.token,_.user=b.user,localStorage.setItem("auth_token",b.token),I.defaults.headers.common.Authorization=`Bearer ${b.token}`,V.add({severity:"success",summary:"Success",detail:"Login successful!",life:3e3}),F.push("/dashboard")}catch(S){m.value=((a=(l=(e=(v=S.response)==null?void 0:v.data)==null?void 0:e.errors)==null?void 0:l.code)==null?void 0:a[0])||((k=(r=S.response)==null?void 0:r.data)==null?void 0:k.message)||"Invalid code"}finally{c.value=!1}},A=()=>{g.value=!1,C.value=null,w.value="",m.value="",s.value=""};return(v,e)=>{const l=R("router-link");return d(),i("div",D,[n(f(j),{class:"w-full max-w-md"},{title:h(()=>[t("div",P,[t("h2",H,p(g.value?"Two-Factor Authentication":"Login to RChat"),1)])]),content:h(()=>[g.value?(d(),i("form",{key:1,onSubmit:E(q,["prevent"]),class:"space-y-4"},[e[6]||(e[6]=t("p",{class:"text-sm text-surface-600 dark:text-surface-400 text-center"}," Enter the 6-digit code from your authenticator app, or use a recovery code. ",-1)),t("div",null,[e[5]||(e[5]=t("label",{for:"twoFactorCode",class:"block text-sm font-medium mb-2 text-surface-700 dark:text-surface-300"}," Authentication Code ",-1)),n(f(T),{id:"twoFactorCode",modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=a=>w.value=a),placeholder:"Enter code",class:"w-full text-center tracking-widest text-lg",invalid:!!m.value,autofocus:"",required:""},null,8,["modelValue","invalid"]),m.value?(d(),i("small",O,p(m.value),1)):y("",!0)]),s.value?(d(),i("div",Q,p(s.value),1)):y("",!0),n(f(L),{type:"submit",label:"Verify",icon:"pi pi-shield",class:"w-full",loading:c.value,severity:"primary"},null,8,["loading"]),t("div",{class:"text-center"},[t("button",{type:"button",class:"text-sm text-surface-500 hover:text-surface-700 underline",onClick:A}," Back to login ")])],32)):(d(),i("form",{key:0,onSubmit:E(U,["prevent"]),class:"space-y-4"},[t("div",null,[e[3]||(e[3]=t("label",{for:"email",class:"block text-sm font-medium mb-2 text-surface-700 dark:text-surface-300"},"Email",-1)),n(f(T),{id:"email",modelValue:x.value.email,"onUpdate:modelValue":e[0]||(e[0]=a=>x.value.email=a),type:"email",placeholder:"Enter your email",class:"w-full",invalid:o.value.email,required:""},null,8,["modelValue","invalid"]),o.value.email?(d(),i("small",G,p(o.value.email),1)):y("",!0)]),t("div",null,[e[4]||(e[4]=t("label",{for:"password",class:"block text-sm font-medium mb-2 text-surface-700 dark:text-surface-300"},"Password",-1)),n(f(z),{id:"password",modelValue:x.value.password,"onUpdate:modelValue":e[1]||(e[1]=a=>x.value.password=a),placeholder:"Enter your password",toggleMask:"",feedback:!1,class:"w-full",invalid:o.value.password,required:""},null,8,["modelValue","invalid"]),o.value.password?(d(),i("small",J,p(o.value.password),1)):y("",!0)]),s.value?(d(),i("div",K,p(s.value),1)):y("",!0),n(f(L),{type:"submit",label:"Login",class:"w-full",loading:c.value,severity:"primary"},null,8,["loading"])],32)),t("div",W,[e[8]||(e[8]=t("span",{class:"text-surface-600 dark:text-surface-400"},"Don't have an account? ",-1)),n(l,{to:"/register",class:"text-primary-600 hover:text-primary-700 font-medium"},{default:h(()=>[...e[7]||(e[7]=[B(" Register ",-1)])]),_:1})]),t("div",X,[n(l,{to:"/",class:"text-sm text-surface-600 dark:text-surface-400 hover:text-surface-900 dark:hover:text-surface-100"},{default:h(()=>[...e[9]||(e[9]=[t("i",{class:"pi pi-arrow-left mr-1"},null,-1),B(" Back to Home ",-1)])]),_:1})])]),_:1})])}}};export{re as default};
