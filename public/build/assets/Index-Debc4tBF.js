import{d as _e,z as y,q as xe,r as _,c as x,o as we,b as g,e as a,g as n,w,x as v,B as D,h as S,F as ae,k as re,m as p,t as c,n as P,l as Se}from"./app-fEyaVeNj.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Pe=_e("subscription",{state:()=>({plans:[],currentSubscription:null,usage:null,limits:null,loading:!1,error:null}),getters:{currentPlan:s=>{var e;return((e=s.currentSubscription)==null?void 0:e.plan_name)||"free"},isActive:s=>s.currentSubscription?s.currentSubscription.status==="active"||s.currentSubscription.status==="trial":!1,isOnTrial:s=>{var e;return((e=s.currentSubscription)==null?void 0:e.status)==="trial"},trialEndsAt:s=>{var e;return(e=s.currentSubscription)==null?void 0:e.trial_ends_at},usagePercentages:s=>!s.usage||!s.limits?null:{messages:s.limits.message_limit?Math.round(s.usage.messages_sent/s.limits.message_limit*100):0,storage:s.limits.storage_limit?Math.round(s.usage.storage_used_mb/s.limits.storage_limit*100):0,team:s.limits.team_member_limit?Math.round(s.usage.active_team_members/s.limits.team_member_limit*100):0,platforms:s.limits.platform_limit?Math.round(s.usage.active_platforms/s.limits.platform_limit*100):0}},actions:{async fetchPlans(){var s,e;try{const t=await y.get("/api/subscriptions/plans");this.plans=t.data.data}catch(t){console.error("Failed to fetch plans:",t),this.error=((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to fetch plans"}},async fetchCurrentSubscription(){var s,e,t,u,i;this.loading=!0;try{const m=await y.get("/api/subscriptions/current");this.currentSubscription=((s=m.data.data)==null?void 0:s.subscription)||null,this.usage=((e=m.data.data)==null?void 0:e.usage)||null,this.limits=((t=m.data.data)==null?void 0:t.limits)||null}catch(m){console.error("Failed to fetch subscription:",m),this.error=((i=(u=m.response)==null?void 0:u.data)==null?void 0:i.message)||"Failed to fetch subscription"}finally{this.loading=!1}},async fetchUsage(){var s,e;try{const t=await y.get("/api/subscriptions/usage");this.usage=((s=t.data.data)==null?void 0:s.usage)||null,this.limits=((e=t.data.data)==null?void 0:e.limits)||null}catch(t){console.error("Failed to fetch usage:",t)}},async subscribe(s,e="monthly"){var t,u;this.loading=!0;try{const i=await y.post("/api/subscriptions/subscribe",{plan:s,plan_type:e});return i.data.checkout_url?(window.location.href=i.data.checkout_url,{redirect:!0}):(this.currentSubscription=i.data.data,{success:!0,subscription:i.data.data})}catch(i){throw console.error("Failed to subscribe:",i),this.error=((u=(t=i.response)==null?void 0:t.data)==null?void 0:u.message)||"Failed to subscribe",i}finally{this.loading=!1}},async changePlan(s,e=null){var t,u;this.loading=!0;try{const i=await y.post("/api/subscriptions/change-plan",{plan:s,plan_type:e});return this.currentSubscription=i.data.data,{success:!0}}catch(i){throw console.error("Failed to change plan:",i),this.error=((u=(t=i.response)==null?void 0:t.data)==null?void 0:u.message)||"Failed to change plan",i}finally{this.loading=!1}},async cancelSubscription(s=!1){var e,t;this.loading=!0;try{return await y.post("/api/subscriptions/cancel",{immediately:s}),await this.fetchCurrentSubscription(),{success:!0}}catch(u){throw console.error("Failed to cancel subscription:",u),this.error=((t=(e=u.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to cancel subscription",u}finally{this.loading=!1}},async resumeSubscription(){var s,e;this.loading=!0;try{const t=await y.post("/api/subscriptions/resume");return this.currentSubscription=t.data.data,{success:!0}}catch(t){throw console.error("Failed to resume subscription:",t),this.error=((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to resume subscription",t}finally{this.loading=!1}},async openBillingPortal(){var s,e;try{const t=await y.post("/api/subscriptions/billing-portal");t.data.portal_url&&(window.location.href=t.data.portal_url)}catch(t){throw console.error("Failed to open billing portal:",t),this.error=((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to open billing portal",t}},clearError(){this.error=null}}}),ke={class:"p-6"},Fe={key:0,class:"flex items-center justify-center py-8"},Be={key:1,class:"space-y-4"},Ve={class:"flex items-center justify-between"},Me={class:"text-xl font-semibold text-surface-900 dark:text-surface-100"},De={class:"text-surface-500"},Ie={class:"text-right"},Te={key:0,class:"text-sm text-surface-500 mt-1"},je={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Ee={class:"p-4 bg-surface-50 dark:bg-surface-800 rounded-lg"},Le={class:"flex items-center justify-between mb-2"},Ue={class:"text-sm font-medium"},$e={class:"p-4 bg-surface-50 dark:bg-surface-800 rounded-lg"},Ne={class:"flex items-center justify-between mb-2"},Oe={class:"text-sm font-medium"},Ae={class:"p-4 bg-surface-50 dark:bg-surface-800 rounded-lg"},ze={class:"flex items-center justify-between mb-2"},Ge={class:"text-sm font-medium"},Re={class:"p-4 bg-surface-50 dark:bg-surface-800 rounded-lg"},qe={class:"flex items-center justify-between mb-2"},Ye={class:"text-sm font-medium"},He={class:"flex gap-2 mt-4"},Je={key:2,class:"text-center py-8"},Qe={class:"flex justify-center mb-6"},We={key:0,class:"absolute -top-3 left-1/2 -translate-x-1/2"},Xe={class:"text-center pt-2"},Ze={class:"text-xl font-bold"},Ke={class:"text-sm text-surface-500"},es={class:"text-center mb-6"},ss={class:"text-4xl font-bold"},ts={class:"text-surface-500"},as={key:0,class:"text-sm text-surface-400"},rs={class:"space-y-3 mb-6"},ls={class:"space-y-4"},is={class:"flex items-center gap-2"},ns={__name:"Index",setup(s){const e=Pe(),t=xe(),u=_(null),i=_("monthly"),m=_(!1),I=_(!1),T=_(!1),j=_(!1),E=_(null),le=[{label:"Monthly",value:"monthly"},{label:"Yearly",value:"yearly"}],ie=x(()=>e.loading),d=x(()=>e.currentSubscription),k=x(()=>e.usage),F=x(()=>e.limits),b=x(()=>e.usagePercentages),$=x(()=>e.plans),N=x(()=>d.value?$.value[d.value.plan_name]:null);we(async()=>{await Promise.all([e.fetchPlans(),e.fetchCurrentSubscription()]);const l=new URLSearchParams(window.location.search);l.get("success")==="true"?(t.add({severity:"success",summary:"Success",detail:"Subscription activated successfully!",life:5e3}),window.history.replaceState({},document.title,window.location.pathname),await e.fetchCurrentSubscription()):l.get("canceled")==="true"&&(t.add({severity:"info",summary:"Cancelled",detail:"Checkout was cancelled",life:3e3}),window.history.replaceState({},document.title,window.location.pathname))});const ne=l=>{switch(l){case"active":return"success";case"trial":return"info";case"cancelling":return"warn";case"cancelled":return"danger";case"past_due":return"danger";default:return"secondary"}},B=l=>l>=90?"p-progressbar-danger":l>=75?"p-progressbar-warning":"",oe=l=>l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",O=l=>l?l>=1024?`${(l/1024).toFixed(1)} GB`:`${l} MB`:"∞",L=l=>{var r;return((r=d.value)==null?void 0:r.plan_name)===l},ce=l=>{if(L(l))return"Current Plan";if(!d.value)return"Get Started";const r=["free","starter","professional","enterprise"].indexOf(d.value.plan_name);return["free","starter","professional","enterprise"].indexOf(l)>r?"Upgrade":"Downgrade"},ue=async l=>{E.value=l;try{d.value?(await e.changePlan(l,i.value),t.add({severity:"success",summary:"Success",detail:"Plan changed successfully!",life:3e3})):(await e.subscribe(l,i.value)).redirect||t.add({severity:"success",summary:"Success",detail:"Subscription created!",life:3e3})}catch{t.add({severity:"error",summary:"Error",detail:e.error||"Failed to process subscription",life:3e3})}finally{E.value=null}},de=async()=>{T.value=!0;try{await e.cancelSubscription(I.value),m.value=!1,t.add({severity:"success",summary:"Success",detail:"Subscription cancelled",life:3e3})}catch{t.add({severity:"error",summary:"Error",detail:e.error||"Failed to cancel subscription",life:3e3})}finally{T.value=!1}},pe=async()=>{try{await e.resumeSubscription(),t.add({severity:"success",summary:"Success",detail:"Subscription resumed",life:3e3})}catch{t.add({severity:"error",summary:"Error",detail:e.error||"Failed to resume subscription",life:3e3})}},me=async()=>{j.value=!0;try{await e.openBillingPortal()}catch{t.add({severity:"error",summary:"Error",detail:"Failed to open billing portal",life:3e3})}finally{j.value=!1}},fe=()=>{var l;(l=u.value)==null||l.scrollIntoView({behavior:"smooth"})};return(l,r)=>{const A=v("ProgressSpinner"),U=v("Tag"),ge=v("Divider"),V=v("ProgressBar"),h=v("Button"),z=v("Card"),ve=v("SelectButton"),be=v("Checkbox"),ye=v("Dialog"),he=v("Toast");return p(),g("div",ke,[r[15]||(r[15]=a("div",{class:"mb-6"},[a("h1",{class:"text-2xl font-bold text-surface-900 dark:text-surface-100"}," Subscription & Billing "),a("p",{class:"text-surface-500"},"Manage your subscription plan and billing details")],-1)),n(z,{class:"mb-6"},{title:w(()=>[...r[5]||(r[5]=[Se("Current Plan",-1)])]),content:w(()=>{var o,f,C,M,G,R,q,Y,H,J,Q,W,X,Z,K,ee,se,te;return[ie.value?(p(),g("div",Fe,[n(A,{style:{width:"50px",height:"50px"}})])):d.value?(p(),g("div",Be,[a("div",Ve,[a("div",null,[a("h3",Me,c(((o=N.value)==null?void 0:o.name)||d.value.plan_name),1),a("p",De,c((f=N.value)==null?void 0:f.description),1)]),a("div",Ie,[n(U,{value:d.value.status,severity:ne(d.value.status)},null,8,["value","severity"]),d.value.status==="trial"?(p(),g("p",Te," Trial ends "+c(oe(d.value.trial_ends_at)),1)):S("",!0)])]),n(ge),a("div",je,[a("div",Ee,[a("div",Le,[r[6]||(r[6]=a("span",{class:"text-sm text-surface-500"},"Messages",-1)),a("span",Ue,c(((C=k.value)==null?void 0:C.messages_sent)||0)+" / "+c(((M=F.value)==null?void 0:M.message_limit)||"∞"),1)]),n(V,{value:((G=b.value)==null?void 0:G.messages)||0,showValue:!1,class:P(B((R=b.value)==null?void 0:R.messages))},null,8,["value","class"])]),a("div",$e,[a("div",Ne,[r[7]||(r[7]=a("span",{class:"text-sm text-surface-500"},"Storage",-1)),a("span",Oe,c(O((q=k.value)==null?void 0:q.storage_used_mb))+" / "+c(O((Y=F.value)==null?void 0:Y.storage_limit)),1)]),n(V,{value:((H=b.value)==null?void 0:H.storage)||0,showValue:!1,class:P(B((J=b.value)==null?void 0:J.storage))},null,8,["value","class"])]),a("div",Ae,[a("div",ze,[r[8]||(r[8]=a("span",{class:"text-sm text-surface-500"},"Team Members",-1)),a("span",Ge,c(((Q=k.value)==null?void 0:Q.active_team_members)||0)+" / "+c(((W=F.value)==null?void 0:W.team_member_limit)||"∞"),1)]),n(V,{value:((X=b.value)==null?void 0:X.team)||0,showValue:!1,class:P(B((Z=b.value)==null?void 0:Z.team))},null,8,["value","class"])]),a("div",Re,[a("div",qe,[r[9]||(r[9]=a("span",{class:"text-sm text-surface-500"},"Platforms",-1)),a("span",Ye,c(((K=k.value)==null?void 0:K.active_platforms)||0)+" / "+c(((ee=F.value)==null?void 0:ee.platform_limit)||"∞"),1)]),n(V,{value:((se=b.value)==null?void 0:se.platforms)||0,showValue:!1,class:P(B((te=b.value)==null?void 0:te.platforms))},null,8,["value","class"])])]),a("div",He,[n(h,{label:"Manage Billing",icon:"pi pi-credit-card",onClick:me,loading:j.value},null,8,["loading"]),d.value.status!=="cancelled"?(p(),D(h,{key:0,label:"Cancel Subscription",icon:"pi pi-times",severity:"danger",outlined:"",onClick:r[0]||(r[0]=os=>m.value=!0)})):S("",!0),d.value.status==="cancelling"?(p(),D(h,{key:1,label:"Resume Subscription",icon:"pi pi-refresh",severity:"success",onClick:pe})):S("",!0)])])):(p(),g("div",Je,[r[10]||(r[10]=a("i",{class:"pi pi-credit-card text-4xl text-surface-400 mb-4"},null,-1)),r[11]||(r[11]=a("p",{class:"text-surface-500 mb-4"},"No active subscription",-1)),n(h,{label:"Choose a Plan",icon:"pi pi-arrow-down",onClick:fe})]))]}),_:1}),a("div",Qe,[n(ve,{modelValue:i.value,"onUpdate:modelValue":r[1]||(r[1]=o=>i.value=o),options:le,optionLabel:"label",optionValue:"value"},null,8,["modelValue"]),i.value==="yearly"?(p(),D(U,{key:0,value:"Save 17%",severity:"success",class:"ml-2"})):S("",!0)]),a("div",{ref_key:"plansSection",ref:u,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},[(p(!0),g(ae,null,re($.value,(o,f)=>(p(),D(z,{key:f,class:P(["relative",f==="professional"?"ring-2 ring-primary":""])},{header:w(()=>[f==="professional"?(p(),g("div",We,[n(U,{value:"Most Popular",severity:"success"})])):S("",!0)]),title:w(()=>[a("div",Xe,[a("h3",Ze,c(o.name),1),a("p",Ke,c(o.description),1)])]),content:w(()=>[a("div",es,[a("span",ss," $"+c(i.value==="yearly"?o.yearly_price:o.monthly_price),1),a("span",ts," /"+c(i.value==="yearly"?"year":"month"),1),i.value==="yearly"&&o.monthly_price>0?(p(),g("p",as," ($"+c(Math.round(o.yearly_price/12))+"/month) ",1)):S("",!0)]),a("ul",rs,[(p(!0),g(ae,null,re(o.highlights,(C,M)=>(p(),g("li",{key:M,class:"flex items-center gap-2 text-sm"},[r[12]||(r[12]=a("i",{class:"pi pi-check text-green-500"},null,-1)),a("span",null,c(C),1)]))),128))]),n(h,{label:ce(f),severity:f==="professional"?void 0:"secondary",outlined:L(f),disabled:L(f),class:"w-full",onClick:C=>ue(f),loading:E.value===f},null,8,["label","severity","outlined","disabled","onClick","loading"])]),_:2},1032,["class"]))),128))],512),n(ye,{visible:m.value,"onUpdate:visible":r[4]||(r[4]=o=>m.value=o),header:"Cancel Subscription",modal:!0,style:{width:"450px"}},{footer:w(()=>[n(h,{label:"Keep Subscription",severity:"secondary",outlined:"",onClick:r[3]||(r[3]=o=>m.value=!1)}),n(h,{label:"Cancel Subscription",severity:"danger",onClick:de,loading:T.value},null,8,["loading"])]),default:w(()=>[a("div",ls,[r[14]||(r[14]=a("p",null,"Are you sure you want to cancel your subscription?",-1)),a("div",is,[n(be,{modelValue:I.value,"onUpdate:modelValue":r[2]||(r[2]=o=>I.value=o),inputId:"cancelImmediately",binary:""},null,8,["modelValue"]),r[13]||(r[13]=a("label",{for:"cancelImmediately"},"Cancel immediately (otherwise access continues until period end)",-1))])])]),_:1},8,["visible"]),n(he)])}}},ds=Ce(ns,[["__scopeId","data-v-33840396"]]);export{ds as default};
