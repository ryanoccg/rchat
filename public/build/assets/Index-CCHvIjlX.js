import{d as se,r as E,c as Q,z as S,q as ie,a9 as oe,o as ne,a1 as re,b,g as i,i as e,w as f,X as ue,m as g,e as s,a5 as de,j as F,n as O,t as w,B as G,l as Y,Z as j,h as z,F as Z,k as J}from"./app-fEyaVeNj.js";import{s as ce,a as P}from"./index-Cp9vA3Ae.js";import{s as W}from"./index-BAOvgU1o.js";import{s as H}from"./index-CUE77Sby.js";import{s as ee}from"./index-vD2lkY0C.js";import{s as te}from"./index-Bf82pFXt.js";import{s as pe}from"./index-CaKXeVtV.js";import{s as ve}from"./index-DUME89v1.js";import{s as T}from"./index-Cbdau87T.js";import{s as ye}from"./index-DPRBmxkH.js";import{s as le}from"./index-B1y77kAB.js";import{s as fe}from"./index-Dw9IgWhd.js";import{s as ae}from"./index-CouiwACO.js";import{s as me}from"./index-CXtElW_P.js";import"./index-CzS5b5Kg.js";import"./index-uZHgs35Z.js";import"./index-CniEHBiC.js";import"./index-WNiOysGX.js";import"./index-DHhCi5Tc.js";const ge=se("knowledgeBase",()=>{const k=E([]),a=E(null),$=E([]),_=E(!1),v=E(null),C=E({currentPage:1,lastPage:1,perPage:20,total:0}),x=E({search:"",category:"",is_active:null}),U=Q(()=>k.value.filter(r=>r.is_active)),o=Q(()=>k.value.filter(r=>!r.is_active));async function h(r=1){var y,c;_.value=!0,v.value=null;try{const u={page:r,per_page:C.value.perPage,...x.value};Object.keys(u).forEach(p=>{(u[p]===""||u[p]===null)&&delete u[p]});const d=await S.get("/api/knowledge-base",{params:u});k.value=d.data.data,C.value={currentPage:d.data.current_page,lastPage:d.data.last_page,perPage:d.data.per_page,total:d.data.total}}catch(u){throw v.value=((c=(y=u.response)==null?void 0:y.data)==null?void 0:c.message)||"Failed to fetch knowledge base entries",u}finally{_.value=!1}}async function D(){try{const r=await S.get("/api/knowledge-base/categories");$.value=r.data.data}catch(r){console.error("Failed to fetch categories:",r)}}async function L(r){var y,c;_.value=!0,v.value=null;try{const u=await S.get(`/api/knowledge-base/${r}`);return a.value=u.data.data,a.value}catch(u){throw v.value=((c=(y=u.response)==null?void 0:y.data)==null?void 0:c.message)||"Failed to fetch entry",u}finally{_.value=!1}}async function B(r){var y,c;_.value=!0,v.value=null;try{const u=new FormData;Object.keys(r).forEach(p=>{r[p]!==null&&r[p]!==void 0&&u.append(p,r[p])});const d=await S.post("/api/knowledge-base",u,{headers:{"Content-Type":"multipart/form-data"}});return await h(C.value.currentPage),await D(),d.data.data}catch(u){throw v.value=((c=(y=u.response)==null?void 0:y.data)==null?void 0:c.message)||"Failed to create entry",u}finally{_.value=!1}}async function A(r,y){var c,u,d;_.value=!0,v.value=null;try{const p=await S.put(`/api/knowledge-base/${r}`,y),n=k.value.findIndex(t=>t.id===r);return n!==-1&&(k.value[n]=p.data.data),((c=a.value)==null?void 0:c.id)===r&&(a.value=p.data.data),await D(),p.data.data}catch(p){throw v.value=((d=(u=p.response)==null?void 0:u.data)==null?void 0:d.message)||"Failed to update entry",p}finally{_.value=!1}}async function N(r){var y,c,u;_.value=!0,v.value=null;try{await S.delete(`/api/knowledge-base/${r}`),k.value=k.value.filter(d=>d.id!==r),((y=a.value)==null?void 0:y.id)===r&&(a.value=null),k.value.length===0&&C.value.currentPage>1&&await h(C.value.currentPage-1),await D()}catch(d){throw v.value=((u=(c=d.response)==null?void 0:c.data)==null?void 0:u.message)||"Failed to delete entry",d}finally{_.value=!1}}async function I(r){var y,c,u;try{const d=await S.post(`/api/knowledge-base/${r}/toggle`),p=k.value.findIndex(n=>n.id===r);return p!==-1&&(k.value[p]=d.data.data),((y=a.value)==null?void 0:y.id)===r&&(a.value=d.data.data),d.data.data}catch(d){throw v.value=((u=(c=d.response)==null?void 0:c.data)==null?void 0:u.message)||"Failed to toggle status",d}}async function X(r,y=5){try{return(await S.get("/api/knowledge-base/search",{params:{query:r,limit:y}})).data.data}catch(c){throw console.error("Search failed:",c),c}}function M(r){x.value={...x.value,...r}}function q(){x.value={search:"",category:"",is_active:null}}function R(){v.value=null}return{entries:k,currentEntry:a,categories:$,loading:_,error:v,pagination:C,filters:x,activeEntries:U,inactiveEntries:o,fetchEntries:h,fetchCategories:D,fetchEntry:L,createEntry:B,updateEntry:A,deleteEntry:N,toggleStatus:I,search:X,setFilters:M,resetFilters:q,clearError:R}}),he={class:"space-y-6"},we={class:"flex flex-wrap items-center justify-between gap-4"},be={class:"flex flex-wrap items-center gap-3"},_e={class:"text-center py-8 text-gray-500"},xe={class:"flex items-center gap-2"},Ee={class:"font-medium"},ke={key:1,class:"text-gray-400"},Ce={class:"font-mono"},Ve={class:"flex items-center gap-1"},$e={class:"space-y-4"},Fe={key:0,class:"text-red-500"},Se={class:"py-2"},Pe={key:0,class:"mt-3 p-3 bg-gray-100 dark:bg-gray-800 rounded"},De={class:"flex items-center gap-2"},ze={class:"text-gray-500 text-sm"},Te={class:"py-2"},Ue={key:0,class:"text-red-500"},Be={key:1},Ae={class:"grid grid-cols-2 gap-4"},Ie={id:"category-suggestions"},Ke=["value"],Oe={key:0,class:"space-y-4"},je={class:"flex items-start justify-between"},Le={class:"text-xl font-semibold"},Ne={class:"flex items-center gap-2 mt-2"},Xe={class:"text-right text-sm text-gray-500"},Me={key:0},qe={class:"border-t pt-4"},Re={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded max-h-96 overflow-y-auto"},Ge={class:"whitespace-pre-wrap text-sm"},He={key:0,class:"border-t pt-4"},Qe={class:"font-medium mb-2"},Ye={class:"space-y-2 max-h-48 overflow-y-auto"},Ze={class:"text-gray-500"},Je={key:1,class:"text-center py-8"},ht={__name:"Index",setup(k){const a=ge(),$=ie(),_=oe(),v=E(!1),C=E(!1),x=E(!1),U=E(0),o=E({title:"",content:"",category:"",priority:0,file:null}),h=E({}),D=Q(()=>a.categories.map(n=>({label:n,value:n}))),L=[{label:"All",value:null},{label:"Active",value:!0},{label:"Inactive",value:!1}];ne(async()=>{await Promise.all([a.fetchEntries(),a.fetchCategories()])});function B(){x.value=!1,I(),v.value=!0}function A(n){x.value=!0,o.value={id:n.id,title:n.title,content:n.content||"",category:n.category||"",priority:n.priority||0,file:null},v.value=!0}function N(n){a.fetchEntry(n.id),C.value=!0}function I(){o.value={title:"",content:"",category:"",priority:0,file:null},h.value={}}function X(n){const t=n.files[0];t&&(o.value.file=t,o.value.title||(o.value.title=t.name.replace(/\.[^/.]+$/,"")))}function M(){o.value.file=null}async function q(){var n,t,V,l;if(h.value={},!o.value.title.trim()){h.value.title="Title is required";return}if(!o.value.file&&!o.value.content.trim()&&!x.value){h.value.content="Either upload a file or provide text content";return}try{if(x.value)await a.updateEntry(o.value.id,{title:o.value.title,content:o.value.content,category:o.value.category||null,priority:o.value.priority}),$.add({severity:"success",summary:"Updated",detail:"Knowledge base entry updated successfully",life:3e3});else{const m={title:o.value.title,category:o.value.category||null,priority:o.value.priority};o.value.file?m.file=o.value.file:m.content=o.value.content,await a.createEntry(m),$.add({severity:"success",summary:"Created",detail:"Knowledge base entry created successfully",life:3e3})}v.value=!1,I()}catch(m){(t=(n=m.response)==null?void 0:n.data)!=null&&t.errors?h.value=m.response.data.errors:$.add({severity:"error",summary:"Error",detail:((l=(V=m.response)==null?void 0:V.data)==null?void 0:l.message)||"Failed to save entry",life:5e3})}}function R(n){_.require({message:`Are you sure you want to delete "${n.title}"?`,header:"Delete Confirmation",icon:"pi pi-exclamation-triangle",acceptClass:"p-button-danger",accept:async()=>{try{await a.deleteEntry(n.id),$.add({severity:"success",summary:"Deleted",detail:"Entry deleted successfully",life:3e3})}catch{$.add({severity:"error",summary:"Error",detail:"Failed to delete entry",life:5e3})}}})}async function r(n){try{await a.toggleStatus(n.id),$.add({severity:"success",summary:"Status Updated",detail:`Entry ${n.is_active?"deactivated":"activated"}`,life:3e3})}catch{$.add({severity:"error",summary:"Error",detail:"Failed to toggle status",life:5e3})}}function y(n){a.fetchEntries(n.page+1)}function c(){a.fetchEntries(1)}function u(n){if(!n)return"-";const t=["B","KB","MB","GB"];let V=0,l=n;for(;l>=1024&&V<t.length-1;)l/=1024,V++;return`${l.toFixed(1)} ${t[V]}`}function d(n){return{pdf:"pi-file-pdf",txt:"pi-file",docx:"pi-file-word",doc:"pi-file-word",csv:"pi-file-excel",text:"pi-align-left"}[n]||"pi-file"}function p(n){return{pdf:"danger",txt:"secondary",docx:"info",doc:"info",csv:"success",text:"warning"}[n]||"secondary"}return re(()=>a.filters,()=>{a.fetchEntries(1)},{deep:!0}),(n,t)=>{const V=ue("tooltip");return g(),b("div",he,[i(e(me)),i(e(le),null,{content:f(()=>[s("div",we,[s("div",be,[i(e(H),{modelValue:e(a).filters.search,"onUpdate:modelValue":t[0]||(t[0]=l=>e(a).filters.search=l),placeholder:"Search...",class:"w-64",onKeyup:de(c,["enter"])},null,8,["modelValue"]),i(e(te),{modelValue:e(a).filters.category,"onUpdate:modelValue":t[1]||(t[1]=l=>e(a).filters.category=l),options:D.value,optionLabel:"label",optionValue:"value",placeholder:"All Categories",showClear:"",class:"w-48"},null,8,["modelValue","options"]),i(e(te),{modelValue:e(a).filters.is_active,"onUpdate:modelValue":t[2]||(t[2]=l=>e(a).filters.is_active=l),options:L,optionLabel:"label",optionValue:"value",placeholder:"Status",class:"w-36"},null,8,["modelValue"])]),i(e(F),{label:"Add Entry",icon:"pi pi-plus",onClick:B})])]),_:1}),i(e(le),null,{content:f(()=>[i(e(ce),{value:e(a).entries,loading:e(a).loading,paginator:!0,rows:e(a).pagination.perPage,totalRecords:e(a).pagination.total,lazy:!0,onPage:y,dataKey:"id",stripedRows:"",responsiveLayout:"scroll",class:"p-datatable-sm"},{empty:f(()=>[s("div",_e,[t[14]||(t[14]=s("i",{class:"pi pi-inbox text-4xl mb-3 block"},null,-1)),t[15]||(t[15]=s("p",null,"No knowledge base entries found",-1)),i(e(F),{label:"Add Your First Entry",icon:"pi pi-plus",class:"mt-3",onClick:B})])]),default:f(()=>[i(e(P),{field:"title",header:"Title",sortable:!0,style:{"min-width":"200px"}},{body:f(({data:l})=>[s("div",xe,[s("i",{class:O(["pi",d(l.file_type)])},null,2),s("span",Ee,w(l.title),1)])]),_:1}),i(e(P),{field:"file_type",header:"Type",style:{width:"100px"}},{body:f(({data:l})=>{var m;return[i(e(T),{value:((m=l.file_type)==null?void 0:m.toUpperCase())||"TEXT",severity:p(l.file_type)},null,8,["value","severity"])]}),_:1}),i(e(P),{field:"category",header:"Category",style:{width:"150px"}},{body:f(({data:l})=>[l.category?(g(),G(e(T),{key:0,value:l.category,severity:"info"},null,8,["value"])):(g(),b("span",ke,"-"))]),_:1}),i(e(P),{field:"priority",header:"Priority",sortable:!0,style:{width:"100px"}},{body:f(({data:l})=>[s("span",Ce,w(l.priority),1)]),_:1}),i(e(P),{field:"file_size",header:"Size",style:{width:"100px"}},{body:f(({data:l})=>[Y(w(u(l.file_size)),1)]),_:1}),i(e(P),{field:"is_active",header:"Status",style:{width:"100px"}},{body:f(({data:l})=>[i(e(T),{value:l.is_active?"Active":"Inactive",severity:l.is_active?"success":"secondary"},null,8,["value","severity"])]),_:1}),i(e(P),{header:"Actions",style:{width:"200px"}},{body:f(({data:l})=>[s("div",Ve,[j(i(e(F),{icon:"pi pi-eye",severity:"info",outlined:"",rounded:"",size:"small",onClick:m=>N(l)},null,8,["onClick"]),[[V,"View",void 0,{top:!0}]]),j(i(e(F),{icon:"pi pi-pencil",severity:"warning",outlined:"",rounded:"",size:"small",onClick:m=>A(l)},null,8,["onClick"]),[[V,"Edit",void 0,{top:!0}]]),j(i(e(F),{icon:l.is_active?"pi pi-eye-slash":"pi pi-eye",severity:l.is_active?"secondary":"success",outlined:"",rounded:"",size:"small",onClick:m=>r(l)},null,8,["icon","severity","onClick"]),[[V,l.is_active?"Deactivate":"Activate",void 0,{top:!0}]]),j(i(e(F),{icon:"pi pi-trash",severity:"danger",outlined:"",rounded:"",size:"small",onClick:m=>R(l)},null,8,["onClick"]),[[V,"Delete",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","rows","totalRecords"])]),_:1}),i(e(W),{visible:v.value,"onUpdate:visible":t[10]||(t[10]=l=>v.value=l),header:x.value?"Edit Entry":"Add Knowledge Base Entry",style:{width:"600px"},modal:!0,closable:!e(a).loading,closeOnEscape:!e(a).loading},{footer:f(()=>[i(e(F),{label:"Cancel",severity:"secondary",outlined:"",onClick:t[9]||(t[9]=l=>v.value=!1),disabled:e(a).loading},null,8,["disabled"]),i(e(F),{label:x.value?"Update":"Create",loading:e(a).loading,onClick:q},null,8,["label","loading"])]),default:f(()=>[s("div",$e,[s("div",null,[t[16]||(t[16]=s("label",{class:"block text-sm font-medium mb-1"},"Title *",-1)),i(e(H),{modelValue:o.value.title,"onUpdate:modelValue":t[3]||(t[3]=l=>o.value.title=l),class:O(["w-full",{"p-invalid":h.value.title}]),placeholder:"Enter title"},null,8,["modelValue","class"]),h.value.title?(g(),b("small",Fe,w(h.value.title),1)):z("",!0)]),x.value?(g(),b("div",Be,[t[18]||(t[18]=s("label",{class:"block text-sm font-medium mb-1"},"Content",-1)),i(e(ee),{modelValue:o.value.content,"onUpdate:modelValue":t[6]||(t[6]=l=>o.value.content=l),rows:"8",class:"w-full",placeholder:"Enter content..."},null,8,["modelValue"])])):(g(),G(e(fe),{key:0,activeIndex:U.value,"onUpdate:activeIndex":t[5]||(t[5]=l=>U.value=l)},{default:f(()=>[i(e(ae),{header:"Upload File"},{default:f(()=>[s("div",Se,[i(e(ve),{mode:"basic",name:"file",accept:".pdf,.txt,.docx,.doc,.csv",maxFileSize:10485760,onSelect:X,onClear:M,chooseLabel:"Choose File",class:"w-full"}),t[17]||(t[17]=s("small",{class:"text-gray-500 block mt-2"}," Supported: PDF, TXT, DOCX, DOC, CSV (max 10MB) ",-1)),o.value.file?(g(),b("div",Pe,[s("div",De,[s("i",{class:O(["pi",d(o.value.file.name.split(".").pop())])},null,2),s("span",null,w(o.value.file.name),1),s("span",ze,"("+w(u(o.value.file.size))+")",1)])])):z("",!0)])]),_:1}),i(e(ae),{header:"Enter Text"},{default:f(()=>[s("div",Te,[i(e(ee),{modelValue:o.value.content,"onUpdate:modelValue":t[4]||(t[4]=l=>o.value.content=l),rows:"8",class:O(["w-full",{"p-invalid":h.value.content}]),placeholder:"Enter knowledge base content..."},null,8,["modelValue","class"]),h.value.content?(g(),b("small",Ue,w(h.value.content),1)):z("",!0)])]),_:1})]),_:1},8,["activeIndex"])),s("div",Ae,[s("div",null,[t[19]||(t[19]=s("label",{class:"block text-sm font-medium mb-1"},"Category",-1)),i(e(H),{modelValue:o.value.category,"onUpdate:modelValue":t[7]||(t[7]=l=>o.value.category=l),class:"w-full",placeholder:"e.g., FAQ, Product Info",list:"category-suggestions"},null,8,["modelValue"]),s("datalist",Ie,[(g(!0),b(Z,null,J(e(a).categories,l=>(g(),b("option",{key:l,value:l},null,8,Ke))),128))])]),s("div",null,[t[20]||(t[20]=s("label",{class:"block text-sm font-medium mb-1"},"Priority",-1)),i(e(pe),{modelValue:o.value.priority,"onUpdate:modelValue":t[8]||(t[8]=l=>o.value.priority=l),min:0,max:100,class:"w-full",placeholder:"0-100"},null,8,["modelValue"]),t[21]||(t[21]=s("small",{class:"text-gray-500"},"Higher priority = more relevant in search",-1))])])])]),_:1},8,["visible","header","closable","closeOnEscape"]),i(e(W),{visible:C.value,"onUpdate:visible":t[13]||(t[13]=l=>C.value=l),header:"Knowledge Base Entry",style:{width:"700px"},modal:!0},{footer:f(()=>[i(e(F),{label:"Edit",icon:"pi pi-pencil",severity:"warning",onClick:t[11]||(t[11]=l=>{A(e(a).currentEntry),C.value=!1}),disabled:!e(a).currentEntry},null,8,["disabled"]),i(e(F),{label:"Close",severity:"secondary",outlined:"",onClick:t[12]||(t[12]=l=>C.value=!1)})]),default:f(()=>{var l,m;return[e(a).currentEntry?(g(),b("div",Oe,[s("div",je,[s("div",null,[s("h3",Le,w(e(a).currentEntry.title),1),s("div",Ne,[i(e(T),{value:((l=e(a).currentEntry.file_type)==null?void 0:l.toUpperCase())||"TEXT",severity:p(e(a).currentEntry.file_type)},null,8,["value","severity"]),e(a).currentEntry.category?(g(),G(e(T),{key:0,value:e(a).currentEntry.category,severity:"info"},null,8,["value"])):z("",!0),i(e(T),{value:e(a).currentEntry.is_active?"Active":"Inactive",severity:e(a).currentEntry.is_active?"success":"secondary"},null,8,["value","severity"])])]),s("div",Xe,[s("div",null,"Priority: "+w(e(a).currentEntry.priority),1),e(a).currentEntry.file_size?(g(),b("div",Me," Size: "+w(u(e(a).currentEntry.file_size)),1)):z("",!0)])]),s("div",qe,[t[22]||(t[22]=s("h4",{class:"font-medium mb-2"},"Content",-1)),s("div",Re,[s("pre",Ge,w(e(a).currentEntry.content),1)])]),(m=e(a).currentEntry.embeddings)!=null&&m.length?(g(),b("div",He,[s("h4",Qe,"Chunks ("+w(e(a).currentEntry.embeddings.length)+")",1),s("div",Ye,[(g(!0),b(Z,null,J(e(a).currentEntry.embeddings,K=>(g(),b("div",{key:K.id,class:"bg-gray-50 dark:bg-gray-800 p-3 rounded text-sm"},[s("span",Ze,"#"+w(K.chunk_index+1)+":",1),Y(" "+w(K.chunk_text.substring(0,200))+w(K.chunk_text.length>200?"...":""),1)]))),128))])])):z("",!0)])):(g(),b("div",Je,[i(e(ye),{mode:"indeterminate",style:{height:"6px"}})]))]}),_:1},8,["visible"])])}}};export{ht as default};
