import{d as J,z as m,q as Q,a9 as X,r as h,o as Z,C as ee,b as f,g as r,e as a,i as o,B,A as te,w as c,F as V,j as b,m as g,t as k,l as w,k as N,n as j,h as G,p as ae}from"./app-fEyaVeNj.js";import{s as x}from"./index-B1y77kAB.js";import{s as M}from"./index-Bf82pFXt.js";import{s as $}from"./index-CaKXeVtV.js";import{s as q}from"./index-CUE77Sby.js";import{s as se}from"./index-vD2lkY0C.js";import{s as I}from"./index-CEmnCaYv.js";import{s as D}from"./index-Cbdau87T.js";import{s as ne}from"./index-D1yjR3qv.js";import{s as oe}from"./index-BAOvgU1o.js";import{s as le,a as F}from"./index-Cp9vA3Ae.js";import{s as ie}from"./index-CXtElW_P.js";import"./index-CniEHBiC.js";import"./index-CzS5b5Kg.js";import"./index-uZHgs35Z.js";const re=J("calendar",{state:()=>({configuration:null,calendars:[],availableDates:[],appointments:[],upcomingAppointments:[],loading:!1,saving:!1,error:null,isConnecting:!1}),getters:{isConnected:i=>{var t;return((t=i.configuration)==null?void 0:t.is_connected)||!1},isEnabled:i=>{var t;return((t=i.configuration)==null?void 0:t.is_enabled)||!1},calendarName:i=>{var t;return((t=i.configuration)==null?void 0:t.calendar_name)||null}},actions:{async getAuthUrl(){var i,t;try{return(await m.get("/api/auth/google/url")).data.url}catch(n){throw this.error=((t=(i=n.response)==null?void 0:i.data)==null?void 0:t.message)||"Failed to get auth URL",n}},async fetchCalendars(i){var t,n;this.loading=!0,this.error=null;try{const l=await m.get("/api/calendar/calendars",{params:{google_token:i}});return this.calendars=l.data.calendars||[],this.calendars}catch(l){throw this.error=((n=(t=l.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to fetch calendars",l}finally{this.loading=!1}},async connectCalendar(i,t){var n,l;this.saving=!0,this.error=null;try{const u=await m.post("/api/calendar/connect",{...i,google_token:t});return this.configuration=u.data.data,u.data}catch(u){throw this.error=((l=(n=u.response)==null?void 0:n.data)==null?void 0:l.message)||"Failed to connect calendar",u}finally{this.saving=!1}},async fetchConfiguration(){var i,t;this.loading=!0,this.error=null;try{const n=await m.get("/api/calendar/configuration");return this.configuration=n.data.data,this.configuration}catch(n){throw this.error=((t=(i=n.response)==null?void 0:i.data)==null?void 0:t.message)||"Failed to fetch configuration",n}finally{this.loading=!1}},async updateConfiguration(i){var t,n;this.saving=!0,this.error=null;try{const l=await m.put("/api/calendar/configuration",i);return this.configuration=l.data.data,l.data}catch(l){throw this.error=((n=(t=l.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to update configuration",l}finally{this.saving=!1}},async disconnect(){var i,t;this.saving=!0,this.error=null;try{await m.delete("/api/calendar/disconnect"),this.configuration=null,this.calendars=[]}catch(n){throw this.error=((t=(i=n.response)==null?void 0:i.data)==null?void 0:t.message)||"Failed to disconnect",n}finally{this.saving=!1}},async fetchAvailableDates(i=14){var t,n;this.loading=!0;try{const l=await m.get("/api/appointments/available-dates",{params:{days:i}});return this.availableDates=l.data.data||[],this.availableDates}catch(l){throw this.error=((n=(t=l.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to fetch dates",l}finally{this.loading=!1}},async fetchAvailableSlots(i){var t,n;try{return(await m.get("/api/appointments/available-slots",{params:{date:i}})).data.slots||[]}catch(l){throw this.error=((n=(t=l.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to fetch slots",l}},async fetchAppointments(i={}){var t,n;this.loading=!0;try{const l=await m.get("/api/appointments",{params:i});return this.appointments=l.data.data||[],l.data}catch(l){throw this.error=((n=(t=l.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to fetch appointments",l}finally{this.loading=!1}},async fetchUpcomingAppointments(i=5){var t,n;try{const l=await m.get("/api/appointments/upcoming",{params:{limit:i}});return this.upcomingAppointments=l.data.data||[],this.upcomingAppointments}catch(l){throw this.error=((n=(t=l.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to fetch upcoming",l}},async bookAppointment(i){var t,n;this.saving=!0;try{return(await m.post("/api/appointments",i)).data}catch(l){throw this.error=((n=(t=l.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to book appointment",l}finally{this.saving=!1}},async cancelAppointment(i,t=null){var n,l;this.saving=!0;try{return(await m.post(`/api/appointments/${i}/cancel`,{reason:t})).data}catch(u){throw this.error=((l=(n=u.response)==null?void 0:n.data)==null?void 0:l.message)||"Failed to cancel",u}finally{this.saving=!1}},async rescheduleAppointment(i,t){var n,l;this.saving=!0;try{return(await m.post(`/api/appointments/${i}/reschedule`,{start_time:t})).data}catch(u){throw this.error=((l=(n=u.response)==null?void 0:n.data)==null?void 0:l.message)||"Failed to reschedule",u}finally{this.saving=!1}},clearError(){this.error=null}}}),de={class:"space-y-6"},ue={key:0,class:"flex justify-center py-12"},ce={class:"text-center py-8"},pe={class:"flex items-center justify-between"},me={class:"flex items-center justify-between"},ge={class:"flex items-center gap-4"},fe={class:"font-semibold"},ye={class:"text-sm text-surface-500"},ve={class:"flex gap-2"},he={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},be={class:"space-y-4"},ke={class:"flex items-center justify-between"},we={class:"flex items-center gap-2"},xe={class:"flex items-center gap-2"},_e={class:"flex items-center gap-2"},Ce={class:"space-y-3"},Ae={class:"w-24 font-medium"},Ve={key:1,class:"text-surface-400"},Se={class:"flex justify-end"},Ue={class:"space-y-4"},Fe={class:"space-y-2"},Te=["onClick"],Ge={class:"flex items-center gap-3"},$e={class:"flex-1"},De={class:"font-medium"},Ee={key:0,class:"text-sm text-surface-500"},Le={key:1,class:"pi pi-check text-primary"},Qe={__name:"Index",setup(i){const t=re(),n=Q(),l=X(),u=ee(),_=h(!1),y=h(null),T=h(!1),S=h(!1),d=h({slot_duration:30,buffer_time:15,advance_booking_days:30,min_notice_hours:24,timezone:"Asia/Kuala_Lumpur",is_enabled:!0,booking_instructions:"",working_hours:E()}),K=[{label:"15 minutes",value:15},{label:"30 minutes",value:30},{label:"45 minutes",value:45},{label:"1 hour",value:60},{label:"1.5 hours",value:90},{label:"2 hours",value:120}],H=[{label:"Asia/Kuala_Lumpur (GMT+8)",value:"Asia/Kuala_Lumpur"},{label:"Asia/Singapore (GMT+8)",value:"Asia/Singapore"},{label:"Asia/Hong_Kong (GMT+8)",value:"Asia/Hong_Kong"},{label:"Asia/Tokyo (GMT+9)",value:"Asia/Tokyo"},{label:"America/New_York (EST)",value:"America/New_York"},{label:"America/Los_Angeles (PST)",value:"America/Los_Angeles"},{label:"Europe/London (GMT)",value:"Europe/London"},{label:"UTC",value:"UTC"}],P=[{key:"monday",label:"Monday"},{key:"tuesday",label:"Tuesday"},{key:"wednesday",label:"Wednesday"},{key:"thursday",label:"Thursday"},{key:"friday",label:"Friday"},{key:"saturday",label:"Saturday"},{key:"sunday",label:"Sunday"}];function E(){return{monday:{start:"09:00",end:"18:00",enabled:!0},tuesday:{start:"09:00",end:"18:00",enabled:!0},wednesday:{start:"09:00",end:"18:00",enabled:!0},thursday:{start:"09:00",end:"18:00",enabled:!0},friday:{start:"09:00",end:"18:00",enabled:!0},saturday:{start:"09:00",end:"13:00",enabled:!1},sunday:{start:"09:00",end:"13:00",enabled:!1}}}const U=h(null);Z(async()=>{if(await t.fetchConfiguration(),t.configuration&&(d.value={slot_duration:t.configuration.slot_duration||30,buffer_time:t.configuration.buffer_time||15,advance_booking_days:t.configuration.advance_booking_days||30,min_notice_hours:t.configuration.min_notice_hours||24,timezone:t.configuration.timezone||"Asia/Kuala_Lumpur",is_enabled:t.configuration.is_enabled??!0,booking_instructions:t.configuration.booking_instructions||"",working_hours:t.configuration.working_hours||E()}),u.query.google_connected==="pending"&&u.query.google_token){U.value=u.query.google_token,window.history.replaceState({},"","/calendar"),T.value=!0;try{await t.fetchCalendars(U.value),_.value=!0}catch{n.add({severity:"error",summary:"Error",detail:"Failed to load calendars. Please try connecting again.",life:5e3})}finally{T.value=!1}}u.query.error&&(n.add({severity:"error",summary:"Connection Failed",detail:decodeURIComponent(u.query.error),life:5e3}),window.history.replaceState({},"","/calendar")),t.isConnected&&await t.fetchUpcomingAppointments()});async function L(){var p,e;S.value=!0;try{const s=await t.getAuthUrl();window.location.href=s}catch(s){S.value=!1,n.add({severity:"error",summary:"Error",detail:((e=(p=s.response)==null?void 0:p.data)==null?void 0:e.message)||"Failed to start Google connection",life:5e3})}}async function R(){var p,e;if(!y.value){n.add({severity:"warn",summary:"Select Calendar",detail:"Please select a calendar to connect",life:3e3});return}try{await t.connectCalendar({calendar_id:y.value.id,calendar_name:y.value.name,...d.value},U.value),U.value=null,_.value=!1,n.add({severity:"success",summary:"Connected",detail:"Google Calendar connected successfully!",life:3e3}),window.history.replaceState({},"","/calendar")}catch(s){n.add({severity:"error",summary:"Error",detail:((e=(p=s.response)==null?void 0:p.data)==null?void 0:e.message)||"Failed to connect calendar",life:5e3})}}function W(){l.require({message:"Are you sure you want to disconnect Google Calendar? Existing appointments will remain but no new bookings can be made.",header:"Disconnect Calendar",icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-text",acceptClass:"p-button-danger",accept:async()=>{try{await t.disconnect(),n.add({severity:"success",summary:"Disconnected",detail:"Google Calendar has been disconnected",life:3e3})}catch{n.add({severity:"error",summary:"Error",detail:"Failed to disconnect calendar",life:5e3})}}})}async function O(){var p,e;try{await t.updateConfiguration(d.value),n.add({severity:"success",summary:"Saved",detail:"Calendar settings updated successfully",life:3e3})}catch(s){n.add({severity:"error",summary:"Error",detail:((e=(p=s.response)==null?void 0:p.data)==null?void 0:e.message)||"Failed to save settings",life:5e3})}}function z(p){return p?new Date(p).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}function Y(p){return{confirmed:"success",pending:"warn",cancelled:"danger",completed:"info",no_show:"secondary"}[p]||"secondary"}return(p,e)=>(g(),f(V,null,[r(o(ie)),a("div",de,[e[31]||(e[31]=a("div",{class:"flex items-center justify-between"},[a("div",null,[a("h1",{class:"text-2xl font-semibold"},"Calendar & Appointments"),a("p",{class:"text-surface-500 mt-1"}," Connect Google Calendar to let customers book appointments through chat ")])],-1)),o(t).loading&&!o(t).configuration?(g(),f("div",ue,[r(o(te))])):o(t).isConnected?(g(),f(V,{key:2},[r(o(x),null,{title:c(()=>[a("div",pe,[e[13]||(e[13]=a("span",null,"Google Calendar Connected",-1)),r(o(D),{value:o(t).isEnabled?"Active":"Paused",severity:o(t).isEnabled?"success":"warn"},null,8,["value","severity"])])]),content:c(()=>{var s;return[a("div",me,[a("div",ge,[e[14]||(e[14]=a("div",{class:"w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center"},[a("i",{class:"pi pi-google text-2xl text-blue-600 dark:text-blue-400"})],-1)),a("div",null,[a("p",fe,k(o(t).calendarName),1),a("p",ye," Last synced: "+k(z((s=o(t).configuration)==null?void 0:s.last_synced_at)),1)])]),a("div",ve,[r(o(b),{label:"Reconnect",icon:"pi pi-refresh",severity:"secondary",outlined:"",onClick:L,loading:S.value},null,8,["loading"]),r(o(b),{label:"Disconnect",icon:"pi pi-times",severity:"danger",outlined:"",onClick:W})])])]}),_:1}),a("div",he,[r(o(x),null,{title:c(()=>[...e[15]||(e[15]=[w("Booking Settings",-1)])]),content:c(()=>[a("div",be,[a("div",ke,[e[16]||(e[16]=a("div",null,[a("p",{class:"font-medium"},"Enable Booking"),a("p",{class:"text-sm text-surface-500"},"Allow customers to book via chat")],-1)),r(o(I),{modelValue:d.value.is_enabled,"onUpdate:modelValue":e[0]||(e[0]=s=>d.value.is_enabled=s)},null,8,["modelValue"])]),r(o(ne)),a("div",null,[e[17]||(e[17]=a("label",{class:"block text-sm font-medium mb-1"},"Appointment Duration",-1)),r(o(M),{modelValue:d.value.slot_duration,"onUpdate:modelValue":e[1]||(e[1]=s=>d.value.slot_duration=s),options:K,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])]),a("div",null,[e[19]||(e[19]=a("label",{class:"block text-sm font-medium mb-1"},"Buffer Time Between Appointments",-1)),a("div",we,[r(o($),{modelValue:d.value.buffer_time,"onUpdate:modelValue":e[2]||(e[2]=s=>d.value.buffer_time=s),min:0,max:60,class:"flex-shrink-0"},null,8,["modelValue"]),e[18]||(e[18]=a("span",{class:"text-surface-500 whitespace-nowrap flex-shrink-0"},"minutes",-1))])]),a("div",null,[e[21]||(e[21]=a("label",{class:"block text-sm font-medium mb-2"},"Advance Booking",-1)),a("div",xe,[r(o($),{modelValue:d.value.advance_booking_days,"onUpdate:modelValue":e[3]||(e[3]=s=>d.value.advance_booking_days=s),min:1,max:90,class:"flex-shrink-0"},null,8,["modelValue"]),e[20]||(e[20]=a("span",{class:"text-surface-500 whitespace-nowrap flex-shrink-0"},"days in advance",-1))])]),a("div",null,[e[23]||(e[23]=a("label",{class:"block text-sm font-medium mb-1"},"Minimum Notice",-1)),a("div",_e,[r(o($),{modelValue:d.value.min_notice_hours,"onUpdate:modelValue":e[4]||(e[4]=s=>d.value.min_notice_hours=s),min:1,max:168,class:"flex-shrink-0"},null,8,["modelValue"]),e[22]||(e[22]=a("span",{class:"text-surface-500 whitespace-nowrap flex-shrink-0"},"hours before appointment",-1))])]),a("div",null,[e[24]||(e[24]=a("label",{class:"block text-sm font-medium mb-1"},"Timezone",-1)),r(o(M),{modelValue:d.value.timezone,"onUpdate:modelValue":e[5]||(e[5]=s=>d.value.timezone=s),options:H,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])])])]),_:1}),r(o(x),null,{title:c(()=>[...e[25]||(e[25]=[w("Working Hours",-1)])]),content:c(()=>[a("div",Ce,[(g(),f(V,null,N(P,s=>{var C,A;return a("div",{key:s.key,class:j(["flex items-center gap-3 p-2 rounded-lg",(C=d.value.working_hours[s.key])!=null&&C.enabled?"bg-surface-50 dark:bg-surface-800":""])},[r(o(I),{modelValue:d.value.working_hours[s.key].enabled,"onUpdate:modelValue":v=>d.value.working_hours[s.key].enabled=v,class:"flex-shrink-0"},null,8,["modelValue","onUpdate:modelValue"]),a("span",Ae,k(s.label),1),(A=d.value.working_hours[s.key])!=null&&A.enabled?(g(),f(V,{key:0},[r(o(q),{modelValue:d.value.working_hours[s.key].start,"onUpdate:modelValue":v=>d.value.working_hours[s.key].start=v,type:"time",class:"w-36"},null,8,["modelValue","onUpdate:modelValue"]),e[26]||(e[26]=a("span",{class:"text-surface-500"},"to",-1)),r(o(q),{modelValue:d.value.working_hours[s.key].end,"onUpdate:modelValue":v=>d.value.working_hours[s.key].end=v,type:"time",class:"w-36"},null,8,["modelValue","onUpdate:modelValue"])],64)):(g(),f("span",Ve,"Closed"))],2)}),64))])]),_:1})]),r(o(x),null,{title:c(()=>[...e[27]||(e[27]=[w("Booking Instructions for AI",-1)])]),subtitle:c(()=>[...e[28]||(e[28]=[w(" Custom instructions to help AI handle appointment bookings ",-1)])]),content:c(()=>[r(o(se),{modelValue:d.value.booking_instructions,"onUpdate:modelValue":e[6]||(e[6]=s=>d.value.booking_instructions=s),rows:"4",class:"w-full",placeholder:"E.g., Always confirm the customer's phone number before booking. Mention that they will receive a calendar invite via email..."},null,8,["modelValue"])]),_:1}),a("div",Se,[r(o(b),{label:"Save Settings",icon:"pi pi-check",onClick:O,loading:o(t).saving},null,8,["loading"])]),r(o(x),null,{title:c(()=>[...e[29]||(e[29]=[w("Upcoming Appointments",-1)])]),content:c(()=>[r(o(le),{value:o(t).upcomingAppointments,loading:o(t).loading,responsiveLayout:"scroll",class:"p-datatable-sm"},{empty:c(()=>[...e[30]||(e[30]=[a("div",{class:"text-center py-6 text-surface-500"}," No upcoming appointments ",-1)])]),default:c(()=>[r(o(F),{field:"start_time",header:"Date & Time"},{body:c(({data:s})=>[w(k(z(s.start_time)),1)]),_:1}),r(o(F),{field:"customer_name",header:"Customer"}),r(o(F),{field:"title",header:"Title"}),r(o(F),{field:"status",header:"Status"},{body:c(({data:s})=>[r(o(D),{value:s.status,severity:Y(s.status)},null,8,["value","severity"])]),_:1})]),_:1},8,["value","loading"])]),_:1})],64)):(g(),B(o(x),{key:1},{content:c(()=>[a("div",ce,[e[9]||(e[9]=a("i",{class:"pi pi-calendar text-6xl text-surface-300 dark:text-surface-600 mb-4"},null,-1)),e[10]||(e[10]=a("h2",{class:"text-xl font-semibold mb-2"},"Connect Google Calendar",-1)),e[11]||(e[11]=a("p",{class:"text-surface-500 mb-6 max-w-md mx-auto"}," Allow customers to book appointments directly through chat. The AI will check your calendar availability and schedule appointments automatically. ",-1)),r(o(b),{label:"Connect Google Calendar",icon:"pi pi-google",size:"large",onClick:L,loading:S.value||T.value},null,8,["loading"]),e[12]||(e[12]=a("div",{class:"mt-8 text-left max-w-lg mx-auto"},[a("h3",{class:"font-semibold mb-3"},"How it works:"),a("ul",{class:"space-y-2 text-surface-600 dark:text-surface-400"},[a("li",{class:"flex items-start gap-2"},[a("i",{class:"pi pi-check-circle text-green-500 mt-1"}),a("span",null,"Connect your Google Calendar with one click")]),a("li",{class:"flex items-start gap-2"},[a("i",{class:"pi pi-check-circle text-green-500 mt-1"}),a("span",null,"Set your working hours and appointment duration")]),a("li",{class:"flex items-start gap-2"},[a("i",{class:"pi pi-check-circle text-green-500 mt-1"}),a("span",null,"AI will check availability and book appointments")]),a("li",{class:"flex items-start gap-2"},[a("i",{class:"pi pi-check-circle text-green-500 mt-1"}),a("span",null,"Appointments sync to your Google Calendar automatically")])])],-1))])]),_:1}))]),r(o(oe),{visible:_.value,"onUpdate:visible":e[8]||(e[8]=s=>_.value=s),header:"Select Calendar",style:{width:"500px"},modal:"",closable:!1},{footer:c(()=>[r(o(b),{label:"Cancel",severity:"secondary",outlined:"",onClick:e[7]||(e[7]=s=>{_.value=!1,p.window.history.replaceState({},"","/calendar")})}),r(o(b),{label:"Connect Calendar",icon:"pi pi-check",onClick:R,loading:o(t).saving,disabled:!y.value},null,8,["loading","disabled"])]),default:c(()=>[a("div",Ue,[e[32]||(e[32]=a("p",{class:"text-surface-600 dark:text-surface-400"}," Select which calendar to use for appointment bookings: ",-1)),a("div",Fe,[(g(!0),f(V,null,N(o(t).calendars,s=>{var C,A;return g(),f("div",{key:s.id,class:j(["p-3 border rounded-lg cursor-pointer transition-colors",((C=y.value)==null?void 0:C.id)===s.id?"border-primary bg-primary/10":"border-surface-200 dark:border-surface-700 hover:border-primary"]),onClick:v=>y.value=s},[a("div",Ge,[a("div",{class:"w-4 h-4 rounded-full",style:ae({backgroundColor:s.backgroundColor||"#4285f4"})},null,4),a("div",$e,[a("p",De,k(s.name),1),s.description?(g(),f("p",Ee,k(s.description),1)):G("",!0)]),s.primary?(g(),B(o(D),{key:0,value:"Primary",severity:"info"})):G("",!0),((A=y.value)==null?void 0:A.id)===s.id?(g(),f("i",Le)):G("",!0)])],10,Te)}),128))])])]),_:1},8,["visible"])],64))}};export{Qe as default};
