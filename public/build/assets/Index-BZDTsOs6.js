import{d as Q,z as m,q as X,a9 as Z,r as h,o as ee,C as te,b as f,g as r,e as a,i as o,B as j,A as ae,w as u,F as V,j as v,v as se,m as g,t as k,l as S,k as N,n as M,h as $,p as ne}from"./app-BgQ0ba_x.js";import{s as w}from"./index-hpZWgBgc.js";import{s as q}from"./index-BWK8tbLp.js";import{s as D}from"./index-iiizaaRQ.js";import{s as I}from"./index-O1aibNdm.js";import{s as oe}from"./index-NI41lIvu.js";import{s as K}from"./index-CWWB2MDf.js";import{s as E}from"./index-Dp3m66c3.js";import{s as le}from"./index-DBwqtjYl.js";import{s as ie}from"./index-BWP7Siyo.js";import{s as re,a as T}from"./index-BhyZtKT4.js";import{s as de}from"./index-L6cl8ov8.js";import"./index-DHYItjgp.js";import"./index-DN1uuq7j.js";import"./index-BczGAEUi.js";const ue=Q("calendar",{state:()=>({configuration:null,calendars:[],availableDates:[],appointments:[],upcomingAppointments:[],loading:!1,saving:!1,error:null,isConnecting:!1}),getters:{isConnected:i=>{var l;return((l=i.configuration)==null?void 0:l.is_connected)||!1},isEnabled:i=>{var l;return((l=i.configuration)==null?void 0:l.is_enabled)||!1},calendarName:i=>{var l;return((l=i.configuration)==null?void 0:l.calendar_name)||null}},actions:{async getAuthUrl(){var i,l;try{return(await m.get("/api/auth/google/url")).data.url}catch(t){throw this.error=((l=(i=t.response)==null?void 0:i.data)==null?void 0:l.message)||"Failed to get auth URL",t}},async fetchCalendars(i){var l,t;this.loading=!0,this.error=null;try{const s=await m.get("/api/calendar/calendars",{params:{google_token:i}});return this.calendars=s.data.calendars||[],this.calendars}catch(s){throw this.error=((t=(l=s.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to fetch calendars",s}finally{this.loading=!1}},async connectCalendar(i,l){var t,s;this.saving=!0,this.error=null;try{const p=await m.post("/api/calendar/connect",{...i,google_token:l});return this.configuration=p.data.data,p.data}catch(p){throw this.error=((s=(t=p.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to connect calendar",p}finally{this.saving=!1}},async fetchConfiguration(){var i,l;this.loading=!0,this.error=null;try{const t=await m.get("/api/calendar/configuration");return this.configuration=t.data.data,this.configuration}catch(t){throw this.error=((l=(i=t.response)==null?void 0:i.data)==null?void 0:l.message)||"Failed to fetch configuration",t}finally{this.loading=!1}},async updateConfiguration(i){var l,t;this.saving=!0,this.error=null;try{const s=await m.put("/api/calendar/configuration",i);return this.configuration=s.data.data,s.data}catch(s){throw this.error=((t=(l=s.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to update configuration",s}finally{this.saving=!1}},async disconnect(){var i,l;this.saving=!0,this.error=null;try{await m.delete("/api/calendar/disconnect"),this.configuration=null,this.calendars=[]}catch(t){throw this.error=((l=(i=t.response)==null?void 0:i.data)==null?void 0:l.message)||"Failed to disconnect",t}finally{this.saving=!1}},async fetchAvailableDates(i=14){var l,t;this.loading=!0;try{const s=await m.get("/api/appointments/available-dates",{params:{days:i}});return this.availableDates=s.data.data||[],this.availableDates}catch(s){throw this.error=((t=(l=s.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to fetch dates",s}finally{this.loading=!1}},async fetchAvailableSlots(i){var l,t;try{return(await m.get("/api/appointments/available-slots",{params:{date:i}})).data.slots||[]}catch(s){throw this.error=((t=(l=s.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to fetch slots",s}},async fetchAppointments(i={}){var l,t;this.loading=!0;try{const s=await m.get("/api/appointments",{params:i});return this.appointments=s.data.data||[],s.data}catch(s){throw this.error=((t=(l=s.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to fetch appointments",s}finally{this.loading=!1}},async fetchUpcomingAppointments(i=5){var l,t;try{const s=await m.get("/api/appointments/upcoming",{params:{limit:i}});return this.upcomingAppointments=s.data.data||[],this.upcomingAppointments}catch(s){throw this.error=((t=(l=s.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to fetch upcoming",s}},async bookAppointment(i){var l,t;this.saving=!0;try{return(await m.post("/api/appointments",i)).data}catch(s){throw this.error=((t=(l=s.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to book appointment",s}finally{this.saving=!1}},async cancelAppointment(i,l=null){var t,s;this.saving=!0;try{return(await m.post(`/api/appointments/${i}/cancel`,{reason:l})).data}catch(p){throw this.error=((s=(t=p.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to cancel",p}finally{this.saving=!1}},async rescheduleAppointment(i,l){var t,s;this.saving=!0;try{return(await m.post(`/api/appointments/${i}/reschedule`,{start_time:l})).data}catch(p){throw this.error=((s=(t=p.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to reschedule",p}finally{this.saving=!1}},clearError(){this.error=null}}}),ce={class:"space-y-6"},pe={key:0,class:"flex justify-center py-12"},me={class:"text-center py-8"},ge={class:"flex items-center justify-between"},fe={class:"flex items-center justify-between"},ye={class:"flex items-center gap-4"},ve={class:"font-semibold"},be={class:"text-sm text-surface-500"},he={class:"flex gap-2"},ke={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},we={class:"space-y-4"},_e={class:"flex items-center justify-between"},xe={class:"flex items-center gap-2"},Ce={class:"flex items-center gap-2"},Ae={class:"flex items-center gap-2"},Ve={class:"space-y-3"},Se={class:"w-24 font-medium"},Ue={key:1,class:"text-surface-400"},Fe={class:"flex justify-end"},Te={class:"flex items-center justify-between"},Ge={class:"space-y-4"},$e={class:"space-y-2"},De=["onClick"],Ee={class:"flex items-center gap-3"},Le={class:"flex-1"},ze={class:"font-medium"},Be={key:0,class:"text-sm text-surface-500"},je={key:1,class:"pi pi-check text-primary"},et={__name:"Index",setup(i){const l=se(),t=ue(),s=X(),p=Z(),_=te(),x=h(!1),y=h(null),G=h(!1),U=h(!1),d=h({slot_duration:30,buffer_time:15,advance_booking_days:30,min_notice_hours:24,timezone:"Asia/Kuala_Lumpur",is_enabled:!0,booking_instructions:"",working_hours:L()}),P=[{label:"15 minutes",value:15},{label:"30 minutes",value:30},{label:"45 minutes",value:45},{label:"1 hour",value:60},{label:"1.5 hours",value:90},{label:"2 hours",value:120}],H=[{label:"Asia/Kuala_Lumpur (GMT+8)",value:"Asia/Kuala_Lumpur"},{label:"Asia/Singapore (GMT+8)",value:"Asia/Singapore"},{label:"Asia/Hong_Kong (GMT+8)",value:"Asia/Hong_Kong"},{label:"Asia/Tokyo (GMT+9)",value:"Asia/Tokyo"},{label:"America/New_York (EST)",value:"America/New_York"},{label:"America/Los_Angeles (PST)",value:"America/Los_Angeles"},{label:"Europe/London (GMT)",value:"Europe/London"},{label:"UTC",value:"UTC"}],R=[{key:"monday",label:"Monday"},{key:"tuesday",label:"Tuesday"},{key:"wednesday",label:"Wednesday"},{key:"thursday",label:"Thursday"},{key:"friday",label:"Friday"},{key:"saturday",label:"Saturday"},{key:"sunday",label:"Sunday"}];function L(){return{monday:{start:"09:00",end:"18:00",enabled:!0},tuesday:{start:"09:00",end:"18:00",enabled:!0},wednesday:{start:"09:00",end:"18:00",enabled:!0},thursday:{start:"09:00",end:"18:00",enabled:!0},friday:{start:"09:00",end:"18:00",enabled:!0},saturday:{start:"09:00",end:"13:00",enabled:!1},sunday:{start:"09:00",end:"13:00",enabled:!1}}}const F=h(null);ee(async()=>{if(await t.fetchConfiguration(),t.configuration&&(d.value={slot_duration:t.configuration.slot_duration||30,buffer_time:t.configuration.buffer_time||15,advance_booking_days:t.configuration.advance_booking_days||30,min_notice_hours:t.configuration.min_notice_hours||24,timezone:t.configuration.timezone||"Asia/Kuala_Lumpur",is_enabled:t.configuration.is_enabled??!0,booking_instructions:t.configuration.booking_instructions||"",working_hours:t.configuration.working_hours||L()}),_.query.google_connected==="pending"&&_.query.google_token){F.value=_.query.google_token,window.history.replaceState({},"","/calendar"),G.value=!0;try{await t.fetchCalendars(F.value),x.value=!0}catch{s.add({severity:"error",summary:"Error",detail:"Failed to load calendars. Please try connecting again.",life:5e3})}finally{G.value=!1}}_.query.error&&(s.add({severity:"error",summary:"Connection Failed",detail:decodeURIComponent(_.query.error),life:5e3}),window.history.replaceState({},"","/calendar")),t.isConnected&&await t.fetchUpcomingAppointments()});async function z(){var c,e;U.value=!0;try{const n=await t.getAuthUrl();window.location.href=n}catch(n){U.value=!1,s.add({severity:"error",summary:"Error",detail:((e=(c=n.response)==null?void 0:c.data)==null?void 0:e.message)||"Failed to start Google connection",life:5e3})}}async function W(){var c,e;if(!y.value){s.add({severity:"warn",summary:"Select Calendar",detail:"Please select a calendar to connect",life:3e3});return}try{await t.connectCalendar({calendar_id:y.value.id,calendar_name:y.value.name,...d.value},F.value),F.value=null,x.value=!1,s.add({severity:"success",summary:"Connected",detail:"Google Calendar connected successfully!",life:3e3}),window.history.replaceState({},"","/calendar")}catch(n){s.add({severity:"error",summary:"Error",detail:((e=(c=n.response)==null?void 0:c.data)==null?void 0:e.message)||"Failed to connect calendar",life:5e3})}}function O(){p.require({message:"Are you sure you want to disconnect Google Calendar? Existing appointments will remain but no new bookings can be made.",header:"Disconnect Calendar",icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-text",acceptClass:"p-button-danger",accept:async()=>{try{await t.disconnect(),s.add({severity:"success",summary:"Disconnected",detail:"Google Calendar has been disconnected",life:3e3})}catch{s.add({severity:"error",summary:"Error",detail:"Failed to disconnect calendar",life:5e3})}}})}async function Y(){var c,e;try{await t.updateConfiguration(d.value),s.add({severity:"success",summary:"Saved",detail:"Calendar settings updated successfully",life:3e3})}catch(n){s.add({severity:"error",summary:"Error",detail:((e=(c=n.response)==null?void 0:c.data)==null?void 0:e.message)||"Failed to save settings",life:5e3})}}function B(c){return c?new Date(c).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}function J(c){return{confirmed:"success",pending:"warn",cancelled:"danger",completed:"info",no_show:"secondary"}[c]||"secondary"}return(c,e)=>(g(),f(V,null,[r(o(de)),a("div",ce,[e[32]||(e[32]=a("div",{class:"flex items-center justify-between"},[a("div",null,[a("h1",{class:"text-2xl font-semibold"},"Calendar & Appointments"),a("p",{class:"text-surface-500 mt-1"}," Connect Google Calendar to let customers book appointments through chat ")])],-1)),o(t).loading&&!o(t).configuration?(g(),f("div",pe,[r(o(ae))])):o(t).isConnected?(g(),f(V,{key:2},[r(o(w),null,{title:u(()=>[a("div",ge,[e[14]||(e[14]=a("span",null,"Google Calendar Connected",-1)),r(o(E),{value:o(t).isEnabled?"Active":"Paused",severity:o(t).isEnabled?"success":"warn"},null,8,["value","severity"])])]),content:u(()=>{var n;return[a("div",fe,[a("div",ye,[e[15]||(e[15]=a("div",{class:"w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center"},[a("i",{class:"pi pi-google text-2xl text-blue-600 dark:text-blue-400"})],-1)),a("div",null,[a("p",ve,k(o(t).calendarName),1),a("p",be," Last synced: "+k(B((n=o(t).configuration)==null?void 0:n.last_synced_at)),1)])]),a("div",he,[r(o(v),{label:"Reconnect",icon:"pi pi-refresh",severity:"secondary",outlined:"",onClick:z,loading:U.value},null,8,["loading"]),r(o(v),{label:"Disconnect",icon:"pi pi-times",severity:"danger",outlined:"",onClick:O})])])]}),_:1}),a("div",ke,[r(o(w),null,{title:u(()=>[...e[16]||(e[16]=[S("Booking Settings",-1)])]),content:u(()=>[a("div",we,[a("div",_e,[e[17]||(e[17]=a("div",null,[a("p",{class:"font-medium"},"Enable Booking"),a("p",{class:"text-sm text-surface-500"},"Allow customers to book via chat")],-1)),r(o(K),{modelValue:d.value.is_enabled,"onUpdate:modelValue":e[0]||(e[0]=n=>d.value.is_enabled=n)},null,8,["modelValue"])]),r(o(le)),a("div",null,[e[18]||(e[18]=a("label",{class:"block text-sm font-medium mb-1"},"Appointment Duration",-1)),r(o(q),{modelValue:d.value.slot_duration,"onUpdate:modelValue":e[1]||(e[1]=n=>d.value.slot_duration=n),options:P,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])]),a("div",null,[e[20]||(e[20]=a("label",{class:"block text-sm font-medium mb-1"},"Buffer Time Between Appointments",-1)),a("div",xe,[r(o(D),{modelValue:d.value.buffer_time,"onUpdate:modelValue":e[2]||(e[2]=n=>d.value.buffer_time=n),min:0,max:60,class:"w-24"},null,8,["modelValue"]),e[19]||(e[19]=a("span",{class:"text-surface-500"},"minutes",-1))])]),a("div",null,[e[22]||(e[22]=a("label",{class:"block text-sm font-medium mb-2"},"Advance Booking",-1)),a("div",Ce,[r(o(D),{modelValue:d.value.advance_booking_days,"onUpdate:modelValue":e[3]||(e[3]=n=>d.value.advance_booking_days=n),min:1,max:90,class:"w-24"},null,8,["modelValue"]),e[21]||(e[21]=a("span",{class:"text-surface-500 whitespace-nowrap"},"days in advance",-1))])]),a("div",null,[e[24]||(e[24]=a("label",{class:"block text-sm font-medium mb-1"},"Minimum Notice",-1)),a("div",Ae,[r(o(D),{modelValue:d.value.min_notice_hours,"onUpdate:modelValue":e[4]||(e[4]=n=>d.value.min_notice_hours=n),min:1,max:168,class:"w-24"},null,8,["modelValue"]),e[23]||(e[23]=a("span",{class:"text-surface-500"},"hours before appointment",-1))])]),a("div",null,[e[25]||(e[25]=a("label",{class:"block text-sm font-medium mb-1"},"Timezone",-1)),r(o(q),{modelValue:d.value.timezone,"onUpdate:modelValue":e[5]||(e[5]=n=>d.value.timezone=n),options:H,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])])])]),_:1}),r(o(w),null,{title:u(()=>[...e[26]||(e[26]=[S("Working Hours",-1)])]),content:u(()=>[a("div",Ve,[(g(),f(V,null,N(R,n=>{var C,A;return a("div",{key:n.key,class:M(["flex items-center gap-3 p-2 rounded-lg",(C=d.value.working_hours[n.key])!=null&&C.enabled?"bg-surface-50 dark:bg-surface-800":""])},[r(o(K),{modelValue:d.value.working_hours[n.key].enabled,"onUpdate:modelValue":b=>d.value.working_hours[n.key].enabled=b,class:"flex-shrink-0"},null,8,["modelValue","onUpdate:modelValue"]),a("span",Se,k(n.label),1),(A=d.value.working_hours[n.key])!=null&&A.enabled?(g(),f(V,{key:0},[r(o(I),{modelValue:d.value.working_hours[n.key].start,"onUpdate:modelValue":b=>d.value.working_hours[n.key].start=b,type:"time",class:"w-28"},null,8,["modelValue","onUpdate:modelValue"]),e[27]||(e[27]=a("span",{class:"text-surface-500"},"to",-1)),r(o(I),{modelValue:d.value.working_hours[n.key].end,"onUpdate:modelValue":b=>d.value.working_hours[n.key].end=b,type:"time",class:"w-28"},null,8,["modelValue","onUpdate:modelValue"])],64)):(g(),f("span",Ue,"Closed"))],2)}),64))])]),_:1})]),r(o(w),null,{title:u(()=>[...e[28]||(e[28]=[S("Booking Instructions for AI",-1)])]),subtitle:u(()=>[...e[29]||(e[29]=[S(" Custom instructions to help AI handle appointment bookings ",-1)])]),content:u(()=>[r(o(oe),{modelValue:d.value.booking_instructions,"onUpdate:modelValue":e[6]||(e[6]=n=>d.value.booking_instructions=n),rows:"4",class:"w-full",placeholder:"E.g., Always confirm the customer's phone number before booking. Mention that they will receive a calendar invite via email..."},null,8,["modelValue"])]),_:1}),a("div",Fe,[r(o(v),{label:"Save Settings",icon:"pi pi-check",onClick:Y,loading:o(t).saving},null,8,["loading"])]),r(o(w),null,{title:u(()=>[a("div",Te,[e[30]||(e[30]=a("span",null,"Upcoming Appointments",-1)),r(o(v),{label:"View All",icon:"pi pi-external-link",link:"",size:"small",iconPos:"right",onClick:e[7]||(e[7]=n=>o(l).push("/appointments"))})])]),content:u(()=>[r(o(re),{value:o(t).upcomingAppointments,loading:o(t).loading,responsiveLayout:"scroll",class:"p-datatable-sm"},{empty:u(()=>[...e[31]||(e[31]=[a("div",{class:"text-center py-6 text-surface-500"}," No upcoming appointments ",-1)])]),default:u(()=>[r(o(T),{field:"start_time",header:"Date & Time"},{body:u(({data:n})=>[S(k(B(n.start_time)),1)]),_:1}),r(o(T),{field:"customer_name",header:"Customer"}),r(o(T),{field:"title",header:"Title"}),r(o(T),{field:"status",header:"Status"},{body:u(({data:n})=>[r(o(E),{value:n.status,severity:J(n.status)},null,8,["value","severity"])]),_:1})]),_:1},8,["value","loading"])]),_:1})],64)):(g(),j(o(w),{key:1},{content:u(()=>[a("div",me,[e[10]||(e[10]=a("i",{class:"pi pi-calendar text-6xl text-surface-300 dark:text-surface-600 mb-4"},null,-1)),e[11]||(e[11]=a("h2",{class:"text-xl font-semibold mb-2"},"Connect Google Calendar",-1)),e[12]||(e[12]=a("p",{class:"text-surface-500 mb-6 max-w-md mx-auto"}," Allow customers to book appointments directly through chat. The AI will check your calendar availability and schedule appointments automatically. ",-1)),r(o(v),{label:"Connect Google Calendar",icon:"pi pi-google",size:"large",onClick:z,loading:U.value||G.value},null,8,["loading"]),e[13]||(e[13]=a("div",{class:"mt-8 text-left max-w-lg mx-auto"},[a("h3",{class:"font-semibold mb-3"},"How it works:"),a("ul",{class:"space-y-2 text-surface-600 dark:text-surface-400"},[a("li",{class:"flex items-start gap-2"},[a("i",{class:"pi pi-check-circle text-green-500 mt-1"}),a("span",null,"Connect your Google Calendar with one click")]),a("li",{class:"flex items-start gap-2"},[a("i",{class:"pi pi-check-circle text-green-500 mt-1"}),a("span",null,"Set your working hours and appointment duration")]),a("li",{class:"flex items-start gap-2"},[a("i",{class:"pi pi-check-circle text-green-500 mt-1"}),a("span",null,"AI will check availability and book appointments")]),a("li",{class:"flex items-start gap-2"},[a("i",{class:"pi pi-check-circle text-green-500 mt-1"}),a("span",null,"Appointments sync to your Google Calendar automatically")])])],-1))])]),_:1}))]),r(o(ie),{visible:x.value,"onUpdate:visible":e[9]||(e[9]=n=>x.value=n),header:"Select Calendar",style:{width:"500px"},modal:"",closable:!1},{footer:u(()=>[r(o(v),{label:"Cancel",severity:"secondary",outlined:"",onClick:e[8]||(e[8]=n=>{x.value=!1,c.window.history.replaceState({},"","/calendar")})}),r(o(v),{label:"Connect Calendar",icon:"pi pi-check",onClick:W,loading:o(t).saving,disabled:!y.value},null,8,["loading","disabled"])]),default:u(()=>[a("div",Ge,[e[33]||(e[33]=a("p",{class:"text-surface-600 dark:text-surface-400"}," Select which calendar to use for appointment bookings: ",-1)),a("div",$e,[(g(!0),f(V,null,N(o(t).calendars,n=>{var C,A;return g(),f("div",{key:n.id,class:M(["p-3 border rounded-lg cursor-pointer transition-colors",((C=y.value)==null?void 0:C.id)===n.id?"border-primary bg-primary/10":"border-surface-200 dark:border-surface-700 hover:border-primary"]),onClick:b=>y.value=n},[a("div",Ee,[a("div",{class:"w-4 h-4 rounded-full",style:ne({backgroundColor:n.backgroundColor||"#4285f4"})},null,4),a("div",Le,[a("p",ze,k(n.name),1),n.description?(g(),f("p",Be,k(n.description),1)):$("",!0)]),n.primary?(g(),j(o(E),{key:0,value:"Primary",severity:"info"})):$("",!0),((A=y.value)==null?void 0:A.id)===n.id?(g(),f("i",je)):$("",!0)])],10,De)}),128))])])]),_:1},8,["visible"])],64))}};export{et as default};
