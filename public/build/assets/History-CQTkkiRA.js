import{q as W,r as j,c as F,o as q,C as A,b as p,e as a,g as l,i as t,j as m,w as c,X as T,m as d,B as _,h as x,t as n,l as w,Z as b,F as O,k as H,n as $}from"./app-COZ50StM.js";import{u as X,s as D}from"./index-DGgTftJO.js";import{s as V}from"./index-BluEwxCg.js";import{s as Z,a as f}from"./index-BotssOam.js";import{s as g}from"./index-D8SOZXLq.js";import{s as G}from"./index-lWUrvOYP.js";import"./index-B0AQL8E4.js";import"./index-CXogGqNS.js";import"./index-DZelkFbS.js";import"./index-C0zA7P76.js";import"./index-Brg-r7B6.js";import"./index-CbPeJRyp.js";const J={class:"p-6"},K={class:"flex items-center justify-between mb-6"},Q={class:"flex gap-3"},Y={class:"flex flex-wrap gap-4 items-center"},ee={class:"text-surface-600 dark:text-surface-400"},te={class:"font-medium text-surface-900 dark:text-surface-0"},se={class:"flex gap-2"},re={key:0},ae={class:"grid grid-cols-2 gap-4 mb-6"},oe={class:"font-medium text-surface-900 dark:text-surface-0"},ie={class:"text-surface-900 dark:text-surface-0"},le={class:"text-surface-900 dark:text-surface-0"},ne={key:0,class:"col-span-2"},ce={class:"text-red-600 dark:text-red-400"},ue={class:"space-y-2 max-h-96 overflow-y-auto"},de={class:"flex items-center justify-between mb-2"},fe={class:"flex items-center gap-2"},pe={class:"font-medium text-surface-900 dark:text-surface-0"},xe={class:"text-xs text-surface-500 dark:text-surface-400"},me={key:0,class:"text-sm text-red-600 dark:text-red-400"},ve={key:0,class:"text-center py-8 text-surface-500 dark:text-surface-400"},Se={__name:"History",setup(ye){const h=A(),v=W(),r=X(),k=j(!1),S=[{value:"pending",label:"Pending"},{value:"running",label:"Running"},{value:"completed",label:"Completed"},{value:"failed",label:"Failed"},{value:"paused",label:"Paused"},{value:"cancelled",label:"Cancelled"}],I=F(()=>r.workflows.map(o=>({value:o.id,label:o.name}))),L=F(()=>!!(r.executionsFilters.status||r.executionsFilters.workflowId||r.executionsFilters.customerId||r.executionsFilters.conversationId));function E(o){return{pending:"secondary",running:"info",completed:"success",failed:"danger",paused:"warn",cancelled:"secondary"}[o]||"secondary"}function R(o){return{started:"info",completed:"success",failed:"danger",skipped:"secondary"}[o]||"secondary"}function z(o){return{trigger:"pi pi-bolt",action:"pi pi-play",condition:"pi pi-code",delay:"pi pi-clock",parallel:"pi pi-sitemap",loop:"pi pi-refresh",ai_response:"pi pi-android",merge:"pi pi-arrow-compress"}[o]||"pi pi-cog"}function y(o){return o?new Date(o).toLocaleString():"-"}function C(o){if(!o.started_at)return"-";const s=new Date(o.started_at),u=o.completed_at||o.failed_at||new Date,e=Math.floor((u-s)/1e3);return e<60?`${e}s`:e<3600?`${Math.floor(e/60)}m ${e%60}s`:`${Math.floor(e/3600)}h ${Math.floor(e%3600/60)}m`}function N(o){r.fetchExecutionDetails(o).then(()=>{k.value=!0})}async function B(o){var s,u;try{await r.cancelExecution(o),v.add({severity:"success",summary:"Cancelled",detail:"Execution cancelled successfully"}),await r.fetchExecutions()}catch(e){v.add({severity:"error",summary:"Error",detail:((u=(s=e.response)==null?void 0:s.data)==null?void 0:u.message)||"Failed to cancel execution"})}}async function M(o){var s,u;try{await r.retryExecution(o),v.add({severity:"success",summary:"Retrying",detail:"Execution retry started"}),await r.fetchExecutions()}catch(e){v.add({severity:"error",summary:"Error",detail:((u=(s=e.response)==null?void 0:s.data)==null?void 0:u.message)||"Failed to retry execution"})}}function P(){r.resetExecutionsFilters(),r.fetchExecutions()}function U(o){r.fetchExecutions(o.page+1)}return q(async()=>{await r.fetchWorkflows(),h.query.workflow_id&&(r.executionsFilters.workflowId=parseInt(h.query.workflow_id)),await r.fetchExecutions()}),(o,s)=>{const u=T("tooltip");return d(),p("div",J,[a("div",K,[s[6]||(s[6]=a("div",null,[a("h1",{class:"text-2xl font-bold text-surface-900 dark:text-surface-0"},"Workflow Executions"),a("p",{class:"text-surface-600 dark:text-surface-400 mt-1"},"View and manage workflow execution history")],-1)),a("div",Q,[l(t(m),{label:"Refresh",icon:"pi pi-refresh",outlined:"",onClick:s[0]||(s[0]=e=>t(r).fetchExecutions())})])]),l(t(V),{class:"mb-6 p-4"},{default:c(()=>[a("div",Y,[l(t(D),{modelValue:t(r).executionsFilters.status,"onUpdate:modelValue":s[1]||(s[1]=e=>t(r).executionsFilters.status=e),options:S,optionLabel:"label",optionValue:"value",placeholder:"Filter by status",class:"w-48",showClear:"",onChange:s[2]||(s[2]=e=>t(r).fetchExecutions())},null,8,["modelValue"]),l(t(D),{modelValue:t(r).executionsFilters.workflowId,"onUpdate:modelValue":s[3]||(s[3]=e=>t(r).executionsFilters.workflowId=e),options:I.value,optionLabel:"label",optionValue:"value",placeholder:"Filter by workflow",class:"w-56",showClear:"",onChange:s[4]||(s[4]=e=>t(r).fetchExecutions())},null,8,["modelValue","options"]),L.value?(d(),_(t(m),{key:0,label:"Clear Filters",icon:"pi pi-filter-slash",outlined:"",onClick:P})):x("",!0)])]),_:1}),l(t(V),null,{content:c(()=>[l(t(Z),{value:t(r).executions,loading:t(r).loadingExecutions,paginator:"",rows:15,totalRecords:t(r).executionsPagination.total,lazy:"",onPage:U,stripedRows:"",class:"p-datatable-sm"},{default:c(()=>[l(t(f),{field:"id",header:"ID",sortable:"",style:{width:"80px"}},{body:c(({data:e})=>[a("span",ee,"#"+n(e.id),1)]),_:1}),l(t(f),{field:"workflow.name",header:"Workflow",sortable:""},{body:c(({data:e})=>{var i;return[a("span",te,n(((i=e.workflow)==null?void 0:i.name)||"Unknown"),1)]}),_:1}),l(t(f),{field:"customer.name",header:"Customer",sortable:""},{body:c(({data:e})=>{var i;return[w(n(((i=e.customer)==null?void 0:i.name)||"N/A"),1)]}),_:1}),l(t(f),{field:"status",header:"Status",sortable:"",style:{width:"120px"}},{body:c(({data:e})=>[l(t(g),{value:e.status,severity:E(e.status)},null,8,["value","severity"])]),_:1}),l(t(f),{field:"created_at",header:"Started",sortable:""},{body:c(({data:e})=>[w(n(y(e.created_at)),1)]),_:1}),l(t(f),{field:"completed_at",header:"Completed"},{body:c(({data:e})=>[w(n(e.completed_at?y(e.completed_at):"-"),1)]),_:1}),l(t(f),{header:"Duration",style:{width:"100px"}},{body:c(({data:e})=>[w(n(C(e)),1)]),_:1}),l(t(f),{header:"Actions",style:{width:"150px"}},{body:c(({data:e})=>[a("div",se,[b(l(t(m),{icon:"pi pi-eye",text:"",size:"small",onClick:i=>N(e.id)},null,8,["onClick"]),[[u,"View Details"]]),e.status==="failed"?b((d(),_(t(m),{key:0,icon:"pi pi-refresh",text:"",size:"small",severity:"warn",onClick:i=>M(e.id)},null,8,["onClick"])),[[u,"Retry"]]):x("",!0),["running","pending"].includes(e.status)?b((d(),_(t(m),{key:1,icon:"pi pi-times",text:"",size:"small",severity:"danger",onClick:i=>B(e.id)},null,8,["onClick"])),[[u,"Cancel"]]):x("",!0)])]),_:1})]),_:1},8,["value","loading","totalRecords"])]),_:1}),l(t(G),{visible:k.value,"onUpdate:visible":s[5]||(s[5]=e=>k.value=e),header:"Execution Details",modal:"",class:"w-full max-w-4xl"},{default:c(()=>{var e;return[t(r).currentExecution?(d(),p("div",re,[a("div",ae,[a("div",null,[s[7]||(s[7]=a("label",{class:"text-xs text-surface-500 dark:text-surface-400"},"Workflow",-1)),a("p",oe,n((e=t(r).currentExecution.workflow)==null?void 0:e.name),1)]),a("div",null,[s[8]||(s[8]=a("label",{class:"text-xs text-surface-500 dark:text-surface-400"},"Status",-1)),a("p",null,[l(t(g),{value:t(r).currentExecution.status,severity:E(t(r).currentExecution.status)},null,8,["value","severity"])])]),a("div",null,[s[9]||(s[9]=a("label",{class:"text-xs text-surface-500 dark:text-surface-400"},"Started",-1)),a("p",ie,n(y(t(r).currentExecution.started_at)),1)]),a("div",null,[s[10]||(s[10]=a("label",{class:"text-xs text-surface-500 dark:text-surface-400"},"Duration",-1)),a("p",le,n(C(t(r).currentExecution)),1)]),t(r).currentExecution.error_message?(d(),p("div",ne,[s[11]||(s[11]=a("label",{class:"text-xs text-surface-500 dark:text-surface-400"},"Error",-1)),a("p",ce,n(t(r).currentExecution.error_message),1)])):x("",!0)]),s[12]||(s[12]=a("h3",{class:"font-semibold text-surface-900 dark:text-surface-0 mb-3"},"Execution Logs",-1)),a("div",ue,[(d(!0),p(O,null,H(t(r).executionLogs,i=>(d(),p("div",{key:i.id,class:$(["p-3 border border-surface-200 dark:border-surface-700 rounded-lg",{"border-red-300 dark:border-red-800":i.status==="failed","border-green-300 dark:border-green-800":i.status==="completed"}])},[a("div",de,[a("div",fe,[a("i",{class:$([z(i.step_type),"text-surface-500 dark:text-surface-400"])},null,2),a("span",pe,n(i.step_type||"Unknown Step"),1),l(t(g),{value:i.status,severity:R(i.status),size:"small"},null,8,["value","severity"])]),a("span",xe,n(y(i.executed_at)),1)]),i.error_message?(d(),p("div",me,n(i.error_message),1)):x("",!0)],2))),128)),t(r).executionLogs.length===0?(d(),p("div",ve," No execution logs available ")):x("",!0)])])):x("",!0)]}),_:1},8,["visible"])])}}};export{Se as default};
