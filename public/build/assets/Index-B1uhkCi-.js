import{q as Ie,r as u,c as K,o as ze,C as Le,b as d,e,g as o,i as a,j as m,w as g,F as S,k as V,aa as Me,X as Ne,m as r,l as k,n as A,t as b,B as U,h as v,Z as M,A as te,ab as Oe}from"./app-BPtEyV-V.js";import{u as We}from"./platforms-CMwZmn53.js";import{s as se}from"./index-CW3LC3I0.js";import{s as le}from"./index-Dq7VDPJu.js";import{s as ae}from"./index-B6L4_FjG.js";import{s as P}from"./index-BIro60HF.js";import{s as X}from"./index-GTHSWzq9.js";import{s as qe}from"./index-BUWqqSU4.js";import{s as Ge}from"./index-DNu7Aii_.js";import{s as Be}from"./index-hZk-oVL7.js";import{s as Ye}from"./index-ZPpgu9iM.js";import"./index-BIYalJJ9.js";const He={class:"space-y-6"},Qe={class:"flex items-center justify-between"},Ke={class:"flex items-start gap-4"},Xe={class:"flex flex-wrap gap-2"},Ze=["href"],Je={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},et={class:"flex items-center gap-4"},tt={class:"flex-1"},st={key:1,class:"text-center py-12"},lt={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},at={class:"flex items-start gap-4"},ot={class:"flex-1 min-w-0"},rt={class:"flex items-center gap-2 mb-1"},it={class:"font-semibold text-surface-900 dark:text-surface-100 truncate"},nt={class:"text-sm text-surface-500"},dt={class:"text-xs text-surface-400 mt-1"},ut={key:0,class:"mt-4 p-3 bg-surface-50 dark:bg-surface-700 rounded-lg"},ct={class:"flex items-center justify-between mb-1"},pt={class:"text-xs text-surface-500 break-all font-mono"},ft={key:1,class:"mt-4 p-3 bg-surface-50 dark:bg-surface-700 rounded-lg"},mt={class:"flex items-center justify-between mb-1"},bt={class:"text-xs text-surface-500 break-all font-mono"},vt={class:"flex items-center justify-between gap-2 mt-4 pt-4 border-t border-surface-100 dark:border-surface-700"},xt={class:"flex items-center gap-3"},gt={class:"flex items-center gap-2"},kt={class:"flex items-center gap-1"},yt={class:"space-y-4"},ht={key:0},wt={class:"grid grid-cols-2 gap-2"},Ct=["onClick"],_t={class:"flex-1 min-w-0"},Ft={class:"font-medium text-surface-900 dark:text-surface-100"},At={key:0,class:"text-xs text-blue-600 dark:text-blue-400"},Ut={key:1},$t={class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"},St={key:0,class:"text-red-500"},Vt={key:3,class:"flex items-center gap-3"},Pt=["onUpdate:modelValue"],jt={key:5,class:"text-xs text-surface-400 mt-1"},Et={class:"flex items-start gap-4"},Dt={class:"text-surface-700 dark:text-surface-300"},Tt={class:"space-y-4"},Rt={key:0,class:"flex flex-col items-center justify-center py-8"},It={key:1,class:"text-center py-8"},zt={key:2},Lt={class:"space-y-2 max-h-80 overflow-y-auto"},Mt=["onClick"],Nt=["src","alt"],Ot={key:1,class:"w-12 h-12 rounded-lg bg-blue-600 flex items-center justify-center"},Wt={class:"flex-1 min-w-0"},qt={class:"font-semibold text-surface-900 dark:text-surface-100 truncate"},Gt={class:"text-sm text-surface-500"},Bt={key:0,class:"text-xs text-surface-400"},Yt={key:2,class:"shrink-0"},Ht={key:0,class:"mt-4 pt-4 border-t border-surface-200 dark:border-surface-700"},Qt={class:"space-y-4"},Kt={class:"space-y-4"},Xt={class:"space-y-3"},Zt={class:"flex gap-3"},Jt={class:"flex items-center gap-2 p-2 bg-surface-100 dark:bg-surface-700 rounded font-mono text-sm break-all"},es={class:"flex-1"},ts={class:"flex gap-3"},ss={class:"flex items-center gap-2 p-2 bg-surface-100 dark:bg-surface-700 rounded font-mono text-sm break-all"},ls={class:"flex-1"},as={class:"space-y-4"},os={class:"flex items-start gap-4"},rs={class:"w-12 h-12 rounded-lg bg-blue-600 flex items-center justify-center shrink-0"},is={key:1,class:"pi pi-facebook text-white text-2xl"},ns={class:"flex-1"},ds={class:"flex items-center gap-2 mb-1"},us={class:"text-sm text-surface-500"},cs={key:0,class:"pi pi-chevron-right text-surface-400"},ps={key:0,class:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg"},fs={class:"flex items-center gap-2 p-2 bg-white dark:bg-surface-800 rounded border border-yellow-300 dark:border-yellow-700"},ms={class:"flex-1 text-xs text-surface-700 dark:text-surface-300 font-mono break-all"},bs={class:"pt-4 border-t border-surface-200 dark:border-surface-700"},vs={class:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg"},xs={class:"flex items-center gap-3"},gs={class:"space-y-6"},ks={class:"space-y-4"},ys={class:"space-y-3"},hs={class:"flex gap-3"},ws={class:"block mt-2 p-2 bg-surface-100 dark:bg-surface-700 rounded text-xs"},Cs={class:"flex gap-3"},_s={class:"flex items-center gap-2 mt-2"},Fs={class:"flex-1 p-2 bg-surface-100 dark:bg-surface-700 rounded text-xs break-all"},Ls={__name:"Index",setup(As){var ve,xe;const j=Le(),y=We(),c=Ie(),Z=u(!1),w=u(!1),C=u(!1),E=u(!1),_=u(null),x=u(null),D=u(null),J=u(null),N=u(null),O=u(!1),ee=u(!1),T=u([]),h=u(null),R=u(""),W=u(!1),I=u({webhook_url:"",verify_token:""}),F=u(!1),q=u(!1),G=u(""),oe=u(null),B=u(!1),ke=[{slug:"facebook",name:"Facebook Messenger",icon:"pi pi-facebook",url:"https://developers.facebook.com/docs/messenger-platform/getting-started/quick-start"},{slug:"whatsapp",name:"WhatsApp Business",icon:"pi pi-whatsapp",url:"https://developers.facebook.com/docs/whatsapp/cloud-api/get-started"},{slug:"telegram",name:"Telegram Bot",icon:"pi pi-telegram",url:"https://core.telegram.org/bots/tutorial"},{slug:"line",name:"LINE Messaging",icon:"pi pi-comments",url:"https://developers.line.biz/en/docs/messaging-api/getting-started/"},{slug:"webchat",name:"Web Chat Widget",icon:"pi pi-globe",url:"#"}],p=u({messaging_platform_id:null,platform_account_name:"",credentials:{}}),re=K(()=>y.platforms),ie=K(()=>y.connections),ne=K(()=>{var l,t;return x.value?((l=x.value.messaging_platform)==null?void 0:l.config_fields)||{}:((t=_.value)==null?void 0:t.config_fields)||{}}),ye=K(()=>{if(!p.value.platform_account_name)return!1;const l=ne.value;for(const[t,i]of Object.entries(l))if(i.required&&!p.value.credentials[t]&&!x.value)return!1;return _.value||x.value}),de=l=>({facebook:"pi pi-facebook",whatsapp:"pi pi-whatsapp",telegram:"pi pi-telegram",line:"pi pi-comments",webchat:"pi pi-globe"})[l]||"pi pi-comments",ue=l=>({facebook:"bg-blue-600",whatsapp:"bg-green-600",telegram:"bg-sky-500",line:"bg-emerald-500",webchat:"bg-indigo-500"})[l]||"bg-surface-500",he=l=>l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Unknown",ce=()=>{p.value={messaging_platform_id:null,platform_account_name:"",credentials:{}},_.value=null,x.value=null},we=async()=>{var l,t;w.value=!0;try{x.value?(await y.updateConnection(x.value.id,p.value),c.add({severity:"success",summary:"Success",detail:"Connection updated successfully",life:3e3})):(await y.createConnection(p.value),c.add({severity:"success",summary:"Success",detail:"Connection created successfully",life:3e3})),C.value=!1,ce()}catch(i){c.add({severity:"error",summary:"Error",detail:((t=(l=i.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to save connection",life:5e3})}finally{w.value=!1}},Ce=l=>{x.value=l,p.value={platform_account_name:l.platform_account_name,credentials:{...l.credentials||{}}},C.value=!0},_e=l=>{D.value=l,E.value=!0},Fe=async()=>{var l,t;if(D.value){w.value=!0;try{await y.deleteConnection(D.value.id),c.add({severity:"success",summary:"Success",detail:"Connection deleted successfully",life:3e3}),E.value=!1,D.value=null}catch(i){c.add({severity:"error",summary:"Error",detail:((t=(l=i.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to delete connection",life:5e3})}finally{w.value=!1}}},Ae=async l=>{var t,i;N.value=l.id;try{const s=await y.toggleConnectionStatus(l.id);l.is_active=!l.is_active,c.add({severity:"success",summary:"Success",detail:s.message||`Connection ${l.is_active?"enabled":"disabled"}`,life:3e3})}catch(s){c.add({severity:"error",summary:"Error",detail:((i=(t=s.response)==null?void 0:t.data)==null?void 0:i.message)||"Failed to toggle status",life:5e3})}finally{N.value=null}},Ue=async l=>{var t,i,s;J.value=l.id;try{const n=await y.testConnection(l.id);n.success?c.add({severity:"success",summary:"Connection Test Passed",detail:`${n.platform||((t=l.messaging_platform)==null?void 0:t.display_name)}: ${n.message}`,life:3e3}):c.add({severity:"warn",summary:"Connection Test",detail:n.message||"Test completed with warnings",life:5e3})}catch(n){c.add({severity:"error",summary:"Test Failed",detail:((s=(i=n.response)==null?void 0:i.data)==null?void 0:s.message)||"Connection test failed. Check your credentials.",life:5e3})}finally{J.value=null}},$e=async l=>{var i;const t=(i=l.webhook_config)==null?void 0:i.url;if(!t){c.add({severity:"warn",summary:"Warning",detail:"No webhook URL available",life:3e3});return}try{await navigator.clipboard.writeText(t),c.add({severity:"success",summary:"Copied",detail:"Webhook URL copied to clipboard",life:2e3})}catch{c.add({severity:"error",summary:"Error",detail:"Failed to copy URL",life:3e3})}},pe=l=>`${window.location.origin}/api/webchat/widget/${l.id}.js`,Se=async l=>{const i=`<script src="${pe(l)}" async><\/script>`;try{await navigator.clipboard.writeText(i),c.add({severity:"success",summary:"Copied",detail:"Embed code copied to clipboard",life:2e3})}catch{c.add({severity:"error",summary:"Error",detail:"Failed to copy embed code",life:3e3})}},fe=async()=>{var l,t;F.value=!0;try{const i=await y.getFacebookAuthUrl();G.value=i.url;const s=600,n=700,f=(screen.width-s)/2,$=(screen.height-n)/2;oe.value=window.open(i.url,"facebook_oauth",`width=${s},height=${n},left=${f},top=${$},scrollbars=yes`);const Q=setInterval(()=>{var z;(z=oe.value)!=null&&z.closed&&(clearInterval(Q),F.value=!1,y.fetchConnections())},500);c.add({severity:"info",summary:"Facebook Authorization",detail:"Complete the authorization in the popup window. If blocked, copy the URL below.",life:1e4})}catch(i){c.add({severity:"error",summary:"Error",detail:((t=(l=i.response)==null?void 0:l.data)==null?void 0:t.error)||"Failed to start Facebook authorization",life:5e3}),F.value=!1}},Ve=async()=>{var l,t;ee.value=!0,T.value=[],h.value=null,R.value="";try{const i=await y.getFacebookPages(H.value);T.value=i}catch(i){c.add({severity:"error",summary:"Error",detail:((t=(l=i.response)==null?void 0:l.data)==null?void 0:t.error)||"Failed to load Facebook pages",life:5e3})}finally{ee.value=!1}},me=()=>{O.value=!1,T.value=[],h.value=null,R.value=""},Pe=async()=>{var l,t;if(h.value){w.value=!0;try{const i=await y.connectFacebookPage({page_id:h.value.id,page_name:h.value.name,page_access_token:h.value.access_token,account_name:R.value||h.value.name},H.value);c.add({severity:"success",summary:"Success",detail:i.message,life:3e3}),I.value={webhook_url:i.webhook_url,verify_token:i.verify_token},H.value=null,me(),W.value=!0}catch(i){c.add({severity:"error",summary:"Error",detail:((t=(l=i.response)==null?void 0:l.data)==null?void 0:t.error)||"Failed to connect Facebook page",life:5e3})}finally{w.value=!1}}},Y=async(l,t)=>{try{await navigator.clipboard.writeText(l),c.add({severity:"success",summary:"Copied",detail:`${t} copied to clipboard`,life:2e3})}catch{c.add({severity:"error",summary:"Error",detail:"Failed to copy to clipboard",life:3e3})}},je=l=>l>=1e6?(l/1e6).toFixed(1)+"M":l>=1e3?(l/1e3).toFixed(1)+"K":l.toString(),Ee=l=>{if(l.slug==="facebook"){C.value=!1,q.value=!0;return}_.value=l,p.value.messaging_platform_id=l.id,p.value.credentials={}},De=()=>{q.value=!1;const l=re.value.find(t=>t.slug==="facebook");l&&(_.value=l,p.value.messaging_platform_id=l.id,p.value.credentials={},C.value=!0)},Te=async()=>{await fe()},H=u(null),Re=u(((ve=window==null?void 0:window.location)==null?void 0:ve.host)||""),be=u(((xe=window==null?void 0:window.location)==null?void 0:xe.origin)||"");return ze(async()=>{Z.value=!0;try{await Promise.all([y.fetchPlatforms(),y.fetchConnections()]),j.query.facebook_auth==="success"&&j.query.fb_token&&(H.value=j.query.fb_token,window.history.replaceState({},document.title,window.location.pathname),O.value=!0,await Ve()),j.query.error&&(c.add({severity:"error",summary:"Facebook Connection Failed",detail:j.query.error,life:5e3}),window.history.replaceState({},document.title,window.location.pathname))}catch{c.add({severity:"error",summary:"Error",detail:"Failed to load platform data",life:5e3})}finally{Z.value=!1}}),(l,t)=>{const i=Ne("tooltip");return r(),d("div",He,[e("div",Qe,[t[20]||(t[20]=e("div",null,[e("h1",{class:"text-2xl font-bold text-surface-900 dark:text-surface-100"},"Platform Connections"),e("p",{class:"text-surface-500 mt-1"},"Connect your messaging platforms to start receiving customer messages")],-1)),o(a(m),{label:"Add Connection",icon:"pi pi-plus",onClick:t[0]||(t[0]=s=>C.value=!0)})]),o(a(se),{class:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"},{content:g(()=>[e("div",Ke,[t[24]||(t[24]=e("div",{class:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center shrink-0"},[e("i",{class:"pi pi-info-circle text-blue-600 dark:text-blue-400 text-lg"})],-1)),e("div",null,[t[22]||(t[22]=e("h3",{class:"font-semibold text-blue-900 dark:text-blue-100 mb-2"},"Need help getting API credentials?",-1)),t[23]||(t[23]=e("p",{class:"text-sm text-blue-700 dark:text-blue-300 mb-3"}," Click on each platform below to learn how to obtain the required tokens and API keys. ",-1)),e("div",Xe,[(r(),d(S,null,V(ke,s=>e("a",{key:s.slug,href:s.url,target:"_blank",class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium bg-white dark:bg-surface-800 text-surface-700 dark:text-surface-100 hover:bg-surface-100 dark:hover:bg-surface-700 transition border border-surface-200 dark:border-surface-600"},[e("i",{class:A([s.icon,"text-sm"])},null,2),k(" "+b(s.name)+" ",1),t[21]||(t[21]=e("i",{class:"pi pi-external-link text-xs"},null,-1))],8,Ze)),64))])])])]),_:1}),Z.value?(r(),d("div",Je,[(r(),d(S,null,V(4,s=>o(a(se),{key:s},{content:g(()=>[e("div",et,[o(a(ae),{shape:"circle",size:"3rem"}),e("div",tt,[o(a(ae),{width:"60%",height:"1.2rem",class:"mb-2"}),o(a(ae),{width:"40%",height:"0.9rem"})])])]),_:1})),64))])):ie.value.length===0?(r(),d("div",st,[t[25]||(t[25]=e("div",{class:"w-20 h-20 mx-auto mb-4 rounded-full bg-surface-100 dark:bg-surface-700 flex items-center justify-center"},[e("i",{class:"pi pi-share-alt text-4xl text-surface-400"})],-1)),t[26]||(t[26]=e("h3",{class:"text-lg font-semibold text-surface-900 dark:text-surface-100 mb-2"},"No connections yet",-1)),t[27]||(t[27]=e("p",{class:"text-surface-500 mb-4"},"Connect your first messaging platform to start receiving messages",-1)),o(a(m),{label:"Connect Platform",icon:"pi pi-plus",onClick:t[1]||(t[1]=s=>C.value=!0)})])):(r(),d("div",lt,[(r(!0),d(S,null,V(ie.value,s=>(r(),U(a(se),{key:s.id,class:"relative"},{content:g(()=>{var n,f,$,Q,z,ge;return[e("div",at,[e("div",{class:A(["w-12 h-12 rounded-lg flex items-center justify-center",ue((n=s.messaging_platform)==null?void 0:n.slug)])},[e("i",{class:A([de((f=s.messaging_platform)==null?void 0:f.slug),"text-2xl text-white"])},null,2)],2),e("div",ot,[e("div",rt,[e("h3",it,b(s.platform_account_name),1),o(a(le),{value:s.is_active?"Active":"Inactive",severity:s.is_active?"success":"secondary",class:"text-xs"},null,8,["value","severity"])]),e("p",nt,b(($=s.messaging_platform)==null?void 0:$.display_name),1),e("p",dt," Connected "+b(he(s.connected_at)),1)])]),((Q=s.messaging_platform)==null?void 0:Q.slug)!=="webchat"?(r(),d("div",ut,[e("div",ct,[t[28]||(t[28]=e("span",{class:"text-xs font-medium text-surface-600 dark:text-surface-400"},"Webhook URL",-1)),M(o(a(m),{icon:"pi pi-copy",text:"",rounded:"",size:"small",onClick:L=>$e(s)},null,8,["onClick"]),[[i,"Copy URL",void 0,{top:!0}]])]),e("p",pt,b(((z=s.webhook_config)==null?void 0:z.url)||"N/A"),1)])):v("",!0),((ge=s.messaging_platform)==null?void 0:ge.slug)==="webchat"?(r(),d("div",ft,[e("div",mt,[t[29]||(t[29]=e("span",{class:"text-xs font-medium text-surface-600 dark:text-surface-400"},"Embed Code",-1)),M(o(a(m),{icon:"pi pi-copy",text:"",rounded:"",size:"small",onClick:L=>Se(s)},null,8,["onClick"]),[[i,"Copy Embed Code",void 0,{top:!0}]])]),e("p",bt,' <script src="'+b(pe(s))+'" async><\/script> ',1),t[30]||(t[30]=e("p",{class:"text-xs text-surface-400 mt-2"},[e("i",{class:"pi pi-info-circle mr-1"}),k(" Add this code before the closing </body> tag on your website ")],-1))])):v("",!0),e("div",vt,[e("div",xt,[e("div",gt,[M(o(a(Ye),{modelValue:s.is_active,"onUpdate:modelValue":L=>Ae(s),disabled:N.value===s.id},null,8,["modelValue","onUpdate:modelValue","disabled"]),[[i,s.is_active?"Active - Click to disable":"Inactive - Click to enable",void 0,{top:!0}]]),N.value===s.id?(r(),U(a(te),{key:0,style:{width:"16px",height:"16px"}})):v("",!0)])]),e("div",kt,[o(a(m),{label:"Test",icon:"pi pi-bolt",severity:"secondary",outlined:"",size:"small",loading:J.value===s.id,onClick:L=>Ue(s)},null,8,["loading","onClick"]),o(a(m),{label:"Edit",icon:"pi pi-pencil",severity:"secondary",outlined:"",size:"small",onClick:L=>Ce(s)},null,8,["onClick"]),M(o(a(m),{icon:"pi pi-trash",outlined:"",rounded:"",size:"small",severity:"danger",onClick:L=>_e(s)},null,8,["onClick"]),[[i,"Delete",void 0,{top:!0}]])])])]}),_:2},1024))),128))])),o(a(P),{visible:C.value,"onUpdate:visible":t[4]||(t[4]=s=>C.value=s),header:x.value?"Edit Connection":"Add Platform Connection",modal:"",style:{width:"500px"},onHide:ce},{footer:g(()=>[o(a(m),{label:"Cancel",severity:"secondary",outlined:"",onClick:t[3]||(t[3]=s=>C.value=!1)}),o(a(m),{label:x.value?"Update":"Create Connection",loading:w.value,disabled:!ye.value,onClick:we},null,8,["label","loading","disabled"])]),default:g(()=>[e("div",yt,[x.value?v("",!0):(r(),d("div",ht,[t[32]||(t[32]=e("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Select Platform ",-1)),e("div",wt,[(r(!0),d(S,null,V(re.value,s=>{var n;return r(),d("div",{key:s.id,class:A(["flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all relative",((n=_.value)==null?void 0:n.id)===s.id?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-surface-200 dark:border-surface-600 hover:border-surface-300 dark:hover:border-surface-500"]),onClick:f=>Ee(s)},[e("div",{class:A(["w-10 h-10 rounded-lg flex items-center justify-center",ue(s.slug)])},[e("i",{class:A([de(s.slug),"text-lg text-white"])},null,2)],2),e("div",_t,[e("p",Ft,b(s.display_name),1),s.slug==="facebook"?(r(),d("p",At,[...t[31]||(t[31]=[e("i",{class:"pi pi-bolt mr-1"},null,-1),k("Quick Connect ",-1)])])):v("",!0)]),s.slug==="facebook"?(r(),U(a(le),{key:0,value:"OAuth",severity:"info",class:"absolute -top-2 -right-2 text-xs"})):v("",!0)],10,Ct)}),128))])])),_.value||x.value?(r(),d("div",Ut,[t[33]||(t[33]=e("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Account Name ",-1)),o(a(X),{modelValue:p.value.platform_account_name,"onUpdate:modelValue":t[2]||(t[2]=s=>p.value.platform_account_name=s),placeholder:"e.g., My Business Page",class:"w-full"},null,8,["modelValue"]),t[34]||(t[34]=e("p",{class:"text-xs text-surface-400 mt-1"},"A friendly name to identify this connection",-1))])):v("",!0),_.value||x.value?(r(!0),d(S,{key:2},V(ne.value,(s,n)=>(r(),d("div",{key:n},[e("label",$t,[k(b(s.label)+" ",1),s.required?(r(),d("span",St,"*")):v("",!0)]),s.type==="password"||n.includes("token")||n.includes("secret")?(r(),U(a(qe),{key:0,modelValue:p.value.credentials[n],"onUpdate:modelValue":f=>p.value.credentials[n]=f,placeholder:x.value?"••••••••":`Enter ${s.label}`,feedback:!1,toggleMask:"",class:"w-full",pt:{root:{class:"w-full"},input:{class:"w-full"}}},null,8,["modelValue","onUpdate:modelValue","placeholder"])):s.type==="select"?(r(),U(a(Ge),{key:1,modelValue:p.value.credentials[n],"onUpdate:modelValue":f=>p.value.credentials[n]=f,options:s.options.map(f=>({label:f.replace("-"," ").replace(/\b\w/g,$=>$.toUpperCase()),value:f})),optionLabel:"label",optionValue:"value",placeholder:`Select ${s.label}`,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])):s.type==="textarea"?(r(),U(a(Be),{key:2,modelValue:p.value.credentials[n],"onUpdate:modelValue":f=>p.value.credentials[n]=f,placeholder:s.default||`Enter ${s.label}`,rows:"3",class:"w-full",autoResize:""},null,8,["modelValue","onUpdate:modelValue","placeholder"])):s.type==="color"?(r(),d("div",Vt,[M(e("input",{type:"color","onUpdate:modelValue":f=>p.value.credentials[n]=f,class:"w-12 h-10 rounded border border-surface-300 dark:border-surface-600 cursor-pointer"},null,8,Pt),[[Oe,p.value.credentials[n]]]),o(a(X),{modelValue:p.value.credentials[n],"onUpdate:modelValue":f=>p.value.credentials[n]=f,placeholder:s.default||"#6366f1",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue","placeholder"])])):(r(),U(a(X),{key:4,modelValue:p.value.credentials[n],"onUpdate:modelValue":f=>p.value.credentials[n]=f,placeholder:`Enter ${s.label}`,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","placeholder"])),n==="allowed_domains"?(r(),d("p",jt," Enter one domain per line, or use * to allow all domains ")):v("",!0)]))),128)):v("",!0)])]),_:1},8,["visible","header"]),o(a(P),{visible:E.value,"onUpdate:visible":t[6]||(t[6]=s=>E.value=s),header:"Delete Connection",modal:"",style:{width:"400px"}},{footer:g(()=>[o(a(m),{label:"Cancel",severity:"secondary",outlined:"",onClick:t[5]||(t[5]=s=>E.value=!1)}),o(a(m),{label:"Delete",severity:"danger",loading:w.value,onClick:Fe},null,8,["loading"])]),default:g(()=>{var s;return[e("div",Et,[t[38]||(t[38]=e("div",{class:"w-10 h-10 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center shrink-0"},[e("i",{class:"pi pi-exclamation-triangle text-red-600"})],-1)),e("div",null,[e("p",Dt,[t[35]||(t[35]=k(" Are you sure you want to delete the connection ",-1)),e("strong",null,b((s=D.value)==null?void 0:s.platform_account_name),1),t[36]||(t[36]=k("? ",-1))]),t[37]||(t[37]=e("p",{class:"text-sm text-surface-500 mt-2"}," This action cannot be undone. You will stop receiving messages from this platform. ",-1))])])]}),_:1},8,["visible"]),o(a(P),{visible:O.value,"onUpdate:visible":t[8]||(t[8]=s=>O.value=s),header:"Select Facebook Page",modal:"",style:{width:"550px"}},{footer:g(()=>[o(a(m),{label:"Cancel",severity:"secondary",outlined:"",onClick:me}),o(a(m),{label:"Connect Page",icon:"pi pi-check",loading:w.value,disabled:!h.value,onClick:Pe},null,8,["loading","disabled"])]),default:g(()=>[e("div",Tt,[ee.value?(r(),d("div",Rt,[o(a(te),{style:{width:"50px",height:"50px"}}),t[39]||(t[39]=e("p",{class:"text-surface-500 mt-4"},"Loading your Facebook pages...",-1))])):T.value.length===0?(r(),d("div",It,[t[40]||(t[40]=e("div",{class:"w-16 h-16 mx-auto mb-4 rounded-full bg-surface-100 dark:bg-surface-700 flex items-center justify-center"},[e("i",{class:"pi pi-facebook text-3xl text-surface-400"})],-1)),t[41]||(t[41]=e("h3",{class:"text-lg font-semibold text-surface-900 dark:text-surface-100 mb-2"},"No Pages Found",-1)),t[42]||(t[42]=e("p",{class:"text-surface-500 text-sm mb-4"}," You don't have any Facebook pages, or you haven't granted access to your pages. ",-1)),o(a(m),{label:"Try Again",icon:"pi pi-refresh",onClick:fe})])):(r(),d("div",zt,[t[47]||(t[47]=e("p",{class:"text-sm text-surface-500 mb-4"}," Select the Facebook page you want to connect to RChat for Messenger integration. ",-1)),e("div",Lt,[(r(!0),d(S,null,V(T.value,s=>{var n,f;return r(),d("div",{key:s.id,class:A(["flex items-center gap-4 p-4 rounded-lg border-2 cursor-pointer transition-all",((n=h.value)==null?void 0:n.id)===s.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-surface-200 dark:border-surface-600 hover:border-surface-300 dark:hover:border-surface-500"]),onClick:$=>h.value=s},[s.picture_url?(r(),d("img",{key:0,src:s.picture_url,alt:s.name,class:"w-12 h-12 rounded-lg object-cover"},null,8,Nt)):(r(),d("div",Ot,[...t[43]||(t[43]=[e("i",{class:"pi pi-facebook text-white text-xl"},null,-1)])])),e("div",Wt,[e("h4",qt,b(s.name),1),e("p",Gt,b(s.category||"Page"),1),s.fan_count?(r(),d("p",Bt,b(je(s.fan_count))+" followers",1)):v("",!0)]),((f=h.value)==null?void 0:f.id)===s.id?(r(),d("div",Yt,[...t[44]||(t[44]=[e("i",{class:"pi pi-check-circle text-blue-500 text-xl"},null,-1)])])):v("",!0)],10,Mt)}),128))]),h.value?(r(),d("div",Ht,[t[45]||(t[45]=e("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Connection Name (optional) ",-1)),o(a(X),{modelValue:R.value,"onUpdate:modelValue":t[7]||(t[7]=s=>R.value=s),placeholder:h.value.name,class:"w-full"},null,8,["modelValue","placeholder"]),t[46]||(t[46]=e("p",{class:"text-xs text-surface-400 mt-1"},"A friendly name to identify this connection in RChat",-1))])):v("",!0)]))])]),_:1},8,["visible"]),o(a(P),{visible:W.value,"onUpdate:visible":t[12]||(t[12]=s=>W.value=s),header:"Webhook Setup Required",modal:"",style:{width:"600px"}},{footer:g(()=>[o(a(m),{label:"Done",icon:"pi pi-check",onClick:t[11]||(t[11]=s=>W.value=!1)})]),default:g(()=>[e("div",Qt,[t[56]||(t[56]=e("div",{class:"flex items-start gap-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg"},[e("i",{class:"pi pi-check-circle text-green-600 text-xl"}),e("div",null,[e("h4",{class:"font-semibold text-green-800 dark:text-green-200"},"Page Connected Successfully!"),e("p",{class:"text-sm text-green-700 dark:text-green-300"},"Your Facebook page is now connected. Complete the webhook setup to start receiving messages.")])],-1)),e("div",Kt,[t[55]||(t[55]=e("h4",{class:"font-semibold text-surface-900 dark:text-surface-100"},"Complete Webhook Setup in Facebook Developer Console:",-1)),e("div",Xt,[t[52]||(t[52]=e("div",{class:"flex gap-3"},[e("span",{class:"w-6 h-6 rounded-full bg-primary-500 text-white text-sm flex items-center justify-center shrink-0"},"1"),e("div",null,[e("p",{class:"text-surface-700 dark:text-surface-300"},[k("Go to "),e("a",{href:"https://developers.facebook.com/apps",target:"_blank",class:"text-primary-500 hover:underline"},"Facebook Developer Console")])])],-1)),t[53]||(t[53]=e("div",{class:"flex gap-3"},[e("span",{class:"w-6 h-6 rounded-full bg-primary-500 text-white text-sm flex items-center justify-center shrink-0"},"2"),e("div",null,[e("p",{class:"text-surface-700 dark:text-surface-300"},"Select your app → Messenger → Settings → Webhooks")])],-1)),e("div",Zt,[t[49]||(t[49]=e("span",{class:"w-6 h-6 rounded-full bg-primary-500 text-white text-sm flex items-center justify-center shrink-0"},"3",-1)),e("div",null,[t[48]||(t[48]=e("p",{class:"text-surface-700 dark:text-surface-300 mb-2"},"Add the following Callback URL:",-1)),e("div",Jt,[e("span",es,b(I.value.webhook_url),1),o(a(m),{icon:"pi pi-copy",text:"",rounded:"",size:"small",onClick:t[9]||(t[9]=s=>Y(I.value.webhook_url,"Webhook URL"))})])])]),e("div",ts,[t[51]||(t[51]=e("span",{class:"w-6 h-6 rounded-full bg-primary-500 text-white text-sm flex items-center justify-center shrink-0"},"4",-1)),e("div",null,[t[50]||(t[50]=e("p",{class:"text-surface-700 dark:text-surface-300 mb-2"},"Use this Verify Token:",-1)),e("div",ss,[e("span",ls,b(I.value.verify_token),1),o(a(m),{icon:"pi pi-copy",text:"",rounded:"",size:"small",onClick:t[10]||(t[10]=s=>Y(I.value.verify_token,"Verify Token"))})])])]),t[54]||(t[54]=e("div",{class:"flex gap-3"},[e("span",{class:"w-6 h-6 rounded-full bg-primary-500 text-white text-sm flex items-center justify-center shrink-0"},"5"),e("div",null,[e("p",{class:"text-surface-700 dark:text-surface-300"},[k("Subscribe to these webhook events: "),e("code",{class:"bg-surface-100 dark:bg-surface-700 px-1 rounded"},"messages"),k(", "),e("code",{class:"bg-surface-100 dark:bg-surface-700 px-1 rounded"},"messaging_postbacks")])])],-1))])])])]),_:1},8,["visible"]),o(a(P),{visible:q.value,"onUpdate:visible":t[16]||(t[16]=s=>q.value=s),header:"Connect Facebook Messenger",modal:"",style:{width:"550px"}},{default:g(()=>[e("div",as,[t[62]||(t[62]=e("p",{class:"text-surface-600 dark:text-surface-400"}," Choose how you want to connect your Facebook page: ",-1)),e("div",{class:A(["p-4 border-2 rounded-lg transition-all",F.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-surface-200 dark:border-surface-600 hover:border-blue-500 dark:hover:border-blue-500 cursor-pointer"]),onClick:t[13]||(t[13]=s=>!F.value&&Te())},[e("div",os,[e("div",rs,[F.value?(r(),U(a(te),{key:0,style:{width:"24px",height:"24px"},strokeWidth:"3"})):(r(),d("i",is))]),e("div",ns,[e("div",ds,[t[57]||(t[57]=e("h4",{class:"font-semibold text-surface-900 dark:text-surface-100"},"Quick Connect (OAuth)",-1)),o(a(le),{value:"Recommended",severity:"success",class:"text-xs"})]),e("p",us,b(F.value?"Opening Facebook authorization window...":"Login with Facebook and select your page. Easiest method but requires Facebook App configuration."),1)]),F.value?v("",!0):(r(),d("i",cs))])],2),e("div",{class:"p-4 border-2 border-surface-200 dark:border-surface-600 rounded-lg hover:border-primary-500 dark:hover:border-primary-500 cursor-pointer transition-all",onClick:De},[...t[58]||(t[58]=[e("div",{class:"flex items-start gap-4"},[e("div",{class:"w-12 h-12 rounded-lg bg-surface-500 flex items-center justify-center shrink-0"},[e("i",{class:"pi pi-key text-white text-2xl"})]),e("div",{class:"flex-1"},[e("h4",{class:"font-semibold text-surface-900 dark:text-surface-100 mb-1"},"Manual Setup"),e("p",{class:"text-sm text-surface-500"}," Enter your Page Access Token and Page ID manually. Works without OAuth app setup. ")]),e("i",{class:"pi pi-chevron-right text-surface-400"})],-1)])]),G.value?(r(),d("div",ps,[t[59]||(t[59]=e("div",{class:"flex items-start gap-3 mb-3"},[e("i",{class:"pi pi-exclamation-circle text-yellow-600 text-lg"}),e("div",null,[e("h4",{class:"font-semibold text-yellow-800 dark:text-yellow-200 mb-1"},"Popup blocked?"),e("p",{class:"text-sm text-yellow-700 dark:text-yellow-300"},"Copy and open this URL manually in a new browser tab:")])],-1)),e("div",fs,[e("p",ms,b(G.value),1),o(a(m),{icon:"pi pi-copy",label:"Copy",size:"small",severity:"warning",onClick:t[14]||(t[14]=s=>Y(G.value,"OAuth URL"))})])])):v("",!0),e("div",bs,[e("div",vs,[e("div",xs,[t[60]||(t[60]=e("i",{class:"pi pi-info-circle text-blue-500 text-lg"},null,-1)),t[61]||(t[61]=e("div",{class:"flex-1"},[e("p",{class:"text-sm text-blue-700 dark:text-blue-300"}," First time connecting? You may need to set up a Facebook App. ")],-1)),o(a(m),{label:"Setup Guide",icon:"pi pi-book",size:"small",severity:"info",onClick:t[15]||(t[15]=s=>B.value=!0)})])])])])]),_:1},8,["visible"]),o(a(P),{visible:B.value,"onUpdate:visible":t[19]||(t[19]=s=>B.value=s),header:"Facebook App Setup Guide",modal:"",style:{width:"700px"},maximizable:!0},{footer:g(()=>[o(a(m),{label:"Got it",icon:"pi pi-check",onClick:t[18]||(t[18]=s=>B.value=!1)})]),default:g(()=>[e("div",gs,[t[75]||(t[75]=e("div",{class:"p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg"},[e("div",{class:"flex items-start gap-3"},[e("i",{class:"pi pi-exclamation-triangle text-yellow-600 text-lg"}),e("div",null,[e("h4",{class:"font-semibold text-yellow-800 dark:text-yellow-200"},"Important Notes"),e("ul",{class:"text-sm text-yellow-700 dark:text-yellow-300 mt-2 list-disc list-inside space-y-1"},[e("li",null,"Facebook requires your app domain to match the redirect URL"),e("li",null,"You may need to complete Facebook App Review for production use"),e("li",null,"For testing, you can add yourself as a tester without review")])])])],-1)),e("div",ks,[t[74]||(t[74]=e("h4",{class:"font-semibold text-surface-900 dark:text-surface-100"},"Step-by-Step Setup:",-1)),e("div",ys,[t[69]||(t[69]=e("div",{class:"flex gap-3"},[e("span",{class:"w-6 h-6 rounded-full bg-primary-500 text-white text-sm flex items-center justify-center shrink-0"},"1"),e("div",null,[e("p",{class:"font-medium text-surface-700 dark:text-surface-300"},"Create a Facebook App"),e("p",{class:"text-sm text-surface-500 mt-1"},[k(" Go to "),e("a",{href:"https://developers.facebook.com/apps",target:"_blank",class:"text-primary-500 hover:underline"},"developers.facebook.com/apps"),k(' and create a new app of type "Business". ')])])],-1)),t[70]||(t[70]=e("div",{class:"flex gap-3"},[e("span",{class:"w-6 h-6 rounded-full bg-primary-500 text-white text-sm flex items-center justify-center shrink-0"},"2"),e("div",null,[e("p",{class:"font-medium text-surface-700 dark:text-surface-300"},"Add Messenger Product"),e("p",{class:"text-sm text-surface-500 mt-1"},' In your app dashboard, click "Add Product" and add "Messenger". ')])],-1)),e("div",hs,[t[65]||(t[65]=e("span",{class:"w-6 h-6 rounded-full bg-primary-500 text-white text-sm flex items-center justify-center shrink-0"},"3",-1)),e("div",null,[t[63]||(t[63]=e("p",{class:"font-medium text-surface-700 dark:text-surface-300"},"Configure App Domain",-1)),t[64]||(t[64]=e("p",{class:"text-sm text-surface-500 mt-1"},' Go to Settings → Basic and add your domain to "App Domains": ',-1)),e("code",ws,b(Re.value),1)])]),e("div",Cs,[t[68]||(t[68]=e("span",{class:"w-6 h-6 rounded-full bg-primary-500 text-white text-sm flex items-center justify-center shrink-0"},"4",-1)),e("div",null,[t[66]||(t[66]=e("p",{class:"font-medium text-surface-700 dark:text-surface-300"},"Set Valid OAuth Redirect URIs",-1)),t[67]||(t[67]=e("p",{class:"text-sm text-surface-500 mt-1"}," Go to Facebook Login → Settings and add this redirect URI: ",-1)),e("div",_s,[e("code",Fs,b(be.value)+"/api/auth/facebook/callback",1),o(a(m),{icon:"pi pi-copy",text:"",rounded:"",size:"small",onClick:t[17]||(t[17]=s=>Y(`${be.value}/api/auth/facebook/callback`,"Redirect URI"))})])])]),t[71]||(t[71]=e("div",{class:"flex gap-3"},[e("span",{class:"w-6 h-6 rounded-full bg-primary-500 text-white text-sm flex items-center justify-center shrink-0"},"5"),e("div",null,[e("p",{class:"font-medium text-surface-700 dark:text-surface-300"},"Get App ID and Secret"),e("p",{class:"text-sm text-surface-500 mt-1"}," Copy your App ID and App Secret from Settings → Basic. ")])],-1)),t[72]||(t[72]=e("div",{class:"flex gap-3"},[e("span",{class:"w-6 h-6 rounded-full bg-primary-500 text-white text-sm flex items-center justify-center shrink-0"},"6"),e("div",null,[e("p",{class:"font-medium text-surface-700 dark:text-surface-300"},"Configure OAuth App Credentials (Server-side)"),e("p",{class:"text-sm text-surface-500 mt-1"}," Add your App ID and Secret in the platform settings form. The OAuth connection will use these credentials to verify your app and request permissions. "),e("div",{class:"mt-2 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded"},[e("p",{class:"text-xs text-amber-700 dark:text-amber-300"},[e("i",{class:"pi pi-info-circle mr-1"}),e("strong",null,"Note:"),k(" For the OAuth connection to work, your Facebook App credentials need to be configured. Contact your administrator or use Manual Setup with a Page Access Token instead. ")])])])],-1)),t[73]||(t[73]=e("div",{class:"flex gap-3"},[e("span",{class:"w-6 h-6 rounded-full bg-primary-500 text-white text-sm flex items-center justify-center shrink-0"},"7"),e("div",null,[e("p",{class:"font-medium text-surface-700 dark:text-surface-300"},"Add Test Users (Optional, for development)"),e("p",{class:"text-sm text-surface-500 mt-1"}," Go to Roles → Test Users and add yourself to test without app review. ")])],-1))])]),t[76]||(t[76]=e("div",{class:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg"},[e("h4",{class:"font-semibold text-blue-800 dark:text-blue-200 mb-2"},"Alternative: Use Manual Setup"),e("p",{class:"text-sm text-blue-700 dark:text-blue-300"},[k(" If you don't want to set up OAuth, you can use the Manual Setup option to enter your Page Access Token directly. Get a Page Access Token from the "),e("a",{href:"https://developers.facebook.com/tools/explorer",target:"_blank",class:"underline"},"Graph API Explorer"),k(". ")])],-1))])]),_:1},8,["visible"]),o(a(Me))])}}};export{Ls as default};
