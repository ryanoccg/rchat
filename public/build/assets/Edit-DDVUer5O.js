import{q as Fe,a9 as qe,r as g,c as oe,C as Oe,o as je,a as He,b as i,e as t,g as d,F as D,k as P,Z as j,i as r,j as T,t as V,y as $,h as b,A as Ge,p as ve,l as S,B as ge,w as be,z as Je,v as Ke,X as Ze,m as n,n as I}from"./app-DJ0pZO5B.js";import{u as Qe,s as U}from"./index-7Ut2Tz5f.js";import{s as et}from"./index-CSCkJUVi.js";import{s as B}from"./index-abbMYiPI.js";import{s as H}from"./index-BjAOZkMO.js";import{s as le}from"./index-BbUuZ738.js";import{s as xe}from"./index-trmJ3gaO.js";import{s as tt}from"./index-DNL7fXE4.js";import{_ as ot}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-D6zsbsG1.js";import"./index-Dr7DX1aH.js";import"./index-B7uqYIHH.js";const lt={class:"flex h-[calc(100vh-8rem)] gap-4"},at={class:"w-72 flex flex-col overflow-hidden bg-white dark:bg-surface-800 border border-surface-200 dark:border-surface-700 rounded-lg"},st={class:"flex-1 overflow-y-auto p-3 space-y-4"},nt={class:"space-y-2"},rt=["onDragstart"],it={class:"flex items-center gap-2"},ut={class:"text-sm font-medium text-surface-900 dark:text-surface-0"},dt={class:"space-y-2"},ct=["onDragstart"],ft={class:"flex items-center gap-2"},pt={class:"text-sm font-medium text-surface-900 dark:text-surface-0"},mt={class:"space-y-2"},vt=["onDragstart"],gt={class:"flex items-center gap-2"},bt={class:"text-sm font-medium text-surface-900 dark:text-surface-0"},xt={class:"flex-1 flex flex-col overflow-hidden bg-white dark:bg-surface-800 border border-surface-200 dark:border-surface-700 rounded-lg workflow-canvas"},yt={class:"flex items-center justify-between p-3 border-b border-surface-200 dark:border-surface-700"},kt={class:"flex items-center gap-4"},_t={class:"font-semibold text-surface-900 dark:text-surface-0"},wt={class:"text-xs text-surface-500 dark:text-surface-400"},ht={class:"flex items-center gap-2"},Ct={class:"flex items-center gap-1 px-3 py-1 border-b border-surface-200 dark:border-surface-700"},Vt={class:"text-xs text-surface-600 dark:text-surface-400 min-w-[40px] text-center"},Tt={key:0,class:"absolute inset-0 flex items-center justify-center bg-surface-50/80 dark:bg-surface-900/80 z-10"},St={class:"text-center"},$t={class:"absolute inset-0 w-full h-full pointer-events-none",style:{"z-index":"0"}},Dt=["d","onClick"],Mt=["d"],Lt=["x","y"],Yt=["transform","onClick"],It=["d"],Ut=["onMousedown","onClick"],Et={class:"flex items-center gap-2"},Wt={class:"flex-1 min-w-0"},Xt={class:"text-sm font-medium text-surface-900 dark:text-surface-0 truncate"},Rt={class:"text-xs text-surface-500 dark:text-surface-400 truncate"},zt=["onMousedown"],At=["onMousedown"],Pt=["onMousedown"],Bt={key:0,class:"w-80 flex flex-col overflow-hidden bg-white dark:bg-surface-800 border border-surface-200 dark:border-surface-700 rounded-lg"},Nt={class:"p-3 border-b border-surface-200 dark:border-surface-700 flex items-center justify-between"},Ft={class:"flex-1 overflow-y-auto p-4 space-y-4"},qt={key:0},Ot={key:1},jt={key:2,class:"space-y-4"},Ht={key:0},Gt={key:1,class:"p-3 bg-surface-50 dark:bg-surface-700 rounded-lg"},Jt={class:"text-xs text-surface-600 dark:text-surface-400"},Kt={key:3,class:"space-y-4"},Zt={key:0},Qt={key:1},eo={key:2},to={class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"},oo={key:3},lo={class:"flex gap-2 items-center"},ao={key:4},so={key:4},no={key:5},ro={key:6},io={key:7,class:"space-y-4"},uo={key:0,class:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},co={class:"text-xs text-red-700 dark:text-red-400"},fo={key:1,class:"w-80 flex flex-col overflow-hidden bg-white dark:bg-surface-800 border border-surface-200 dark:border-surface-700 rounded-lg"},po={class:"space-y-4"},mo={__name:"Edit",setup(vo){const ye=Ke(),ke=Oe(),E=Fe(),ae=qe(),w=Qe(),x=g(null),G=g(!0),N=g(null),_=g([]),a=g(null),F=g(null),W=g(!1),X=g({customer_id:null,conversation_id:null}),J=g([]),se=g({width:2e3,height:1500}),p=g(1),K=g(!1),M=g(!1),q=g(null),v=g(null),L=g(null),Z=g({x:0,y:0}),Y=g(null),R=oe(()=>ke.params.id),_e=oe(()=>{const o=w.triggerTypes.find(e=>{var s;return e.value===((s=N.value)==null?void 0:s.trigger_type)});return(o==null?void 0:o.label)||""}),we=[{value:"equals",label:"Equals"},{value:"not_equals",label:"Not Equals"},{value:"contains",label:"Contains"},{value:"not_contains",label:"Does Not Contain"},{value:"starts_with",label:"Starts With"},{value:"ends_with",label:"Ends With"},{value:"greater_than",label:"Greater Than"},{value:"greater_equal",label:"Greater Than or Equal"},{value:"less_than",label:"Less Than"},{value:"less_equal",label:"Less Than or Equal"},{value:"is_empty",label:"Is Empty"},{value:"is_not_empty",label:"Is Not Empty"},{value:"matches_regex",label:"Matches Regex"}];function he(o){return{customer_attribute:[{value:"customer_type",label:"Customer Type (new/returning/vip)"},{value:"total_message_count",label:"Total Message Count"},{value:"conversation_count",label:"Conversation Count"},{value:"name",label:"Name"},{value:"email",label:"Email"},{value:"phone",label:"Phone"},{value:"language",label:"Language"},{value:"tags",label:"Tags"},{value:"platform",label:"Platform"}],conversation_attribute:[{value:"status",label:"Status"},{value:"priority",label:"Priority"},{value:"platform",label:"Platform"},{value:"message_count",label:"Message Count"},{value:"is_ai_handling",label:"AI Handling"},{value:"assigned_to",label:"Assigned Agent"}],message_content:[{value:"text",label:"Text Content"},{value:"type",label:"Message Type"}],time_of_day:[{value:"hour",label:"Hour"}],day_of_week:[{value:"day",label:"Day"}]}[o]||[]}function Ce(o){return{customer_attribute:"e.g., name, email, tags, language",conversation_attribute:"e.g., status, priority, platform, message_count",message_content:"e.g., text",time_of_day:"e.g., hour",day_of_week:"e.g., day"}[o]||"Field name"}async function Ve(){try{const o=await Je.get("/api/ai-agents");J.value=o.data.data.filter(e=>e.is_active)}catch(o){console.error("Failed to load AI personalities:",o)}}function Te(o){const e=J.value.find(s=>s.id===o);return(e==null?void 0:e.name)||"Unknown"}const ne=oe(()=>{const o=[];return _.value.forEach(e=>{e.next_steps&&Array.isArray(e.next_steps)&&e.next_steps.forEach((s,u)=>{var m,f,h,l,k,z;const c=_.value.find(C=>C.id===(s.step_id||s));if(c){let A;e.step_type==="condition"&&s.condition==="true"?A=(((m=e.position)==null?void 0:m.x)||0)+180*.3:e.step_type==="condition"&&s.condition==="false"?A=(((f=e.position)==null?void 0:f.x)||0)+180*.7:A=(((h=e.position)==null?void 0:h.x)||0)+90;const fe=(((l=e.position)==null?void 0:l.y)||0)+80,pe=(((k=c.position)==null?void 0:k.x)||0)+90,me=((z=c.position)==null?void 0:z.y)||0;o.push({id:`${e.id}-${c.id}`,fromStepId:e.id,toStepId:c.id,condition:s.condition||null,fromX:A,fromY:fe,toX:pe,toY:me,label:s.condition==="false"?"No":s.condition==="true"?"Yes":"",labelX:(A+pe)/2,labelY:(fe+me)/2-10})}})}),o});function Se(){p.value=Math.min(2,p.value+.1)}function $e(){p.value=Math.max(.25,p.value-.1)}function De(){if(!x.value||_.value.length===0){p.value=1;return}let o=0,e=0;_.value.forEach(m=>{var f,h;o=Math.max(o,(((f=m.position)==null?void 0:f.x)||0)+200),e=Math.max(e,(((h=m.position)==null?void 0:h.y)||0)+100)});const s=x.value.getBoundingClientRect(),u=(s.width-40)/o,c=(s.height-40)/e;p.value=Math.max(.25,Math.min(2,Math.min(u,c)))}function Me(o){if(o.ctrlKey||o.metaKey){o.preventDefault();const e=o.deltaY>0?-.05:.05;p.value=Math.max(.25,Math.min(2,p.value+e))}}function Q(o){return w.stepTypes.filter(e=>e.category===o)}function Le(o){const e=w.stepTypes.find(u=>u.value===o.step_type);return{blue:"border-blue-500",green:"border-green-500",yellow:"border-yellow-500",gray:"border-surface-400",purple:"border-purple-500",orange:"border-orange-500",cyan:"border-cyan-500"}[e==null?void 0:e.color]||"border-surface-400"}function Ye(o){const e=w.stepTypes.find(s=>s.value===o);return(e==null?void 0:e.icon)||"pi pi-cog"}function Ie(o){const e=w.stepTypes.find(s=>s.value===o);return(e==null?void 0:e.label)||o}function ee(o,e){o.dataTransfer.effectAllowed="copy",o.dataTransfer.setData("stepType",e.value),o.dataTransfer.setData("stepLabel",e.label)}function Ue(o){o.preventDefault();const e=o.dataTransfer.getData("stepType"),s=o.dataTransfer.getData("stepLabel");if(!e)return;const u=x.value.getBoundingClientRect(),c=(o.clientX-u.left+x.value.scrollLeft)/p.value-90,m=(o.clientY-u.top+x.value.scrollTop)/p.value-30,f={id:`step-${Date.now()}`,step_type:e,name:s,position:{x:c,y:m},config:re(e),next_steps:[]};_.value.push(f),a.value=f,F.value=f.id}function re(o){return{trigger:{},action:{action_type:"send_message",message:""},condition:{condition_type:"customer_attribute",field:"",operator:"equals",value:""},delay:{delay_minutes:30},parallel:{branches:[]},loop:{iterations:1,loop_step_id:null},custom_code:{code:"",description:""}}[o]||{}}function Ee(o,e){var m,f;if(M.value)return;K.value=!0,q.value=e;const s=x.value.getBoundingClientRect(),u=(o.clientX-s.left+x.value.scrollLeft)/p.value,c=(o.clientY-s.top+x.value.scrollTop)/p.value;Z.value={x:u-(((m=e.position)==null?void 0:m.x)||0),y:c-(((f=e.position)==null?void 0:f.y)||0)}}function We(o){a.value=o,F.value=o.id}function Xe(o){const e=_.value.find(s=>s.id===o);ae.require({message:`Are you sure you want to delete "${(e==null?void 0:e.name)||"this step"}"?`,header:"Delete Step",icon:"pi pi-exclamation-triangle",acceptLabel:"Delete",rejectLabel:"Cancel",acceptClass:"p-button-danger",accept:()=>{var s;_.value.forEach(u=>{u.next_steps&&(u.next_steps=u.next_steps.filter(c=>(c.step_id||c)!==o))}),_.value=_.value.filter(u=>u.id!==o),((s=a.value)==null?void 0:s.id)===o&&(a.value=null,F.value=null)}})}function Re(o){const e=_.value.find(s=>s.id===o.fromStepId);!e||!e.next_steps||(e.next_steps=e.next_steps.filter(s=>{const u=s.step_id||s,c=u===o.toStepId;return o.condition!==null&&o.condition!==void 0?!(u===o.toStepId&&s.condition===o.condition):!c}),E.add({severity:"success",summary:"Connection Removed",detail:"The connection has been removed",life:2e3}))}function ie(o){ae.require({message:"Remove this connection?",header:"Remove Connection",icon:"pi pi-info-circle",acceptLabel:"Remove",rejectLabel:"Cancel",acceptClass:"p-button-danger",accept:()=>Re(o)})}const O=g(null);function te(o,e,s=null){o.preventDefault(),M.value=!0,v.value=e,O.value=s}function y(){var o,e;((o=a.value)==null?void 0:o.step_type)==="custom_code"&&((e=a.value.config)!=null&&e.code)&&ze(a.value.config.code)}function ze(o){if(Y.value=null,!o||!o.trim()){Y.value="Code cannot be empty.";return}if(!o.includes("return")){Y.value="Code must contain a return statement.";return}try{new Function("customer","conversation","message",o)}catch(e){Y.value=`Syntax error: ${e.message}`}}function ue(o){const e=(o.fromY+o.toY)/2;return`M ${o.fromX} ${o.fromY} C ${o.fromX} ${e}, ${o.toX} ${e}, ${o.toX} ${o.toY}`}function Ae(){const o={workflow_definition:{steps:_.value,connections:ne.value}};w.updateWorkflow(R.value,o).then(()=>{E.add({severity:"success",summary:"Saved",detail:"Workflow saved successfully"})}).catch(e=>{var s,u;E.add({severity:"error",summary:"Error",detail:((u=(s=e.response)==null?void 0:s.data)==null?void 0:u.message)||"Failed to save workflow"})})}function Pe(){w.testWorkflow(R.value,X.value).then(o=>{E.add({severity:o.success?"success":"warn",summary:o.success?"Test Passed":"Test Completed",detail:o.success?"Workflow test completed successfully":"Workflow test completed with some issues"}),W.value=!1}).catch(o=>{var e,s;E.add({severity:"error",summary:"Test Failed",detail:((s=(e=o.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to test workflow"})})}function Be(){ye.push("/workflows")}function de(o){if(K.value&&q.value){const e=x.value.getBoundingClientRect(),s=(o.clientX-e.left+x.value.scrollLeft)/p.value-Z.value.x,u=(o.clientY-e.top+x.value.scrollTop)/p.value-Z.value.y;q.value.position={x:Math.max(0,s),y:Math.max(0,u)}}if(M.value&&v.value){const e=x.value.getBoundingClientRect();L.value={x:(o.clientX-e.left+x.value.scrollLeft)/p.value,y:(o.clientY-e.top+x.value.scrollTop)/p.value}}}function Ne(){var m,f;if(!v.value||!L.value)return"";const o=(((m=v.value.position)==null?void 0:m.x)||0)+90,e=(((f=v.value.position)==null?void 0:f.y)||0)+80,s=L.value.x,u=L.value.y,c=(e+u)/2;return`M ${o} ${e} C ${o} ${c}, ${s} ${c}, ${s} ${u}`}function ce(o){if(M.value&&v.value){const e=x.value.getBoundingClientRect(),s=(o.clientX-e.left+x.value.scrollLeft)/p.value,u=(o.clientY-e.top+x.value.scrollTop)/p.value,c=_.value.find(m=>{var l,k;const f=((l=m.position)==null?void 0:l.x)||0,h=((k=m.position)==null?void 0:k.y)||0;return s>=f&&s<=f+180&&u>=h&&u<=h+80});if(c&&c.id!==v.value.id&&(v.value.next_steps||(v.value.next_steps=[]),!v.value.next_steps.find(f=>f.step_id===c.id))){const f=v.value.step_type==="condition",h=["condition","parallel"].includes(v.value.step_type);f&&O.value?(v.value.next_steps=v.value.next_steps.filter(l=>l.condition!==O.value),v.value.next_steps.push({step_id:c.id,condition:O.value})):h?v.value.next_steps.push({step_id:c.id}):v.value.next_steps=[{step_id:c.id}]}}K.value=!1,M.value=!1,q.value=null,v.value=null,L.value=null}return je(async()=>{var o;G.value=!0;try{await Ve(),R.value&&R.value!=="new"?(await w.fetchWorkflow(R.value),N.value=w.currentWorkflow,_.value=((o=N.value)==null?void 0:o.steps)||[]):_.value=[{id:`step-${Date.now()}`,step_type:"trigger",name:"Trigger",position:{x:400,y:50},config:re("trigger"),next_steps:[]}]}finally{G.value=!1}window.addEventListener("mousemove",de),window.addEventListener("mouseup",ce)}),He(()=>{window.removeEventListener("mousemove",de),window.removeEventListener("mouseup",ce)}),(o,e)=>{var u,c,m,f,h;const s=Ze("tooltip");return n(),i(D,null,[t("div",lt,[t("div",at,[e[29]||(e[29]=t("div",{class:"p-3 border-b border-surface-200 dark:border-surface-700"},[t("h3",{class:"font-semibold text-surface-900 dark:text-surface-0"},"Steps")],-1)),t("div",st,[t("div",null,[e[26]||(e[26]=t("h4",{class:"text-xs font-semibold text-surface-500 dark:text-surface-400 uppercase tracking-wide mb-2"}," Triggers ",-1)),t("div",nt,[(n(!0),i(D,null,P(Q("triggers"),l=>(n(),i("div",{key:l.value,draggable:"true",onDragstart:k=>ee(k,l),class:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg cursor-grab hover:border-blue-400 dark:hover:border-blue-600 transition-colors"},[t("div",it,[t("i",{class:I([l.icon,"text-blue-600 dark:text-blue-400"])},null,2),t("span",ut,V(l.label),1)])],40,rt))),128))])]),t("div",null,[e[27]||(e[27]=t("h4",{class:"text-xs font-semibold text-surface-500 dark:text-surface-400 uppercase tracking-wide mb-2"}," Actions ",-1)),t("div",dt,[(n(!0),i(D,null,P(Q("actions"),l=>(n(),i("div",{key:l.value,draggable:"true",onDragstart:k=>ee(k,l),class:"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg cursor-grab hover:border-green-400 dark:hover:border-green-600 transition-colors"},[t("div",ft,[t("i",{class:I([l.icon,"text-green-600 dark:text-green-400"])},null,2),t("span",pt,V(l.label),1)])],40,ct))),128))])]),t("div",null,[e[28]||(e[28]=t("h4",{class:"text-xs font-semibold text-surface-500 dark:text-surface-400 uppercase tracking-wide mb-2"}," Logic ",-1)),t("div",mt,[(n(!0),i(D,null,P(Q("logic"),l=>(n(),i("div",{key:l.value,draggable:"true",onDragstart:k=>ee(k,l),class:"p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg cursor-grab hover:border-yellow-400 dark:hover:border-yellow-600 transition-colors"},[t("div",gt,[t("i",{class:I([l.icon,"text-yellow-600 dark:text-yellow-400"])},null,2),t("span",bt,V(l.label),1)])],40,vt))),128))])])])]),t("div",xt,[t("div",yt,[t("div",kt,[j(d(r(T),{icon:"pi pi-arrow-left",outlined:"",rounded:"",onClick:Be},null,512),[[s,"Back to Workflows"]]),t("div",null,[t("h3",_t,V(((u=N.value)==null?void 0:u.name)||"New Workflow"),1),t("p",wt,V(_e.value),1)])]),t("div",ht,[d(r(T),{label:"Test",icon:"pi pi-play",outlined:"",onClick:e[0]||(e[0]=l=>W.value=!0)}),d(r(T),{label:"Save",icon:"pi pi-check",onClick:Ae,loading:r(w).saving},null,8,["loading"])])]),t("div",Ct,[d(r(T),{icon:"pi pi-minus",text:"",size:"small",onClick:$e,disabled:p.value<=.25},null,8,["disabled"]),t("span",Vt,V(Math.round(p.value*100))+"%",1),d(r(T),{icon:"pi pi-plus",text:"",size:"small",onClick:Se,disabled:p.value>=2},null,8,["disabled"]),d(r(T),{label:"Fit",text:"",size:"small",onClick:De,class:"ml-2"})]),t("div",{ref_key:"canvasRef",ref:x,class:"flex-1 relative overflow-auto bg-surface-50 dark:bg-surface-900",onDrop:Ue,onDragover:e[1]||(e[1]=$(()=>{},["prevent"])),onDragenter:e[2]||(e[2]=$(()=>{},["prevent"])),onWheel:Me},[G.value?(n(),i("div",Tt,[t("div",St,[d(r(Ge),{style:{width:"50px",height:"50px"}}),e[30]||(e[30]=t("p",{class:"mt-3 text-surface-500 dark:text-surface-400 text-sm"},"Loading workflow...",-1))])])):b("",!0),e[36]||(e[36]=t("div",{class:"absolute inset-0 opacity-10 pointer-events-none",style:{"background-image":"radial-gradient(circle, currentColor 1px, transparent 1px)","background-size":"20px 20px"}},null,-1)),t("div",{class:"min-w-full min-h-full p-8 origin-top-left",style:ve({width:se.value.width+"px",height:se.value.height+"px",transform:`scale(${p.value})`})},[(n(),i("svg",$t,[e[32]||(e[32]=t("defs",null,[t("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto"},[t("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#94a3b8"})])],-1)),(n(!0),i(D,null,P(ne.value,l=>(n(),i("g",{key:l.id,class:"connection-group"},[t("path",{d:ue(l),fill:"none",stroke:"transparent","stroke-width":"14",class:"cursor-pointer",onClick:$(k=>ie(l),["stop"])},null,8,Dt),t("path",{d:ue(l),fill:"none",stroke:"#94a3b8","stroke-width":"2","marker-end":"url(#arrowhead)",class:"pointer-events-none connection-line",style:{transition:"stroke 0.2s"}},null,8,Mt),l.label?(n(),i("text",{key:0,x:l.labelX,y:l.labelY,class:"text-xs fill-surface-600 dark:fill-surface-400 pointer-events-none","text-anchor":"middle"},V(l.label),9,Lt)):b("",!0),j((n(),i("g",{class:"connection-delete-btn",transform:`translate(${l.labelX}, ${l.labelY+20})`,onClick:$(k=>ie(l),["stop"]),style:{cursor:"pointer"}},[...e[31]||(e[31]=[t("circle",{r:"10",fill:"#ef4444"},null,-1),t("text",{"text-anchor":"middle","dominant-baseline":"central",fill:"white","font-size":"12","font-weight":"bold",class:"pointer-events-none"},"Ã—",-1)])],8,Yt)),[[s,"Click to remove connection",void 0,{bottom:!0}]])]))),128)),M.value&&v.value&&L.value?(n(),i("path",{key:0,d:Ne(),fill:"none",stroke:"#3b82f6","stroke-width":"2","stroke-dasharray":"6 3","marker-end":"url(#arrowhead)"},null,8,It)):b("",!0)])),(n(!0),i(D,null,P(_.value,l=>{var k,z;return n(),i("div",{key:l.id,class:I(["absolute cursor-move",{"ring-2 ring-primary-500":F.value===l.id}]),style:ve({left:((k=l.position)==null?void 0:k.x)+"px",top:((z=l.position)==null?void 0:z.y)+"px"}),onMousedown:C=>Ee(C,l),onClick:C=>We(l)},[t("div",{class:I(["workflow-step p-3 bg-white dark:bg-surface-800 border-2 rounded-lg shadow-lg min-w-[180px]",Le(l)])},[t("div",Et,[t("i",{class:I([Ye(l.step_type),"text-lg"])},null,2),t("div",Wt,[t("p",Xt,V(l.name),1),t("p",Rt,V(Ie(l.step_type)),1)]),d(r(T),{icon:"pi pi-trash",text:"",size:"small",severity:"danger",onClick:$(C=>Xe(l.id),["stop"])},null,8,["onClick"])])],2),e[35]||(e[35]=t("div",{class:"absolute left-1/2 -translate-x-1/2 -top-2 w-4 h-4 rounded-full bg-surface-400 hover:bg-primary-500 cursor-crosshair"},null,-1)),l.step_type!=="condition"?(n(),i("div",{key:0,class:"absolute left-1/2 -translate-x-1/2 -bottom-2 w-4 h-4 rounded-full bg-surface-400 hover:bg-primary-500 cursor-crosshair",onMousedown:$(C=>te(C,l),["stop"])},null,40,zt)):b("",!0),l.step_type==="condition"?(n(),i(D,{key:1},[j(t("div",{class:"absolute -bottom-2 w-4 h-4 rounded-full bg-green-500 hover:bg-green-600 cursor-crosshair",style:{left:"30%"},onMousedown:$(C=>te(C,l,"true"),["stop"])},null,40,At),[[s,"Yes",void 0,{bottom:!0}]]),j(t("div",{class:"absolute -bottom-2 w-4 h-4 rounded-full bg-red-500 hover:bg-red-600 cursor-crosshair",style:{left:"70%"},onMousedown:$(C=>te(C,l,"false"),["stop"])},null,40,Pt),[[s,"No",void 0,{bottom:!0}]]),e[33]||(e[33]=t("span",{class:"absolute -bottom-6 text-[10px] text-green-600 dark:text-green-400 font-medium",style:{left:"25%"}},"Yes",-1)),e[34]||(e[34]=t("span",{class:"absolute -bottom-6 text-[10px] text-red-600 dark:text-red-400 font-medium",style:{left:"67%"}},"No",-1))],64)):b("",!0)],46,Ut)}),128))],4)],544)]),a.value?(n(),i("div",Bt,[t("div",Nt,[e[37]||(e[37]=t("h3",{class:"font-semibold text-surface-900 dark:text-surface-0"},"Properties",-1)),d(r(T),{icon:"pi pi-times",text:"",onClick:e[3]||(e[3]=l=>a.value=null)})]),t("div",Ft,[t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Step Name ",-1)),d(r(B),{modelValue:a.value.name,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.name=l),class:"w-full",onInput:y},null,8,["modelValue"])]),a.value.step_type==="action"?(n(),i("div",qt,[e[39]||(e[39]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Action Type ",-1)),d(r(U),{modelValue:a.value.config.action_type,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.config.action_type=l),options:r(w).actionTypes,optionLabel:"label",optionValue:"value",class:"w-full",onChange:y},null,8,["modelValue","options"])])):b("",!0),a.value.step_type==="action"&&((c=a.value.config)==null?void 0:c.action_type)==="send_message"?(n(),i("div",Ot,[e[40]||(e[40]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Message Template ",-1)),d(r(H),{modelValue:a.value.config.message,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.config.message=l),rows:"4",class:"w-full",placeholder:"Hi {{customer_name}}, thanks for reaching out!",onInput:y},null,8,["modelValue"]),e[41]||(e[41]=t("p",{class:"text-xs text-surface-500 mt-1"}," Variables: {{customer_name}}, {{customer_email}}, {{current_date}} ",-1))])):b("",!0),a.value.step_type==="action"&&((m=a.value.config)==null?void 0:m.action_type)==="send_ai_response"?(n(),i("div",jt,[t("div",null,[e[42]||(e[42]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," AI Personality ",-1)),d(r(U),{modelValue:a.value.config.ai_agent_id,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.config.ai_agent_id=l),options:J.value,optionLabel:"name",optionValue:"id",placeholder:"Select personality (optional)",class:"w-full",showClear:"",onChange:y},null,8,["modelValue","options"]),e[43]||(e[43]=t("p",{class:"text-xs text-surface-500 mt-1"}," Choose a personality to use, or leave empty to use the system prompt below. ",-1))]),a.value.config.ai_agent_id?(n(),i("div",Gt,[t("p",Jt,[e[46]||(e[46]=t("i",{class:"pi pi-info-circle mr-1"},null,-1)),e[47]||(e[47]=S(" Using personality: ",-1)),t("strong",null,V(Te(a.value.config.ai_agent_id)),1)])])):(n(),i("div",Ht,[e[44]||(e[44]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," System Prompt ",-1)),d(r(H),{modelValue:a.value.config.system_prompt,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.config.system_prompt=l),rows:"4",class:"w-full",placeholder:"You are a helpful customer service assistant...",onInput:y},null,8,["modelValue"]),e[45]||(e[45]=t("p",{class:"text-xs text-surface-500 mt-1"}," Custom prompt for this step. Only used when no personality is selected. ",-1))]))])):b("",!0),a.value.step_type==="condition"?(n(),i("div",Kt,[t("div",null,[e[48]||(e[48]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Condition Type ",-1)),d(r(U),{modelValue:a.value.config.condition_type,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.config.condition_type=l),options:r(w).conditionTypes,optionLabel:"label",optionValue:"value",class:"w-full",onChange:y},null,8,["modelValue","options"])]),a.value.config.condition_type&&a.value.config.condition_type!=="ai_condition"?(n(),i("div",Zt,[e[49]||(e[49]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Field ",-1)),d(r(U),{modelValue:a.value.config.field,"onUpdate:modelValue":e[10]||(e[10]=l=>a.value.config.field=l),options:he(a.value.config.condition_type),optionLabel:"label",optionValue:"value",class:"w-full",editable:!0,placeholder:Ce(a.value.config.condition_type),onChange:y},null,8,["modelValue","options","placeholder"])])):b("",!0),a.value.config.condition_type&&a.value.config.condition_type!=="ai_condition"?(n(),i("div",Qt,[e[50]||(e[50]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Operator ",-1)),d(r(U),{modelValue:a.value.config.operator,"onUpdate:modelValue":e[11]||(e[11]=l=>a.value.config.operator=l),options:we,optionLabel:"label",optionValue:"value",class:"w-full",onChange:y},null,8,["modelValue"])])):b("",!0),a.value.config.condition_type&&a.value.config.condition_type!=="time_of_day"&&a.value.config.condition_type!=="day_of_week"?(n(),i("div",eo,[t("label",to,V(a.value.config.condition_type==="ai_condition"?"AI Prompt":"Value"),1),a.value.config.condition_type==="ai_condition"?(n(),ge(r(H),{key:0,modelValue:a.value.config.ai_prompt,"onUpdate:modelValue":e[12]||(e[12]=l=>a.value.config.ai_prompt=l),rows:"3",class:"w-full",placeholder:"e.g., Is the customer asking about a refund?",onInput:y},null,8,["modelValue"])):(n(),ge(r(B),{key:1,modelValue:a.value.config.value,"onUpdate:modelValue":e[13]||(e[13]=l=>a.value.config.value=l),class:"w-full",placeholder:"Value to compare",onInput:y},null,8,["modelValue"]))])):b("",!0),a.value.config.condition_type==="time_of_day"?(n(),i("div",oo,[e[52]||(e[52]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Time Range (24h format) ",-1)),t("div",lo,[d(r(B),{modelValue:a.value.config.time_from,"onUpdate:modelValue":e[14]||(e[14]=l=>a.value.config.time_from=l),class:"w-full",placeholder:"09:00",onInput:y},null,8,["modelValue"]),e[51]||(e[51]=t("span",{class:"text-surface-500"},"to",-1)),d(r(B),{modelValue:a.value.config.time_to,"onUpdate:modelValue":e[15]||(e[15]=l=>a.value.config.time_to=l),class:"w-full",placeholder:"17:00",onInput:y},null,8,["modelValue"])])])):b("",!0),a.value.config.condition_type==="day_of_week"?(n(),i("div",ao,[e[53]||(e[53]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Days ",-1)),d(r(xe),{modelValue:a.value.config.days,"onUpdate:modelValue":[e[16]||(e[16]=l=>a.value.config.days=l),y],class:"w-full",placeholder:"e.g., Monday"},null,8,["modelValue"])])):b("",!0),e[54]||(e[54]=t("p",{class:"text-xs text-surface-500 mt-1"},[t("i",{class:"pi pi-info-circle mr-1"}),S(" Drag from the "),t("span",{class:"text-green-600 font-medium"},"green dot"),S(" (Yes) or "),t("span",{class:"text-red-600 font-medium"},"red dot"),S(" (No) to connect to the next step. ")],-1))])):b("",!0),a.value.step_type==="delay"?(n(),i("div",so,[e[55]||(e[55]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Delay Duration ",-1)),d(r(le),{modelValue:a.value.config.delay_minutes,"onUpdate:modelValue":e[17]||(e[17]=l=>a.value.config.delay_minutes=l),min:1,max:10080,class:"w-full",onInput:y},null,8,["modelValue"]),e[56]||(e[56]=t("p",{class:"text-xs text-surface-500 mt-1"},"Minutes to wait before continuing",-1))])):b("",!0),a.value.step_type==="action"&&["add_tag","remove_tag"].includes((f=a.value.config)==null?void 0:f.action_type)?(n(),i("div",no,[e[57]||(e[57]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Tags ",-1)),d(r(xe),{modelValue:a.value.config.tags,"onUpdate:modelValue":[e[18]||(e[18]=l=>a.value.config.tags=l),y],class:"w-full"},null,8,["modelValue"])])):b("",!0),a.value.step_type==="action"&&((h=a.value.config)==null?void 0:h.action_type)==="set_status"?(n(),i("div",ro,[e[58]||(e[58]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Status ",-1)),d(r(U),{modelValue:a.value.config.status,"onUpdate:modelValue":e[19]||(e[19]=l=>a.value.config.status=l),options:[{value:"open",label:"Open"},{value:"in_progress",label:"In Progress"},{value:"closed",label:"Closed"},{value:"escalated",label:"Escalated"}],optionLabel:"label",optionValue:"value",class:"w-full",onChange:y},null,8,["modelValue"])])):b("",!0),a.value.step_type==="custom_code"?(n(),i("div",io,[t("div",null,[e[59]||(e[59]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," JavaScript Code ",-1)),d(r(H),{modelValue:a.value.config.code,"onUpdate:modelValue":e[20]||(e[20]=l=>a.value.config.code=l),rows:"10",class:"w-full font-mono text-sm",placeholder:`// Write JavaScript code here.
// Available variables: customer, conversation, message
// Must return a value.
//
// Example:
// const name = customer.name || 'Guest';
// return { greeting: \`Hello \${name}!\` };`,onInput:y},null,8,["modelValue"])]),t("div",null,[e[60]||(e[60]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Description ",-1)),d(r(B),{modelValue:a.value.config.description,"onUpdate:modelValue":e[21]||(e[21]=l=>a.value.config.description=l),class:"w-full",placeholder:"What does this code do?",onInput:y},null,8,["modelValue"])]),e[62]||(e[62]=t("div",{class:"p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg"},[t("p",{class:"text-xs text-yellow-700 dark:text-yellow-400"},[t("i",{class:"pi pi-info-circle mr-1"}),S(" Code runs in a sandboxed environment. Must return a value. Available context: "),t("code",null,"customer"),S(", "),t("code",null,"conversation"),S(", "),t("code",null,"message"),S(". ")])],-1)),Y.value?(n(),i("div",uo,[t("p",co,[e[61]||(e[61]=t("i",{class:"pi pi-exclamation-triangle mr-1"},null,-1)),S(" "+V(Y.value),1)])])):b("",!0)])):b("",!0)])])):(n(),i("div",fo,[...e[63]||(e[63]=[t("div",{class:"flex-1 flex items-center justify-center p-8 text-center"},[t("div",null,[t("i",{class:"pi pi-cog text-4xl text-surface-300 dark:text-surface-600 mb-3"}),t("p",{class:"text-surface-500 dark:text-surface-400"},"Select a step to edit its properties")])],-1)])]))]),d(r(tt),{visible:W.value,"onUpdate:visible":e[25]||(e[25]=l=>W.value=l),header:"Test Workflow",modal:"",class:"w-full max-w-md"},{footer:be(()=>[d(r(T),{label:"Cancel",outlined:"",onClick:e[24]||(e[24]=l=>W.value=!1)}),d(r(T),{label:"Run Test",loading:r(w).testing,onClick:Pe},null,8,["loading"])]),default:be(()=>[t("div",po,[t("div",null,[e[64]||(e[64]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Customer ID (Optional) ",-1)),d(r(le),{modelValue:X.value.customer_id,"onUpdate:modelValue":e[22]||(e[22]=l=>X.value.customer_id=l),class:"w-full",placeholder:"Leave empty for simulation"},null,8,["modelValue"])]),t("div",null,[e[65]||(e[65]=t("label",{class:"block text-sm font-medium text-surface-700 dark:text-surface-300 mb-2"}," Conversation ID (Optional) ",-1)),d(r(le),{modelValue:X.value.conversation_id,"onUpdate:modelValue":e[23]||(e[23]=l=>X.value.conversation_id=l),class:"w-full",placeholder:"Leave empty for simulation"},null,8,["modelValue"])])])]),_:1},8,["visible"]),d(r(et))],64)}}},$o=ot(mo,[["__scopeId","data-v-2218f9e1"]]);export{$o as default};
